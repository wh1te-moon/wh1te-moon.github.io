<!DOCTYPE html><html><head>
      <title>CCIE学习笔记</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\xhm\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.14\crossnote\dependencies\katex\katex.min.css">
      
      
      <script type="text/javascript" src="file:///c:\Users\xhm\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.14\crossnote\dependencies\mermaid\mermaid.min.js" charset="UTF-8"></script>
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview {
  /* MWeb：增加 padding */
  /* MWeb：代码块高亮 */
  /* cyrillic-ext */
  /* cyrillic */
  /* greek-ext */
  /* greek */
  /* vietnamese */
  /* latin-ext */
  /* latin */
  /* cyrillic-ext */
  /* cyrillic */
  /* greek-ext */
  /* greek */
  /* vietnamese */
  /* latin-ext */
  /* latin */
  /* cyrillic-ext */
  /* cyrillic */
  /* greek-ext */
  /* greek */
  /* vietnamese */
  /* latin-ext */
  /* latin */
  /* cyrillic-ext */
  /* cyrillic */
  /* greek-ext */
  /* greek */
  /* vietnamese */
  /* latin-ext */
  /* latin */
  /** focus mode */
  /* prismJS 代码高亮样式 */
  /*# sourceMappingURL=prism-base2tone-meadow-light.css.map */
}
.markdown-preview.markdown-preview :root {
  --side-bar-bg-color: #fff;
  --control-text-color: #777;
}
.markdown-preview.markdown-preview body {
  min-width: 200px;
  max-width: 760px;
  margin: 0 auto !important;
  padding: 1em;
}
.markdown-preview.markdown-preview .task-list-item {
  list-style-type: none;
  text-indent: -1.5em;
}
.markdown-preview.markdown-preview .task-list-item:before {
  content: "";
  display: static;
  margin-right: 0px;
}
.markdown-preview.markdown-preview .task-list-item > input[type=checkbox] {
  text-indent: -1.7em;
}
.markdown-preview.markdown-preview code,
.markdown-preview.markdown-preview tt,
.markdown-preview.markdown-preview pre {
  border-radius: 2px;
  font-family: Roboto Mono, Source Sans Pro, Monaco, courier, monospace !important;
  font-size: 0.92rem;
  color: #e96900;
  overflow-x: auto;
  background-color: #f8f8f8;
}
.markdown-preview.markdown-preview code {
  margin: 0 2px;
  padding: 2px 4px;
}
.markdown-preview.markdown-preview pre code {
  background: none;
  border: none;
  margin: 0;
  padding: 0;
}
.markdown-preview.markdown-preview pre {
  padding: 0.7em 1em;
}
@font-face {
  font-family: "Roboto Mono";
  font-style: normal;
  font-weight: 400;
  src: local("Roboto Mono"), local("RobotoMono-Regular"), url("vue/L0x5DF4xlVMF-BfR8bXMIjhGq3-cXbKDO1w.woff2") format("woff2");
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: "Roboto Mono";
  font-style: normal;
  font-weight: 400;
  src: local("Roboto Mono"), local("RobotoMono-Regular"), url("vue/L0x5DF4xlVMF-BfR8bXMIjhPq3-cXbKDO1w.woff2") format("woff2");
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: "Roboto Mono";
  font-style: normal;
  font-weight: 400;
  src: local("Roboto Mono"), local("RobotoMono-Regular"), url("vue/L0x5DF4xlVMF-BfR8bXMIjhHq3-cXbKDO1w.woff2") format("woff2");
  unicode-range: U+1F00-1FFF;
}
@font-face {
  font-family: "Roboto Mono";
  font-style: normal;
  font-weight: 400;
  src: local("Roboto Mono"), local("RobotoMono-Regular"), url("vue/L0x5DF4xlVMF-BfR8bXMIjhIq3-cXbKDO1w.woff2") format("woff2");
  unicode-range: U+0370-03FF;
}
@font-face {
  font-family: "Roboto Mono";
  font-style: normal;
  font-weight: 400;
  src: local("Roboto Mono"), local("RobotoMono-Regular"), url("vue/L0x5DF4xlVMF-BfR8bXMIjhEq3-cXbKDO1w.woff2") format("woff2");
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: "Roboto Mono";
  font-style: normal;
  font-weight: 400;
  src: local("Roboto Mono"), local("RobotoMono-Regular"), url("vue/L0x5DF4xlVMF-BfR8bXMIjhFq3-cXbKDO1w.woff2") format("woff2");
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: "Roboto Mono";
  font-style: normal;
  font-weight: 400;
  src: local("Roboto Mono"), local("RobotoMono-Regular"), url("vue/L0x5DF4xlVMF-BfR8bXMIjhLq3-cXbKD.woff2") format("woff2");
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 300;
  src: local("Source Sans Pro Light"), local("SourceSansPro-Light"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmhduz8A.woff2") format("woff2");
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 300;
  src: local("Source Sans Pro Light"), local("SourceSansPro-Light"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwkxduz8A.woff2") format("woff2");
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 300;
  src: local("Source Sans Pro Light"), local("SourceSansPro-Light"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmxduz8A.woff2") format("woff2");
  unicode-range: U+1F00-1FFF;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 300;
  src: local("Source Sans Pro Light"), local("SourceSansPro-Light"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwlBduz8A.woff2") format("woff2");
  unicode-range: U+0370-03FF;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 300;
  src: local("Source Sans Pro Light"), local("SourceSansPro-Light"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmBduz8A.woff2") format("woff2");
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 300;
  src: local("Source Sans Pro Light"), local("SourceSansPro-Light"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwmRduz8A.woff2") format("woff2");
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 300;
  src: local("Source Sans Pro Light"), local("SourceSansPro-Light"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3ik4zwlxdu.woff2") format("woff2");
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 400;
  src: local("Source Sans Pro Regular"), local("SourceSansPro-Regular"), url("vue/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNa7lqDY.woff2") format("woff2");
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 400;
  src: local("Source Sans Pro Regular"), local("SourceSansPro-Regular"), url("vue/6xK3dSBYKcSV-LCoeQqfX1RYOo3qPK7lqDY.woff2") format("woff2");
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 400;
  src: local("Source Sans Pro Regular"), local("SourceSansPro-Regular"), url("vue/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNK7lqDY.woff2") format("woff2");
  unicode-range: U+1F00-1FFF;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 400;
  src: local("Source Sans Pro Regular"), local("SourceSansPro-Regular"), url("vue/6xK3dSBYKcSV-LCoeQqfX1RYOo3qO67lqDY.woff2") format("woff2");
  unicode-range: U+0370-03FF;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 400;
  src: local("Source Sans Pro Regular"), local("SourceSansPro-Regular"), url("vue/6xK3dSBYKcSV-LCoeQqfX1RYOo3qN67lqDY.woff2") format("woff2");
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 400;
  src: local("Source Sans Pro Regular"), local("SourceSansPro-Regular"), url("vue/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNq7lqDY.woff2") format("woff2");
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 400;
  src: local("Source Sans Pro Regular"), local("SourceSansPro-Regular"), url("vue/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7l.woff2") format("woff2");
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 600;
  src: local("Source Sans Pro SemiBold"), local("SourceSansPro-SemiBold"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmhduz8A.woff2") format("woff2");
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 600;
  src: local("Source Sans Pro SemiBold"), local("SourceSansPro-SemiBold"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwkxduz8A.woff2") format("woff2");
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 600;
  src: local("Source Sans Pro SemiBold"), local("SourceSansPro-SemiBold"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmxduz8A.woff2") format("woff2");
  unicode-range: U+1F00-1FFF;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 600;
  src: local("Source Sans Pro SemiBold"), local("SourceSansPro-SemiBold"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlBduz8A.woff2") format("woff2");
  unicode-range: U+0370-03FF;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 600;
  src: local("Source Sans Pro SemiBold"), local("SourceSansPro-SemiBold"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmBduz8A.woff2") format("woff2");
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 600;
  src: local("Source Sans Pro SemiBold"), local("SourceSansPro-SemiBold"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmRduz8A.woff2") format("woff2");
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: "Source Sans Pro";
  font-style: normal;
  font-weight: 600;
  src: local("Source Sans Pro SemiBold"), local("SourceSansPro-SemiBold"), url("vue/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlxdu.woff2") format("woff2");
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
.markdown-preview.markdown-preview html {
  font-size: 16px;
}
.markdown-preview.markdown-preview body {
  font-family: Source Sans Pro, Helvetica Neue, Arial, sans-serif !important;
  color: #34495e;
  -webkit-font-smoothing: antialiased;
  line-height: 1.6rem;
  letter-spacing: 0;
  margin: 0;
  overflow-x: hidden;
}
.markdown-preview.markdown-preview body > *:first-child {
  margin-top: 0 !important;
}
.markdown-preview.markdown-preview body > *:last-child {
  margin-bottom: 0 !important;
}
.markdown-preview.markdown-preview body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
.markdown-preview.markdown-preview a {
  color: #42b983;
  font-weight: 600;
  padding: 0 2px;
  text-decoration: none;
}
.markdown-preview.markdown-preview h1,
.markdown-preview.markdown-preview h2,
.markdown-preview.markdown-preview h3,
.markdown-preview.markdown-preview h4,
.markdown-preview.markdown-preview h5,
.markdown-preview.markdown-preview h6 {
  position: relative;
  margin-top: 1rem;
  margin-bottom: 1rem;
  font-weight: bold;
  line-height: 1.4;
  cursor: text;
}
.markdown-preview.markdown-preview h1:hover a.anchor,
.markdown-preview.markdown-preview h2:hover a.anchor,
.markdown-preview.markdown-preview h3:hover a.anchor,
.markdown-preview.markdown-preview h4:hover a.anchor,
.markdown-preview.markdown-preview h5:hover a.anchor,
.markdown-preview.markdown-preview h6:hover a.anchor {
  text-decoration: none;
}
.markdown-preview.markdown-preview h1 tt,
.markdown-preview.markdown-preview h1 code {
  font-size: inherit !important;
}
.markdown-preview.markdown-preview h2 tt,
.markdown-preview.markdown-preview h2 code {
  font-size: inherit !important;
}
.markdown-preview.markdown-preview h3 tt,
.markdown-preview.markdown-preview h3 code {
  font-size: inherit !important;
}
.markdown-preview.markdown-preview h4 tt,
.markdown-preview.markdown-preview h4 code {
  font-size: inherit !important;
}
.markdown-preview.markdown-preview h5 tt,
.markdown-preview.markdown-preview h5 code {
  font-size: inherit !important;
}
.markdown-preview.markdown-preview h6 tt,
.markdown-preview.markdown-preview h6 code {
  font-size: inherit !important;
}
.markdown-preview.markdown-preview h2 a,
.markdown-preview.markdown-preview h3 a {
  color: #34495e;
}
.markdown-preview.markdown-preview h1 {
  padding-bottom: 0.4rem;
  font-size: 2.2rem;
  line-height: 1.3;
}
.markdown-preview.markdown-preview h2 {
  font-size: 1.75rem;
  line-height: 1.225;
  margin: 35px 0 15px;
  padding-bottom: 0.5em;
  border-bottom: 1px solid #ddd;
}
.markdown-preview.markdown-preview h3 {
  font-size: 1.4rem;
  line-height: 1.43;
  margin: 20px 0 7px;
}
.markdown-preview.markdown-preview h4 {
  font-size: 1.2rem;
}
.markdown-preview.markdown-preview h5 {
  font-size: 1rem;
}
.markdown-preview.markdown-preview h6 {
  font-size: 1rem;
  color: #777;
}
.markdown-preview.markdown-preview p,
.markdown-preview.markdown-preview blockquote,
.markdown-preview.markdown-preview ul,
.markdown-preview.markdown-preview ol,
.markdown-preview.markdown-preview dl,
.markdown-preview.markdown-preview table {
  margin: 0.8em 0;
}
.markdown-preview.markdown-preview li > ol,
.markdown-preview.markdown-preview li > ul {
  margin: 0 0;
}
.markdown-preview.markdown-preview hr {
  height: 2px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
  overflow: hidden;
  box-sizing: content-box;
}
.markdown-preview.markdown-preview body > h2:first-child {
  margin-top: 0;
  padding-top: 0;
}
.markdown-preview.markdown-preview body > h1:first-child {
  margin-top: 0;
  padding-top: 0;
}
.markdown-preview.markdown-preview body > h1:first-child + h2 {
  margin-top: 0;
  padding-top: 0;
}
.markdown-preview.markdown-preview body > h3:first-child,
.markdown-preview.markdown-preview body > h4:first-child,
.markdown-preview.markdown-preview body > h5:first-child,
.markdown-preview.markdown-preview body > h6:first-child {
  margin-top: 0;
  padding-top: 0;
}
.markdown-preview.markdown-preview a:first-child h1,
.markdown-preview.markdown-preview a:first-child h2,
.markdown-preview.markdown-preview a:first-child h3,
.markdown-preview.markdown-preview a:first-child h4,
.markdown-preview.markdown-preview a:first-child h5,
.markdown-preview.markdown-preview a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}
.markdown-preview.markdown-preview h1 p,
.markdown-preview.markdown-preview h2 p,
.markdown-preview.markdown-preview h3 p,
.markdown-preview.markdown-preview h4 p,
.markdown-preview.markdown-preview h5 p,
.markdown-preview.markdown-preview h6 p {
  margin-top: 0;
}
.markdown-preview.markdown-preview li p.first {
  display: inline-block;
}
.markdown-preview.markdown-preview ul,
.markdown-preview.markdown-preview ol {
  padding-left: 30px;
}
.markdown-preview.markdown-preview ul:first-child,
.markdown-preview.markdown-preview ol:first-child {
  margin-top: 0;
}
.markdown-preview.markdown-preview ul:last-child,
.markdown-preview.markdown-preview ol:last-child {
  margin-bottom: 0;
}
.markdown-preview.markdown-preview blockquote {
  border-left: 4px solid #42b983;
  padding: 10px 15px;
  color: #777;
  background-color: rgba(66, 185, 131, 0.1);
}
.markdown-preview.markdown-preview table {
  padding: 0;
  word-break: initial;
  border-collapse: collapse;
}
.markdown-preview.markdown-preview table tr {
  border-top: 1px solid #dfe2e5;
  margin: 0;
  padding: 0;
}
.markdown-preview.markdown-preview table tr:nth-child(2n),
.markdown-preview.markdown-preview thead {
  background-color: #fafafa;
}
.markdown-preview.markdown-preview table tr th {
  font-weight: bold;
  border: 1px solid #dfe2e5;
  border-bottom: 0;
  text-align: left;
  margin: 0;
  padding: 6px 13px;
}
.markdown-preview.markdown-preview table tr td {
  border: 1px solid #dfe2e5;
  text-align: left;
  margin: 0;
  padding: 6px 13px;
}
.markdown-preview.markdown-preview table tr th:first-child,
.markdown-preview.markdown-preview table tr td:first-child {
  margin-top: 0;
}
.markdown-preview.markdown-preview table tr th:last-child,
.markdown-preview.markdown-preview table tr td:last-child {
  margin-bottom: 0;
}
.markdown-preview.markdown-preview .cm-s-inner .cm-link,
.markdown-preview.markdown-preview .cm-s-inner.cm-link {
  color: #22a2c9;
}
.markdown-preview.markdown-preview .cm-s-inner .cm-string {
  color: #22a2c9;
}
.markdown-preview.markdown-preview .md-task-list-item > input {
  margin-left: -1.3em;
}
@media print {
  .markdown-preview.markdown-preview html {
    font-size: 13px;
  }
  .markdown-preview.markdown-preview table,
  .markdown-preview.markdown-preview pre {
    page-break-inside: avoid;
  }
  .markdown-preview.markdown-preview pre {
    word-wrap: break-word;
  }
}
.markdown-preview.markdown-preview .md-fences {
  background-color: #f8f8f8;
}
.markdown-preview.markdown-preview .mathjax-block > .code-tooltip {
  bottom: 0.375rem;
}
.markdown-preview.markdown-preview .md-image > .md-meta {
  border-radius: 3px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
  padding: 2px 0 0 4px;
  font-size: 0.9em;
  color: inherit;
}
.markdown-preview.markdown-preview .md-tag {
  color: inherit;
}
.markdown-preview.markdown-preview .md-toc {
  margin-top: 20px;
  padding-bottom: 20px;
}
.markdown-preview.markdown-preview .sidebar-tabs {
  border-bottom: none;
}
.markdown-preview.markdown-preview #typora-quick-open {
  border: 1px solid #ddd;
  background-color: #f8f8f8;
}
.markdown-preview.markdown-preview #typora-quick-open-item {
  background-color: #fafafa;
  border-color: #fefefe #e5e5e5 #e5e5e5 #eee;
  border-style: solid;
  border-width: 1px;
}
.markdown-preview.markdown-preview #md-notification:before {
  top: 10px;
}
.markdown-preview.markdown-preview .on-focus-mode blockquote {
  border-left-color: rgba(85, 85, 85, 0.12);
}
.markdown-preview.markdown-preview header,
.markdown-preview.markdown-preview .context-menu,
.markdown-preview.markdown-preview .megamenu-content,
.markdown-preview.markdown-preview footer {
  font-family: "Segoe UI", "Arial", sans-serif;
}
.markdown-preview.markdown-preview .file-node-content:hover .file-node-icon,
.markdown-preview.markdown-preview .file-node-content:hover .file-node-open-state {
  visibility: visible;
}
.markdown-preview.markdown-preview .mac-seamless-mode #typora-sidebar {
  background-color: var(--side-bar-bg-color);
}
.markdown-preview.markdown-preview .md-lang {
  color: #b4654d;
}
.markdown-preview.markdown-preview .html-for-mac .context-menu {
  --item-hover-bg-color: #e6f0fe;
}
.markdown-preview.markdown-preview code[class*="language-"],
.markdown-preview.markdown-preview pre[class*="language-"] {
  font-family: Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace;
  font-size: 14px;
  line-height: 1.375;
  direction: ltr;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;
  -webkit-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
  background: #fafbf9;
  color: #4299d7;
}
.markdown-preview.markdown-preview pre[class*="language-"] {
  padding: 1em;
  margin: 0.5em 0;
  overflow: auto;
}
.markdown-preview.markdown-preview :not(pre) > code[class*="language-"] {
  padding: 0.1em;
  border-radius: 0.3em;
}
.markdown-preview.markdown-preview .token.comment,
.markdown-preview.markdown-preview .token.prolog,
.markdown-preview.markdown-preview .token.doctype,
.markdown-preview.markdown-preview .token.cdata {
  color: #bdc3b7;
}
.markdown-preview.markdown-preview .token.punctuation {
  color: #bdc3b7;
}
.markdown-preview.markdown-preview .token.namespace {
  opacity: 0.7;
}
.markdown-preview.markdown-preview .token.tag,
.markdown-preview.markdown-preview .token.operator,
.markdown-preview.markdown-preview .token.number {
  color: #1b6498;
}
.markdown-preview.markdown-preview .token.property,
.markdown-preview.markdown-preview .token.function {
  color: #66a329;
}
.markdown-preview.markdown-preview .token.tag-id,
.markdown-preview.markdown-preview .token.selector,
.markdown-preview.markdown-preview .token.atrule-id {
  color: #4d8217;
}
.markdown-preview.markdown-preview code.language-javascript,
.markdown-preview.markdown-preview .token.attr-name {
  color: #66a329;
}
.markdown-preview.markdown-preview code.language-css,
.markdown-preview.markdown-preview code.language-scss,
.markdown-preview.markdown-preview .token.boolean,
.markdown-preview.markdown-preview .token.string,
.markdown-preview.markdown-preview .token.entity,
.markdown-preview.markdown-preview .token.url,
.markdown-preview.markdown-preview .language-css .token.string,
.markdown-preview.markdown-preview .language-scss .token.string,
.markdown-preview.markdown-preview .style .token.string,
.markdown-preview.markdown-preview .token.attr-value,
.markdown-preview.markdown-preview .token.keyword,
.markdown-preview.markdown-preview .token.control,
.markdown-preview.markdown-preview .token.directive,
.markdown-preview.markdown-preview .token.unit,
.markdown-preview.markdown-preview .token.statement,
.markdown-preview.markdown-preview .token.regex,
.markdown-preview.markdown-preview .token.atrule {
  color: #277fbe;
}
.markdown-preview.markdown-preview .token.placeholder,
.markdown-preview.markdown-preview .token.variable {
  color: #8dcefc;
}
.markdown-preview.markdown-preview .token.deleted {
  text-decoration: line-through;
}
.markdown-preview.markdown-preview .token.inserted {
  border-bottom: 1px dotted #4d8217;
  text-decoration: none;
}
.markdown-preview.markdown-preview .token.italic {
  font-style: italic;
}
.markdown-preview.markdown-preview .token.important,
.markdown-preview.markdown-preview .token.bold {
  font-weight: bold;
}
.markdown-preview.markdown-preview .token.important {
  color: #66a329;
}
.markdown-preview.markdown-preview .token.entity {
  cursor: help;
}
.markdown-preview.markdown-preview pre > code.highlight {
  outline: 0.4em solid #66a329;
  outline-offset: 0.4em;
}
.markdown-preview.markdown-preview .line-numbers .line-numbers-rows {
  border-right-color: #f3f4f1;
}
.markdown-preview.markdown-preview .line-numbers-rows > span:before {
  color: #d1d6cd;
}
.markdown-preview.markdown-preview .line-highlight {
  background: rgba(77, 130, 23, 0.2);
  background: -webkit-gradient(linear, left top, right top, color-stop(70%, rgba(77, 130, 23, 0.2)), to(rgba(77, 130, 23, 0)));
  background: linear-gradient(to right, rgba(77, 130, 23, 0.2) 70%, rgba(77, 130, 23, 0));
}

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<div class="md-toc">
<details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#tcpip-and-osi" class="md-toc-link"><p>TCP/IP and OSI</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#arpaddress-resolution-protocol" class="md-toc-link">
            <p>arp(Address Resolution Protocol)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#电缆引脚" class="md-toc-link">
            <p>电缆引脚</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#cli相关" class="md-toc-link"><p>CLI相关</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#password-type" class="md-toc-link">
            <p>password type:</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#privilege" class="md-toc-link">
            <p>privilege</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置密码" class="md-toc-link">
            <p>配置密码</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置ssh" class="md-toc-link">
            <p>配置ssh</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#其他命令" class="md-toc-link">
            <p>其他命令</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错" class="md-toc-link">
            <p>排错</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#log" class="md-toc-link"><p>log</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#debug" class="md-toc-link"><p>debug</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#configuration" class="md-toc-link">
            <p>configuration</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#环回接口" class="md-toc-link"><p>环回接口</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-1" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ip" class="md-toc-link"><p>IP</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#cef" class="md-toc-link">
            <p>CEF</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#address-resolution-protocolarp" class="md-toc-link"><p>Address Resolution Protocol(ARP)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-1" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#adadministrative-distance" class="md-toc-link"><p>AD(Administrative Distance)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-2" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ip地址" class="md-toc-link"><p>ip地址</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#网络类别" class="md-toc-link">
            <p>网络类别</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#子网掩码" class="md-toc-link"><p>子网掩码</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-3" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ipv6" class="md-toc-link"><p>IPv6</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#eui-64" class="md-toc-link">
            <p>eui-64</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-4" class="md-toc-link">
            <p>配置</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#第一跳安全" class="md-toc-link">
            <p>第一跳安全</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#dhcp" class="md-toc-link"><p>DHCP</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ipv6-1" class="md-toc-link">
            <p>ipv6</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-5" class="md-toc-link">
            <p>配置</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-2" class="md-toc-link">
            <p>排错</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#dhcp-snooping" class="md-toc-link"><p>DHCP snooping</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-6" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#nat" class="md-toc-link"><p>NAT</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-7" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ntp" class="md-toc-link"><p>NTP</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#stratum" class="md-toc-link">
            <p>stratum</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-8" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ptpprecicsion-time-protocol" class="md-toc-link">
            <p>PTP(Precicsion Time Protocol)</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#igpripv2-ospf-eigrp-is-is-and-egpebgp" class="md-toc-link"><p>IGP(RIPv2, OSPF, EIGRP, IS-IS) and EGP(eBGP)</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ripv2" class="md-toc-link"><p>RIPv2</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-9" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ospf" class="md-toc-link"><p>OSPF</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ospf区域" class="md-toc-link">
            <p>OSPF区域</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ospf邻居" class="md-toc-link">
            <p>OSPF邻居</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#lsdb" class="md-toc-link">
            <p>LSDB</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#末梢区域" class="md-toc-link">
            <p>末梢区域</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#spf" class="md-toc-link">
            <p>SPF</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#dr" class="md-toc-link">
            <p>DR</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#转发地址" class="md-toc-link">
            <p>转发地址</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-10" class="md-toc-link">
            <p>配置</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-3" class="md-toc-link">
            <p>排错</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ipv6-2" class="md-toc-link"><p>ipv6</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#lsa" class="md-toc-link">
            <p>LSA</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-11" class="md-toc-link">
            <p>配置</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-4" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#eigrp" class="md-toc-link"><p>EIGRP</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-邻居关系" class="md-toc-link">
            <ol>
<li>邻居关系</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-拓扑表" class="md-toc-link">
            <ol start="2">
<li>拓扑表</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-度量值" class="md-toc-link">
            <ol start="3">
<li>度量值</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-dual" class="md-toc-link">
            <ol start="4">
<li>DUAL</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#路由汇总" class="md-toc-link">
            <p>路由汇总</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#末梢路由器-and-末梢站点" class="md-toc-link">
            <p>末梢路由器 and 末梢站点</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#路由控制" class="md-toc-link">
            <p>路由控制</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#水平分割" class="md-toc-link">
            <p>水平分割</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-12" class="md-toc-link">
            <p>配置</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#排错-5" class="md-toc-link"><p>排错</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#eigrp邻居关系无法建立可能因为" class="md-toc-link">
            <p>EIGRP邻居关系无法建立可能因为</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#eigrp路由故障可能" class="md-toc-link">
            <p>EIGRP路由故障可能</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ipv6-3" class="md-toc-link"><p>ipv6</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-13" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#bgp" class="md-toc-link"><p>BGP</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#通信" class="md-toc-link">
            <p>通信</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#路径属性" class="md-toc-link">
            <p>路径属性</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#nlri" class="md-toc-link"><p>NLRI</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#入站和出站策略" class="md-toc-link">
            <p>入站和出站策略</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#bgp拓扑" class="md-toc-link">
            <p>BGP拓扑</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#rr-and-联盟" class="md-toc-link"><p>RR and 联盟</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#联盟配置" class="md-toc-link">
            <p>联盟配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#mpbgp" class="md-toc-link"><p>MPBGP</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ipv6-over-ipv4" class="md-toc-link">
            <p>ipv6 over ipv4</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#团体" class="md-toc-link">
            <p>团体</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#good-example" class="md-toc-link">
            <p>good example</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#bgp最佳路径" class="md-toc-link"><p>BGP最佳路径</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#等价多路径" class="md-toc-link">
            <p>等价多路径</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#配置-14" class="md-toc-link"><p>配置</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#bgp更新组" class="md-toc-link">
            <p>BGP更新组</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#对等体模板" class="md-toc-link">
            <p>对等体模板</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-6" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#redistribute" class="md-toc-link"><p>redistribute</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-15" class="md-toc-link">
            <p>配置</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-7" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#路由过滤" class="md-toc-link"><p>路由过滤</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#acl" class="md-toc-link"><p>ACL</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#interaction" class="md-toc-link">
            <p>interaction</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#配置-16" class="md-toc-link"><p>配置</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#vacl" class="md-toc-link">
            <p>VACL</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ipv6-4" class="md-toc-link"><p>ipv6</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-17" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#前缀匹配" class="md-toc-link"><p>前缀匹配</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-18" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#路由映射" class="md-toc-link"><p>路由映射</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-19" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#pbrpolicy-based-routing条件转发" class="md-toc-link"><p>PBR(Policy-Based Routing,条件转发)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-20" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#object-track" class="md-toc-link">
            <p>object track</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#fhrp" class="md-toc-link"><p>FHRP</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#hsrp" class="md-toc-link"><p>HSRP</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#hsrp配置" class="md-toc-link">
            <p>HSRP配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#vrrp" class="md-toc-link"><p>VRRP</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#vrrp-configure" class="md-toc-link">
            <p>VRRP configure</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#glbp" class="md-toc-link"><p>GLBP</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#glbp-configure" class="md-toc-link">
            <p>glbp configure</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-8" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#multicast" class="md-toc-link"><p>multicast</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#igmpv2-and-v3" class="md-toc-link"><p>IGMPv2 and v3</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#igmp-snooping" class="md-toc-link"><p>IGMP snooping</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ip-to-mac" class="md-toc-link">
            <p>ip to mac</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#pim" class="md-toc-link"><p>PIM</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#dense-modepim-dm" class="md-toc-link">
            <p>Dense mode(PIM-DM)</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#spare-mode" class="md-toc-link"><p>Spare mode</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#rpf" class="md-toc-link">
            <p>RPF</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#rp" class="md-toc-link">
            <p>RP</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#pim-forwarder" class="md-toc-link">
            <p>PIM forwarder</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#lan" class="md-toc-link"><p>LAN</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#vlan" class="md-toc-link"><p>VLAN</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-21" class="md-toc-link">
            <p>配置</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#语音vlan" class="md-toc-link">
            <p>语音vlan:</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#trunk" class="md-toc-link"><p>trunk</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-22" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#vtp" class="md-toc-link"><p>VTP</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-23" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#交换机堆栈和机框汇聚" class="md-toc-link"><p>交换机堆栈和机框汇聚</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#堆栈" class="md-toc-link">
            <p>堆栈</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#机框汇聚chassis-aggregation" class="md-toc-link">
            <p>机框汇聚(chassis aggregation)</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#stp-rstprapid-and-pvst" class="md-toc-link"><p>STP, RSTP(rapid) and PVST</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#bpdu" class="md-toc-link">
            <p>BPDU</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#mst" class="md-toc-link"><p>MST</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-24" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#topology-change" class="md-toc-link">
            <p>Topology change</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#原理" class="md-toc-link">
            <p>原理</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#configure" class="md-toc-link">
            <p>configure</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#特性" class="md-toc-link"><p>特性</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-etherchannel8023ad" class="md-toc-link">
            <ol>
<li>EtherChannel(802.3AD)</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-portfast" class="md-toc-link">
            <ol start="2">
<li>PortFast</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-bpdu-guard" class="md-toc-link">
            <ol start="3">
<li>BPDU guard</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4端口类型" class="md-toc-link">
            <p>4.端口类型</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#5-root-guard" class="md-toc-link">
            <ol start="5">
<li>root guard</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#6-bpdu-filter" class="md-toc-link">
            <ol start="6">
<li>bpdu filter</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#7-loop-guard" class="md-toc-link">
            <ol start="7">
<li>loop guard</li>
</ol>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-25" class="md-toc-link">
            <p>配置</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-9" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#端口安全" class="md-toc-link"><p>端口安全</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-26" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#排错-10" class="md-toc-link"><p>排错</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#stp" class="md-toc-link">
            <p>STP</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#etherchannel" class="md-toc-link">
            <p>EtherChannel</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#trunk-1" class="md-toc-link">
            <p>Trunk</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#其他" class="md-toc-link"><p>其他</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-27" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#wireless" class="md-toc-link"><p>Wireless</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#theory" class="md-toc-link">
            <p>theory</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#infrastructure" class="md-toc-link"><p>infrastructure</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ap-states" class="md-toc-link">
            <p>AP states</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#wireless-configure" class="md-toc-link">
            <p>wireless configure</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#roam-and-locate" class="md-toc-link"><p>roam and locate</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#roam-domain" class="md-toc-link">
            <p>roam domain</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#locate" class="md-toc-link">
            <p>locate</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#authentication" class="md-toc-link">
            <p>authentication</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#hierarchichal-lan-design-model" class="md-toc-link"><p>hierarchichal LAN Design Model</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#high-availability-technologies" class="md-toc-link">
            <p>High Availability Technologies</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-11" class="md-toc-link">
            <p>排错</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#sdasoftware-define-access" class="md-toc-link"><p>SDA(software define access)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#fabric-overlay" class="md-toc-link">
            <p>fabric overlay</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#wan" class="md-toc-link"><p>WAN</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#hdlc" class="md-toc-link"><p>HDLC</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-28" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ppp" class="md-toc-link"><p>PPP</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#认证" class="md-toc-link"><p>认证</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-29" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#多链路支持" class="md-toc-link"><p>多链路支持</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-30" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-12" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#vrf-litevirtual-routing-and-forwarding" class="md-toc-link"><p>VRF-lite(virtual routing and forwarding)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-31" class="md-toc-link">
            <p>配置</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-13" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#mpls" class="md-toc-link"><p>MPLS</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#header" class="md-toc-link">
            <p>header</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ldplabel-distribute-protocol" class="md-toc-link"><p>LDP(label distribute protocol)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#configuration-1" class="md-toc-link">
            <p>configuration</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#mpls-vpn" class="md-toc-link"><p>MPLS VPN</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#data-plane" class="md-toc-link">
            <p>data plane</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#configuration-2" class="md-toc-link">
            <p>configuration</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-14" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#sd-wan" class="md-toc-link"><p>SD-WAN</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#sd-wan-cloud" class="md-toc-link">
            <p>SD-WAN cloud???</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#internet-and-vpn" class="md-toc-link"><p>Internet and VPN</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#gre" class="md-toc-link">
            <p>GRE</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#nhrp" class="md-toc-link">
            <p>NHRP</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#dmvpn阶段" class="md-toc-link">
            <p>DMVPN阶段</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#nhrp路由控制" class="md-toc-link">
            <p>NHRP路由控制</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#fvrf" class="md-toc-link">
            <p>FVRF</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ipsec" class="md-toc-link"><p>IPsec</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#site-to-site-ipsec" class="md-toc-link"><p>site-to-site ipsec</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#transform-set" class="md-toc-link">
            <p>transform set</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#预共享密钥认证" class="md-toc-link">
            <p>预共享密钥认证</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-32" class="md-toc-link">
            <p>配置</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-15" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#lispcisco-locatorid-separation-protocol" class="md-toc-link"><p>LISP(Cisco Locator/ID Separation Protocol)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#architecture" class="md-toc-link">
            <p>architecture</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#operation" class="md-toc-link">
            <p>Operation</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#vxlan" class="md-toc-link">
            <p>Vxlan</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#pppoe" class="md-toc-link"><p>PPPoE</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-33" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#qos" class="md-toc-link"><p>QOS</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#models" class="md-toc-link"><p>models</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#分类和标记" class="md-toc-link"><p>分类和标记</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#nbar2" class="md-toc-link">
            <p>NBAR2</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#mark" class="md-toc-link">
            <p>mark</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#拥塞控制队列-和-避免" class="md-toc-link">
            <p>拥塞控制(队列) 和 避免</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#整形和限速policing-and-shaping" class="md-toc-link"><p>整形和限速(policing and shaping)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#token-bucket-algorithms" class="md-toc-link">
            <p>Token Bucket Algorithms</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#policers" class="md-toc-link">
            <p>policers</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#modular-qos-climqc" class="md-toc-link"><p>Modular QoS CLI(MQC)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#configure-1" class="md-toc-link">
            <p>configure</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#netflow" class="md-toc-link"><p>netflow</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#configure-2" class="md-toc-link">
            <p>configure</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#show" class="md-toc-link">
            <p>show</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#security" class="md-toc-link"><p>security</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#attack-continuum" class="md-toc-link">
            <p>attack continuum</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#next-generation-endpoint-security" class="md-toc-link">
            <p>next-generation endpoint security</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#nacnetwork-access-control" class="md-toc-link"><p>NAC(network access control)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#8021x" class="md-toc-link">
            <p>802.1x</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#mabmac-authentication-bypass" class="md-toc-link">
            <p>MAB(MAC authentication bypass)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#web-authentication" class="md-toc-link">
            <p>web authentication</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#flexauthflexvible-authentication" class="md-toc-link">
            <p>FlexAuth(Flexvible authentication)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ibns20identity-based-networking-services" class="md-toc-link">
            <p>IBNS2.0(identity-based networking services)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#cisco-trustsec" class="md-toc-link">
            <p>Cisco trustsec</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#macsec" class="md-toc-link">
            <p>MACsec</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#aaaauthenticationauthenrization-and-accounting" class="md-toc-link"><p>aaa(authentication,authenrization and accounting)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#aaa配置" class="md-toc-link">
            <p>aaa配置</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-16" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#coppcontrol-plane-policing" class="md-toc-link"><p>CoPP(control plane policing)</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#configure-3" class="md-toc-link">
            <p>configure</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#verify" class="md-toc-link">
            <p>verify</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#device-hardening" class="md-toc-link">
            <p>device hardening</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#snmpsimple-network-manage-protocol" class="md-toc-link"><p>SNMP(simple network manage protocol)</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#配置-34" class="md-toc-link"><p>配置</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#snmpv2c" class="md-toc-link">
            <p>SNMPv2c</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#snmpv3" class="md-toc-link">
            <p>SNMPv3</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ip-sla-and-span" class="md-toc-link"><p>IP SLA and SPAN</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ip-sla" class="md-toc-link">
            <p>IP SLA</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#spanswitched-port-analyzer" class="md-toc-link">
            <p>SPAN(switched port analyzer)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#命令" class="md-toc-link">
            <p>命令</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#排错-17" class="md-toc-link">
            <p>排错</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#aas-and-虚拟网络功能和服务" class="md-toc-link">
            <p>aas and 虚拟网络功能和服务</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#sdn" class="md-toc-link"><p>SDN</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#virtualization" class="md-toc-link"><p>virtualization</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#io-technologies" class="md-toc-link">
            <p>IO technologies</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#enfvcisco-enterprise-nfv" class="md-toc-link">
            <p>ENFV(cisco enterprise NFV)</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#杂项" class="md-toc-link"><p>杂项</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#tcamternary-content-addressable-memory" class="md-toc-link">
            <p>TCAM(ternary content addressable memory)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#traceroute" class="md-toc-link">
            <p>traceroute</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#bfd" class="md-toc-link"><p>BFD</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#配置-35" class="md-toc-link">
            <p>配置</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#automation" class="md-toc-link"><p>Automation</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#guestshell" class="md-toc-link"><p>guestshell</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#configuration-3" class="md-toc-link">
            <p>configuration</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#use" class="md-toc-link">
            <p>use</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#urpf" class="md-toc-link">
            <p>uRPF</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#dev" class="md-toc-link"><p>dev</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#data-model" class="md-toc-link"><p>data model</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#yang" class="md-toc-link">
            <p>YANG</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#netconf" class="md-toc-link">
            <p>NETCONF</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#restconf" class="md-toc-link">
            <p>RESTCONF</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
</div>
<h1 id="tcpip-and-osi">TCP/IP and OSI </h1>
<ol>
<li>应用层
<ol>
<li>应用层</li>
<li>表示层</li>
<li>会话层</li>
</ol>
</li>
<li>传输层-transport:TCP,UDP.提供一个基于ip的可靠传输协议TCP和努力交付的UDP</li>
<li>网络层-network:IP.实现对数据来源去向的定位和路由</li>
<li>数据链路
<ol>
<li>数据链路层:Ethernet,HDLC.实现对数据的基本的帧控制,差错校验等,使用MAC地址定位.</li>
<li>物理层:Ethernet.完成从物理设备模拟信号到数字信号的变换.<br>
不同设备之间same-layer interaction(相同层交互),同一设备上adjacent-layer interaction(不同层交互).较底层为较高层提供服务,自底层向高层封装数据包,高层自底层解封数据包.数据段(segmen)对应传输层,数据包(packet)对应网络层,帧(frame)对应链路层.</li>
</ol>
</li>
</ol>
<h2 id="arpaddress-resolution-protocol">arp(Address Resolution Protocol) </h2>
<p>连接网络层和数据链路层的协议,提供根据ip查询MAC地址的服务.</p>
<h2 id="电缆引脚">电缆引脚 </h2>
<p>相同:交叉电缆<br>
不同:直连电缆</p>
<table>
<thead>
<tr>
<th>1,2</th>
<th>3,6</th>
</tr>
</thead>
<tbody>
<tr>
<td>PC网卡</td>
<td>集线器</td>
</tr>
<tr>
<td>路由器</td>
<td>交换机</td>
</tr>
<tr>
<td>AP</td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="cli相关">CLI相关 </h1>
<p>IOS的命令行界面称为CLI.CLI有三种模式,USER模式,EXEC(也叫特权)模式,配置模式(分为很多种不同的配置模式),接口模式(配置模式的一种,但我觉得比较特别).刚进入时,为用户模式,使用enable指令进入EXEC模式,EXEC模式通常是使用各种show命令查看设备信息.EXEC模式下使用configure terminal进入全局配置模式,全局配置模式下可使用各种配置命令进入不同的子项配置模式,也可以使用interface指令单独配置某一接口,使用interface range <code>interface</code> <code>num1</code>/<code>num2</code> <code>num3</code>进入更多接口.在配置模式中要使用show命令可以使用do show</p>
<p>交换机有三种连接方式,console口,auxiliary port line,virtual terminal(vty)(like Telnet和ssh).Telnet明文传输信息,不安全.要想使用ssh连接,需要给设备配置ip地址,一般在vlan接口处配置,也可以使用DHCP自动获取.</p>
<h2 id="password-type">password type: </h2>
<ul>
<li>type 0:plain text;not recommend(by default)
<ul>
<li><em>enable password</em></li>
</ul>
</li>
<li>type 7:use weak encryption algorithm;not recommend
<ul>
<li><em>service password-encryption</em></li>
</ul>
</li>
<li>type 5:use MD5 hashing;not recommend
<ul>
<li><em>enable secret</em></li>
</ul>
</li>
<li>type 8:use SHA-256 hashed secret and password salting.recommend</li>
<li>type 9:recommonded by cisco</li>
</ul>
<h2 id="privilege">privilege </h2>
<ul>
<li>level 0:<em>disable,enable,exit,help,logout</em></li>
<li>level 1:USER EXEC mode,no configure terminal</li>
<li>level 15:privileged EXEC mode.</li>
</ul>
<h2 id="配置密码">配置密码 </h2>
<p>配置模式(默认全局配置模式,for old version):</p>
<ul>
<li>共享密码
<ol>
<li>enable [password|secret] <code>password-value</code>(!特权模式密码)</li>
<li>line console 0</li>
<li>enable [password|secret] <code>password-value2</code>(!console线密码)</li>
<li>login</li>
<li>line aux 0</li>
<li>login</li>
<li>line vty 0 4(!编号0-4)(!进入vty线路模式)</li>
<li>enable [password|secret] <code>password-value3</code>(!telnet登入密码)</li>
<li>login</li>
</ol>
</li>
<li>用户名密码对<!-- 1. username `name` {password|[algorithm-type {md5|sha256|scrypt}] secret} `password`(!*password* for type 0,*secret* for type 5,and *algorithm* for type 8 or 9) -->
<ol>
<li>username <code>name</code> {secret|password} [<code>level</code>] <code>password</code>
<ol>
<li>(!can set a privilege level for which commands they can use here)</li>
</ol>
</li>
<li>line con 0
<ol>
<li>exec-timeout <code>minites</code> <code>seconds</code></li>
<li>login loacl</li>
</ol>
</li>
<li>line aux 0
<ol>
<li>login local</li>
<li>(!可选)no password(!删除共享密码)</li>
</ol>
</li>
<li>line vty 0 4
<ol>
<li>access-class {<code>acl-num</code>|<code>acl-name</code>} {in|out}</li>
<li>transport input {all|none(!默认值)|telnet|ssh|telnet ssh}</li>
<li>login local</li>
<li>(!可选)no password(!删除共享密码)</li>
</ol>
</li>
</ol>
</li>
</ul>
<h2 id="配置ssh">配置ssh </h2>
<p>配置模式:</p>
<ol>
<li>hostname <code>name</code></li>
<li>ip domain-name <code>domain-name</code></li>
<li>crypto key generate rsa [modulus <code>modulus</code>] (!生成rsa公私钥)(!sshv2至少需要768位密钥,IOS XE 17.11.1 need least 2048 bits)</li>
<li>(!可选)ip ssh version 2</li>
</ol>
<h2 id="其他命令">其他命令 </h2>
<p>配置模式:</p>
<ul>
<li>write(!保存配置)</li>
<li>save(!GNS3中vpc保存配置)</li>
<li>(!rotary,allow ssh or telnet use other port)
<ul>
<li>ip tcp port <code>port</code> rotary <code>rotary-group</code></li>
<li>line <code>line</code> <code>line-num</code></li>
<li>rotary <code>rotary-group</code></li>
</ul>
</li>
</ul>
<h2 id="排错">排错 </h2>
<ol>
<li>console
<ol>
<li>正确的com端口,一般是最后一个</li>
<li>终端程序:9600波特,8数据比特,1停止比特</li>
<li>login或login local或login authentication</li>
</ol>
</li>
<li>telnet
<ol>
<li>ip可达</li>
<li>login或login local或login authentication</li>
<li>默认5条vty线路</li>
<li>acl是否阻塞tcp端口23</li>
</ol>
</li>
<li>ssh
<ol>
<li>ssh版本要匹配</li>
<li>login local或login authentication(aaa)</li>
<li>sshv2,密钥长度要大于768</li>
<li>tcp端口22</li>
</ol>
</li>
</ol>
<h2 id="log">log </h2>
<p>日志消息默认发送给通过console方式连接的用户,日志有不同的严重等级,0~7严重  等级依次递减.等级7代表debug消息.</p>
<table>
<thead>
<tr>
<th>keyword</th>
<th>level</th>
</tr>
</thead>
<tbody>
<tr>
<td>emergencies</td>
<td>0</td>
</tr>
<tr>
<td>alerts</td>
<td>1</td>
</tr>
<tr>
<td>critical</td>
<td>2</td>
</tr>
<tr>
<td>errors</td>
<td>3</td>
</tr>
<tr>
<td>warnings</td>
<td>4</td>
</tr>
<tr>
<td>notifications</td>
<td>5</td>
</tr>
<tr>
<td>informational</td>
<td>6</td>
</tr>
<tr>
<td>debugging</td>
<td>7</td>
</tr>
</tbody>
</table>
<h3 id="配置">配置 </h3>
<p>配置模式:</p>
<ul>
<li>logging monitor(!在IOS中启用向终端发送日志的功能)</li>
<li>terminal monitor EXEC(!终端中使用表示希望接收日志)</li>
</ul>
<h2 id="debug">debug </h2>
<p>debug是和show类似的有大量可选项的命令,但很消耗计算资源,在实际生产中小心或避免使用.</p>
<ul>
<li>debug结束使用<strong>undedbug all</strong>指令.</li>
<li>debug 按接口条件过滤时,要结束需要额外使用undebug interface <code>interface</code></li>
</ul>
<p>(最好先在测试环境使用)</p>
<h3 id="configuration">configuration </h3>
<ol>
<li>debug interface <code>interface</code>
<ol>
<li>debug <code>args</code></li>
</ol>
</li>
</ol>
<h2 id="环回接口">环回接口 </h2>
<p>环回接口不是ip地址中的127.0.0.1环回接口,是IOS中可以创建的虚拟接口,可以分配ip并被路由,并且总是up/up状态,不能shutdown.</p>
<h3 id="配置-1">配置 </h3>
<p>配置模式:</p>
<ul>
<li>interface loopback <code>num</code>(!任意整数)</li>
<li>(!之后可以和普通接口一样进行配置)</li>
</ul>
<h1 id="ip">IP </h1>
<ol>
<li>
<p><strong>路由信息源</strong>：<br>
路由信息源指的是路由信息的来源，可以包括直接连接的网络、静态路由配置、或是各种动态路由协议（如OSPF、BGP、EIGRP等）收 集的路由信息。这些信息源提供了网络中可达性信息的原始数据。</p>
</li>
<li>
<p><strong>RIB（Routing Information Base，路由信息库）</strong>：<br>
RIB是路由器内部用来存储路由信息的数据库，它包含了从各种路由信息源收集来的所有路由信息。RIB中的信息包括目的网络、下一跳地址、路由的成本（如跳数、带宽等）以及路由的其他属性。路由器会根据预设的路由选择协议（如最短路径优先、路径成本最低等）从RIB中选择最优的路由信息用于构建FIB。</p>
</li>
<li>
<p><strong>FIB（Forwarding Information Base，转发信息库）</strong>：<br>
FIB是基于RIB选出的最优路由构建的，用于实际的数据包转发。FIB通常只包含用于数据包转发决策的必要信息，如目的IP地址范围、下一跳地址和出接口。FIB是高效的，优化了查找速度，以便快速处理经过路由器的数据包。</p>
<p>FIB是最佳路由的路由表,多播路由(例如ospf的hello消息),直连主机等信息.使用FIB会直接使用邻接表构建帧头.</p>
<table>
<thead>
<tr>
<th>Network</th>
<th>Prefix</th>
<th>Adjacency</th>
</tr>
</thead>
</table>
</li>
<li>
<p><strong>Adjacancy Table</strong></p>
<table>
<thead>
<tr>
<th>IP Address</th>
<th>NetHop Mac</th>
<th>Interface</th>
<th>Egress MAC</th>
</tr>
</thead>
</table>
</li>
<li>
<p><strong>路由表</strong>：<br>
通常情况下，"路由表"这个术语可以指RIB或者是FIB，具体取决于上下文。在许多文档和命令行界面中，<strong>当我们查看“路由表”时，通常是在查看RIB</strong>，它展示了路由器知道的所有路由信息。而FIB有时被称为“转发表”或者直接是“FIB”。</p>
</li>
</ol>
<p>ip地址用于定位,通过路由实现.路由是查找路由表,最长前缀优先的过程.</p>
<p>在转发查询mac地址时,查询路由表和arp缓存比较低效,cisco的CEF(cisco Express Forwarding)提供了FIB和邻接表加速此过程.</p>
<h2 id="cef">CEF </h2>
<p>three types of packets require software handling</p>
<ol>
<li>sourced or destined to the router(using control traffic or routing protocol)</li>
<li>too complex(with IP options)</li>
<li>unresolved arp entries</li>
</ol>
<h2 id="address-resolution-protocolarp">Address Resolution Protocol(ARP) </h2>
<p>mapping layer 3 ip address to layer 2 mac address.Just contain next-hop to reach.</p>
<h3 id="排错-1">排错 </h3>
<p>show ip arp [<code>mac-address</code>|<code>ip-address</code>|vlan <code>vlan-id</code>|<code>interface-id</code>]</p>
<h2 id="adadministrative-distance">AD(Administrative Distance) </h2>
<p>路由器可以从路由协议,静态路由,直连路由中接收信息填充路由表,各种协议和信息之间有优先级的差别,称为AD(管理距离).<br>
<span id="AD-TABLE"></span></p>
<table>
<thead>
<tr>
<th>信息源</th>
<th>AD</th>
</tr>
</thead>
<tbody>
<tr>
<td>直连</td>
<td>0</td>
</tr>
<tr>
<td>静态</td>
<td>1</td>
</tr>
<tr>
<td>EIGRP汇总</td>
<td>5</td>
</tr>
<tr>
<td>eBGP</td>
<td>20</td>
</tr>
<tr>
<td>EIGRP(内部)</td>
<td>90</td>
</tr>
<tr>
<td>OSPF</td>
<td>110</td>
</tr>
<tr>
<td>IS-IS</td>
<td>115</td>
</tr>
<tr>
<td>RIP</td>
<td>120</td>
</tr>
<tr>
<td>ODR???</td>
<td>160</td>
</tr>
<tr>
<td>EIGRP(外部)</td>
<td>170</td>
</tr>
<tr>
<td>IBGP</td>
<td>200</td>
</tr>
<tr>
<td>未知</td>
<td>255</td>
</tr>
</tbody>
</table>
<h3 id="配置-2">配置 </h3>
<ol>
<li>router {eigrp|ospf|bgp}</li>
<li>distance {eigrp <code>ad-internal</code> <code>ad-external</code>|ospf {external|inter-area|intra-area} <code>ad</code>|bgp <code>external-ad</code> <code>internal-ad</code> <code>local-routes</code>}<br>
或在各进程下,bgp需要进地址簇:<br>
distance <code>ad</code> <code>source-ip</code>(!邻居ip???) <code>source-ip-wildcard</code>(!OSPF时匹配邻居RID???) [<code>acl-number</code>|<code>acl-name</code>]</li>
</ol>
<ul>
<li>这条指令EIGRP只会修改学到的内部路由的AD值</li>
</ul>
<p><strong>修改AD需要非常小心</strong></p>
<h2 id="ip地址">ip地址 </h2>
<p>无子网掩码时使用网络类别,不然ip地址&amp;子网掩码为子网网络地址.</p>
<h3 id="网络类别">网络类别 </h3>
<ul>
<li>A:0.0.0.0 到 127.255.255.255 (0.0.0.0 用于表示当前主机，而 127.0.0.0 子网是用于本地回环测试的回环地址).10.0.0.0子网作为私有地址</li>
<li>B:128.0.0.0 到 191.255.255.255, 172.16.0.0 ~ 172.31.0.0作为私有地址</li>
<li>C:192.0.0.0 到 223.255.255.255, 192.168.0.0 ~ 192.168.255.255作为私有地址</li>
</ul>
<h2 id="子网掩码">子网掩码 </h2>
<p>在同一个子网中,为不同网段使用不同掩码称为VLSM(变长子网掩码),计算是否有重叠只需计算子网广播地址是否有重叠即可.为一个子网添加一个VLSM子网,需要列出可能的子网和其广播地址,然后计算已经存在的子网和其广播地址,查看是否有冲突.格式有三种:二进制,DDN(点分十进制),CIDR(前缀)</p>
<p>魔法数字=256-非255非0掩码<br>
子网ID:魔法数字倍数中最接近并小于等于IP地址的一项(从0开始)<br>
子网广播地址:子网ID+魔法数字-1</p>
<table>
<thead>
<tr>
<th>mod8</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
</tr>
</thead>
<tbody>
<tr>
<td>DDN</td>
<td>255</td>
<td>128</td>
<td>192</td>
<td>224</td>
<td>240</td>
<td>248</td>
<td>252</td>
<td>254</td>
</tr>
</tbody>
</table>
<h3 id="配置-3">配置 </h3>
<p>配置模式:</p>
<ul>
<li>ip route <code>destination-address</code> <code>destination-maslk</code> {<code>inter</code> <code>ip</code>}  [<code>ad-value</code>]</li>
<li>(!when <code>inter</code> and <code>ip</code> are set it is called Fully specified static route)</li>
<li>(!when <code>ad-value</code> is set it is called floating static route)</li>
<li>(!静态路由目的地址为以太网时,不要使用接口,因为为频繁使用arp查询mac地址导致性能降低)<br>
接口模式:</li>
<li>ip address <code>address</code> <code>mask</code> [secondary]</li>
</ul>
<h2 id="ipv6">IPv6 </h2>
<ul>
<li>icmp升级为icmpv6,NDP(邻居发现协议)(Neighbor Discovery Protocol)代替ARP.<br>
NDP有发现路由器,发现地址信息.路由器会被要求(RS)通告(RA)自己的信息,主机通过这两种消息获取路由器信息;NS(邻居请求)和NA(邻居通告)如同arp,要求某个ipv6主机回答MAC地址,并且可以利用其检查出重复地址,这个过程叫DAD.NDP使用的是本地链路地址.</li>
<li>主要是ipv6的缩写形式./64是默认的前缀.</li>
<li>动态获取地址的方式除了DHCPv6之外多了SLAAC.<br>
当一台主机使用SLAAC时,它需要使用NDP RS/RA消息从路由器获知ipv6前缀,然后使用EUI-64或随机生成后缀,再使用DAD确保这个地址没有被使用.NDP提供了地址前缀,前缀长度,和默认路由器的信息,最后使用无状态DHCPv6提供DNS服务器即完成了主机的网络设置.</li>
<li>路由器不是默认开启ipv6的,需要手动开启.</li>
<li>多了任播地址,几台执行相同功能的设备可以使用相同的ipv6地址.路由器只需选择离自己最近的.</li>
<li>本地链路地址对于ipv6路由来说是必要的.一般会自动生成.但手动创建接口时是一个不应该忘记的强制选项.(子接口???,tunnel,pppoe)</li>
</ul>
<table>
<thead>
<tr>
<th>地址类型</th>
<th>前几位16进制数</th>
</tr>
</thead>
<tbody>
<tr>
<td>全局单播</td>
<td>2或3</td>
</tr>
<tr>
<td>本地唯一</td>
<td>FD</td>
</tr>
<tr>
<td>本地链路</td>
<td>FE80</td>
</tr>
<tr>
<td>multicast</td>
<td>EF02</td>
</tr>
<tr>
<td>6 to 4</td>
<td>2002::/16</td>
</tr>
</tbody>
</table>
<h3 id="eui-64">eui-64 </h3>
<ol>
<li>左24位mac:fffe:右24位mac</li>
<li>对第7位取反(第二个数能减8减8,能减4减4,之后大于等于2的减2,不然加2)</li>
<li>都以fe80开头<br>
例如:<br>
MAC:08-00-27-5D-06-D6<br>
ipv6:fe80:0a00:27ff:fe5d:6d6</li>
</ol>
<h3 id="配置-4">配置 </h3>
<p>配置模式:</p>
<ul>
<li>ipv6 unicast-routing(!启用ipv6路由)<br>
接口模式:</li>
<li>ipv6 address <code>address</code>/<code>prefix-length</code>(!可以重复多次以在同一个接口上添加多个ipv6子网)</li>
<li>ipv6 address <code>前缀</code>(!如:2001:db8:a:a::/64) eui-64(!使用eui-64自动生成主机地址)</li>
<li>ipv6 address autoconfig(!启用SLAAC)</li>
</ul>
<h3 id="第一跳安全">第一跳安全 </h3>
<ul>
<li>RA保护
<ul>
<li>ipv6 nd raguard attach-policy [<code>name</code> [vlan {add|except|none|remove|all} <code>vlan</code>] ]</li>
</ul>
</li>
<li>DHCPv6保护
<ul>
<li>ipv6 dhcp guard attach-policy [<code>name</code> [vlan {add|except|none|remove|all} <code>vlan</code>] ]</li>
</ul>
</li>
<li>绑定表</li>
<li>ipv6 ND监听</li>
<li>源保护</li>
</ul>
<h2 id="dhcp">DHCP </h2>
<p>DHCP(dynamic host configuration protocol 动态主机配置协议)是用于自动配置ip,掩码,网关,dns的协议.DHCP设备分为3中,客户端,中继端和服务端.建议DHCP采用集中式设计,需要DHCP服务器的子网使用中继,更好控制和配置所能分配的ip地址.由于路由本身就需要知道各个网络该如何去,所以dhcp自动分配ip地址虽然有服务器功能,但设计还是仔细考虑各个子网的ip池,即子网划分.</p>
<p>客户端使用0.0.0.0作为源ip地址,255.255.255.255发送Discover(发现)消息,服务端会回复一个Offer(提供)消息通告可以分配的地址和其他参数.客户端收到Offer后会发送Request(请求)消息请求ip地址,如果能够分配,服务端会回复Acknowledge(确认)消息,分配ip,掩码,默认路由器,dns等.</p>
<p>中继会不断接收客户端信息并将源ip改为自己的ip,目的ip改为设置的helper-ip,路由数据包到服务端.</p>
<p>服务端有三种分配模式,动态分配(可用ip作为一个池,不断租用ip给客户端),自动分配(租用时间为无限)和静态分配(根据mac地址分配ip,已被分配ip不会再被分配).</p>
<h3 id="ipv6-1">ipv6 </h3>
<p>在ipv6中,DHCP升级为DHCPv6,不再为主机通告默认路由器,默认路由器由主机使用NDP协议发现.</p>
<h3 id="配置-5">配置 </h3>
<ul>
<li>中继
<ol>
<li>ip dhcp relay information trust-all</li>
<li>ip dhcp relay information option</li>
<li>interface <code>interface</code></li>
<li>ip helper-address <code>server-ip</code>(!在连接主机的接口上)</li>
</ol>
</li>
<li>服务端<br>
配置模式:
<ol>
<li>ip dhcp excluded-address <code>first</code> <code>last</code>(!排除掉的地址,必须排除掉路由器接口已占有的那些地址)</li>
<li>ip dhcp pool <code>name</code>(!进入dhcp池配置模式)</li>
<li>network <code>subnet-ip</code> {<code>mask</code>|<code>prefix-length</code>}(!池中子网)</li>
<li>default-router <code>address1</code> <code>address2</code>(!默认路由器)</li>
<li>dns-server <code>address1</code> <code>address2</code>(!默认dns服务器)</li>
</ol>
 <!-- 6. (!可选)lease `days` `hours` `minutes`(设置ip租期)
 6. (!可选)domain-name `name`
 7. (!可选)nest-server `ipaddress`(TFTP服务器地址) -->
</li>
</ul>
<h3 id="排错-2">排错 </h3>
<ol>
<li>由于discover消息是广播的,所以dhcp服务器和主机应当在同一子网,不然就要使用中继,中继要与dhcp服务器同一子网</li>
<li>地址池耗尽</li>
<li>dhcp服务器冗余设置时,互相之间要能通信(???)</li>
<li>使用show ip dhcp conflict显示重复ip,然后使用clear ip dhcp conflict *清除分配记录</li>
<li>使用show ip dhcp binding显示分配情况,clear ip dhcp binding *清除分配情况</li>
<li>debug ip dhcp server {events|packets}</li>
</ol>
<h3 id="dhcp-snooping">DHCP snooping </h3>
<p>DHCP有可能会被欺骗攻击,可以使用DHCP snooping.会将信任端口(手动配置)的所有dhcp消息放行,不信任(终端)端口的DHCP服务器消息(OFFER和ACK)过滤,客户端消息经过DHCP绑定表判定,判定成功继续填充表.</p>
<h4 id="配置-6">配置 </h4>
<p>配置模式:</p>
<ol>
<li>ip dhcp snooping</li>
</ol>
<h2 id="nat">NAT </h2>
<p>私有地址在网络中不被路由,无法定位.使用NAT技术,可以在子网内使用私有地址定位,需要连接到Internet时,将私有地址转换为可路由的单播地址.具体来说,是将ip数据报中的源修改为单播地址,PAT还会修改端口号,此时路由器还需要记住这个映射关系.思科将这个私有地址称为Inside Local(内部本地),这个单播地址(commonly address of router outside interface)称为Inside Global(内部全局).When using outside nat,outiside local means the ip addresses appears to the inside network.Outside global is the true outside address.当内部全局地址耗尽时,路由器会丢弃无法进行地址转换的包.ACL会在转换前匹配.</p>
<p>NAT分为三种,静态NAT,动态NAT和PAT(Port address translation).There are two types of each,inside(source) and outside(destination) NAT.</p>
<p>静态NAT只是单纯的为内部本地地址和内部全局地址做了映射,并且每一个映射需要手动配置.</p>
<p>动态NAT有一个可使用的内部全局地址池,自动完成内部本地到全局的映射,设置有分配超时时间.比静态映射稍微好一点点,所需要的内部全局地址数约等于内部本地同时访问Internet的数量.</p>
<p>PAT基于TCP和UDP有65535个端口,其中真正被使用的很少,所以可以通过对ip+端口同时建立动态映射来达到少量内部全局地址支持大量内部本地地址同时访问Internet.</p>
<p>Inside nat is common nat,translate source ip address when sending,and destination when receiving.Outside translate destination address when sending and source when receiving,used not very common.</p>
<h3 id="配置-7">配置 </h3>
<p>接口模式(设置nat内部和外部接口,所有NAT都需要):</p>
<ul>
<li>ip nat inside</li>
<li>ip nat outside</li>
<li>静态NAT
<ul>
<li>ip nat inside source static <code>inside-local</code> <code>inside-golbal</code> [extendable (!allow one inside local address map multiple inside global address)]
<ul>
<li>ip nat inside source static tcp <code>inside-local</code> <code>port</code> <code>inside-golbal</code> <code>port</code> [extendable]</li>
</ul>
</li>
<li>ip nat outside source static <code>outside-global</code> <code>outside-local</code></li>
</ul>
</li>
<li>动态NAT
<ul>
<li>ip nat pool <code>pool-name</code> <code>first-address</code> <code>last-address</code> netmask <code>submask-mask</code></li>
<li>ip nat inside source list <code>acl-number</code> pool <code>pool-name</code></li>
</ul>
</li>
<li>PAT
<ul>
<li>ip nat pool <code>pool-name</code> <code>first-address</code> <code>last-address</code> netmask <code>submask-mask</code></li>
<li>ip nat inside source list <code>acl-number</code> {pool <code>pool-name</code>|interface <code>type/number</code> overload}</li>
</ul>
</li>
</ul>
<h2 id="ntp">NTP </h2>
<p>网络设备需要使用NTP(网络时间协议)来进行时钟的同步,use UDP protocol with 123 port,NTP协议中,设备分为服务端和客户端,客户端接收服务端的时钟信息并修改自身时钟,设备可以同时充当服务端和客户端.存在多个服务端时,优先级级别低者优先设备时间设置为接近的时间,再进行NTP的配置,效果更好.</p>
<h3 id="stratum">stratum </h3>
<p>quering a stratum 1 server is considered stratum 2 client.when setting multiple stratums,lower stratum is prefered.</p>
<h3 id="配置-8">配置 </h3>
<ul>
<li>
<p>时间<br>
配置模式:</p>
<ul>
<li>clock timezone EST(!可以是任何值,但最好有意义.EST美国东部时间) <code>offset</code>(!常数,意为相比UTC(!世界协调时)多offset小时,可以为负数)</li>
<li>clock summer-time EDT(同EST) recurring</li>
</ul>
<p>EXEC:</p>
<ul>
<li>clock set 20:59:49(!时:分:秒) October(!月) 2020(!年)</li>
</ul>
</li>
<li>
<p>NTP<br>
配置模式:</p>
<ul>
<li>(!客户端)ntp server {<code>ip</code>|<code>hostname</code>} [prefer] [source <code>interface</code>] (!指定NTP服务器用于发送和接收NTP时间同步信息的网络接口,最好使用环回接口)</li>
<li>(!服务端)ntp master <code>stratum-number</code>(!越低越优先)</li>
<li>ntp peer <code>ip-address</code>(!ntp peers act as clients and servers to each other,meaning they try to blend their to each other)</li>
</ul>
</li>
</ul>
<p>log file will contain a * next to the date if not configured a NTP.</p>
<h2 id="ptpprecicsion-time-protocol">PTP(Precicsion Time Protocol) </h2>
<p>more precise than NTP.</p>
<p>after PTP is enabled in Boundary mode,all enabled poorts on connecting switches will automatically have PTP enabled.</p>
<p>configuration varies depending on the device type.</p>
<h2 id="igpripv2-ospf-eigrp-is-is-and-egpebgp">IGP(RIPv2, OSPF, EIGRP, IS-IS) and EGP(eBGP) </h2>
<p>路由器之间学习路由,通告路由,选择路由,收敛路由的协议.静态路由和直连路由的信息不会用于更新路由协议的数据结构,只有邻居消息,入站路由信息,重分发路由信息会.</p>
<p>路由协议分为内部网关协议(IGP,适用于自洽系统(AS)内部)和外部网关协议(EGP,适用于不同自洽系统之间)<br>
对于IGP,路由协议算法分为三大类:</p>
<ul>
<li>距离矢量型(例如:RIP的跳数)</li>
<li>高级距离矢量型(EIGRP)</li>
<li>链路状态型(OSPF,ISIS(Intermediate System-to-Intermediate System))</li>
</ul>
<p>对于EGP,BGP是不二之选了.</p>
<h3 id="ripv2">RIPv2 </h3>
<p>RIP使用跳数作为衡量路由优劣的距离矢量,每经过一个路由器,跳数加1.RIP基于一个短时间定时器定期向邻居发送路由信息,路由信息会被拆分,只会发送路由表中目的接口对应的不是发送目的邻居的信息.当出现路由环回时,两个路由器不停交换路由,使跳数等于16时,该路由被弃用,称为路由中毒.</p>
<h4 id="配置-9">配置 </h4>
<p>配置模式:</p>
<ol>
<li>router rip</li>
<li>version 2</li>
<li>network <code>net-number</code></li>
<li>(!可选)passive-interface(!被动模式,不发出路由更新消息)</li>
<li>(!可选)maximum-paths <code>number</code>(负载均衡)</li>
<li>default-information originate(RIP的默认路由通告)</li>
</ol>
<h3 id="ospf">OSPF </h3>
<p>每个使用OSPF的路由器有自己的LSDB(链路状态数据库),里面保存了包含了链路状态和链路度量的LSA,LSA有7种类型.路由器需要将自己创建的LSA泛洪给OSPF邻居,直到同一区域内每台路由器的LSDB完全相同.每一台路由器使用Dijkstra SPF(shortest path first)算法处理LSDB,生成SPT(SPF Tree),视自己为根节点,得到去往每一个节点的最短路径,创建条目添加到路由表.</p>
<p>OSPF使用协议ID 89 .有224.0.0.5(ALLSPFRouter),224.0.0.6(ALLDRouter)或MAC地址01:00:5E:00:00:05,01:00:5E:00:00:06作为多播地址.</p>
<p>OSPF RID优先环回接口ip最大,其次Up物理接口ip最大,可以手动设置.</p>
<h4 id="ospf区域">OSPF区域 </h4>
<p>OSFPF将拓扑结构网段分为多个OSPF区域,OSPF只会在OSPF区域内生效(一般来说,一个区域内路由器数量&lt;=50).Area 0称为骨干区域,所有区域(包括普通区域和骨干区域)都必须直接或间接地连接到骨干区域(Area 0),同时连接Area 0和其他区域的路由器称为ABR,将路由重分发进OSPF域的路由器称为ASBR.骨干区域(area 0)内部的路由信息会在整个骨干区域中洪泛,这意味着骨干区域内的所有路由器都会收到来自其他路由器的路由更新.</p>
<ul>
<li>所有同子网的接口在同一区域</li>
<li>区域内连续</li>
</ul>
<p>当区域应该连续但没有时,可以将需要连接的部分使用虚链路连接,但只是临时解决方案.</p>
<h4 id="ospf邻居">OSPF邻居 </h4>
<p>OSPF有5种数据包,1. Hello 2. DBD或DDP(DataBase Description) 3.LSR(Link-State Request) 4. LSU(Link-State Update,响应LSR) 5. 确认(Link-State Acknowledgment,响应洪范的LSA)</p>
<p>OSPF邻居条件:</p>
<ol>
<li>RID不同</li>
<li>同一子网,除了point2point链路或虚拟链路.</li>
<li>MTU相同</li>
<li>在同一网段内,区域ID相同</li>
<li>在同一网段内,DR的需求相同(网段网络类型相同)</li>
<li>在同一网段内,OSPF Hello和失效定时器相等</li>
<li>在同一网段内,认证相同</li>
<li>在同一网段内,路由器类型相同(末梢,非完全末梢)</li>
</ol>
<p>OSPF邻居状态.</p>
<ol>
<li>Down:未收到hello包</li>
<li>Attempt:发送但未接受到Hello</li>
<li>Init:收到Hello包,但Hello包中没有RID</li>
<li>2-Way:已经建立双向通信,以太网的DROther的最终状态</li>
<li>ExSatrt:为LSDB选择主从设备</li>
<li>Exchange:发送DBD</li>
<li>Loading:发送LSR</li>
<li>Full:完全邻居状态.(Down和Attempt状态应该只有显式配置邻居才会出现)</li>
</ol>
<p>OSPF有三个定时器</p>
<ol>
<li>hello</li>
<li>wait(default equals dead interval)</li>
<li>dead interval(失效)</li>
</ol>
<p>默认dead是Hello的4倍.失效时间内一直未收到邻居Hello则邻居状态变为Down.并且修改并发出LSA,区域内路由器执行SPF.<br>
默认wait等于dead.wait时间内一直未收到DR or BDR则选举DR.</p>
<h4 id="lsdb">LSDB </h4>
<p>对于IPv4,有 <em><strong>6</strong></em> 种不同的LSA:</p>
<ol>
<li>Type 1 Router Links(路由器LSA):只在一个区域内泛洪,包含自身在同一区域内的每个接口的网段信息,如果是ABR,ASBR,或虚链路端点,也会标记.</li>
<li>Type 2 Networks Links(网络LSA):DR宣告多路接入网段的信息,也只在一个区域内</li>
<li>Type 3 Summary Links(network)(汇总LSA):ABR将收到的Type 1和Type 2汇总发往其他区域,此时度量为到达各网段的度量;收到area 0的Type 3,就自己生成一条新的Type 3,并且加上到宣告路由器度量给非骨干区域;而收到别的区域的Type 3,仅将其插入LSDB,不会生成新的Type 3.所以只会在骨干与非骨干之间交换.</li>
<li>Type 4 Summary Links(ASBR)(ASBR汇总LSA):ABR收到Type 5后,检查是否在自身网段,如果是,生成Type 4宣告用以定位ASBR;如果不是,收到Type 4时,会将宣告者改为自己,再宣告出去.很多Type 5也只会宣告1条Type 4.</li>
<li>Type 5 AS External Link(AS外部LSA):被重分发的外部路由.没有区域的概念,会在整个OSPF路由域内泛洪.</li>
<li>Type 7 外部NSSA LSA:见NSSA.只有执行了重分发的NSSA存在Type 7.</li>
</ol>
<p>Type 1 会被区域间路由汇总的ABR过滤.<br>
Type 5或Type 7会被外部汇总的ABR过滤.</p>
<p>在没有多路接入的网段下,只需要Type 1 LSA就可以确认网络拓扑,不然,需要Type 2 LSA.</p>
<h4 id="末梢区域">末梢区域 </h4>
<p>OSPF有4种末梢区域.末梢区域内所有路由器需要配置为末梢路由器.</p>
<ol>
<li>末梢区域:区域内禁止Type 4和Type 5 LSA.Type 5到达末梢区域ABR后,ABR生成Type 3,如果ABR配置了area 0的接口,会生成Type 3默认路由.
<ol>
<li>没有被重分发的外部路由,被默认路由代替</li>
</ol>
</li>
<li>完全末梢区域:区域内禁止Type 3,4,5.ABR收到Type 3或Type 5,会生成一条默认路由.完全末梢区域只存在区域内路由和默认路由.
<ol>
<li>除了区域内路由,所有路由被默认路由代替</li>
</ol>
</li>
<li>NSSA(Not So Stubby Area):禁止Type4,5.ASBR使用Type 7在NSSA内宣告重分发的路由,到达ABR时,ABR将其转为Type 5.ABR也禁止Type 5进入区域.ABR可以配置宣告默认路由.
<ol>
<li>没有被重分发的外部路由,被默认路由代替</li>
<li>允许OSPF域内有自己区域ASBR重分发的路由</li>
</ol>
</li>
<li>完全NSSA:禁止Type 3,4,5.区域内禁止路由重分发.ASBR宣告路由方式和NSSA相同.
<ol>
<li>除了区域内路由,所有路由被默认路由代替</li>
<li>允许OSPF域内有自己区域ASBR重分发的路由</li>
</ol>
</li>
</ol>
<h4 id="spf">SPF </h4>
<p>路径优先级:</p>
<ol>
<li>(单个)区域内路径</li>
<li>(不同)区域间路径:所有区域间路径必须经过area 0.</li>
<li>external Type 1:<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>度量</mtext><mo>=</mo><mtext>重分发度量值</mtext><mo>+</mo><mtext>到达</mtext><mi>A</mi><mi>S</mi><mi>B</mi><mi>R</mi><mtext>度量值</mtext></mrow><annotation encoding="application/x-tex">度量=重分发度量值+到达ASBR度量值</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">度量</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">重分发度量值</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">到达</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.00773em;">SBR</span><span class="mord cjk_fallback">度量值</span></span></span></span>,优于Type 2.</li>
<li>external Type 2:<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>度量</mtext><mo>=</mo><mtext>重分发度量值</mtext></mrow><annotation encoding="application/x-tex">度量=重分发度量值</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">度量</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">重分发度量值</span></span></span></span>(默认外部度量类型)<br>
(外部路由的Type和LSA的Type没有关系,都是Type 5或7 LSA.)</li>
</ol>
<p>外部Type 1,2又分为E1,N1,E2,N2(E为ASBR宣告,N为NSSA宣告).N始终优于E,N会阻止E的安装.Type 1如果度量相同会被同时安装到RIB中,Type 2会比较到达宣告ASBR的转发开销.</p>
<p>计算SPF树时,网络链路有三种类型:</p>
<ol>
<li>转接:邻居邻接关系已经建立,并且选举了DR</li>
<li>点对点:在不需要选举DR的网段上,已经建立了邻居邻接关系(会多宣告一条末梢网络提供子网掩码)</li>
<li>末梢:未建立邻居邻接关系</li>
</ol>
<h4 id="dr">DR </h4>
<p>OSPF在以太网或帧中继等多路接入网络中,由于一个网段可以有大于二个路由器,OSPF会建立过多邻居邻接关系.所以OSPF中需要选择DR(Designated Router,指定路由器)和BDR(备用指定路由器).只有DR和BDR会和其他DROther(非DR非BDR的路由器)交换LSDB.</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
<th>是否有DR/BDR</th>
<th>定时器(hello:等待:失效)</th>
</tr>
</thead>
<tbody>
<tr>
<td>broadcast(广播)</td>
<td>以太网</td>
<td>有</td>
<td>10:40:40</td>
</tr>
<tr>
<td>non-broadcast(非广播)</td>
<td>帧中继</td>
<td>有</td>
<td>30:120:120</td>
</tr>
<tr>
<td>point-topoint(点到点)</td>
<td>HDLC或PPP,GRE,点到点帧中继</td>
<td>无</td>
<td>10:no:40</td>
</tr>
<tr>
<td>point-to-multipoint(点到多点)</td>
<td>星形拓扑(帧中继和L2VPN???)</td>
<td>无</td>
<td>30:no:120</td>
</tr>
<tr>
<td>loopback(环回)</td>
<td>环回接口</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>广播网像以太网,支持广播,NBMA(非广播)例如帧中继,x.25,atm可能同一个网段有多个路由,但不支持广播,所以hello消息只能单播,但又需要DR.</p>
<p>选举DR时,优先级越高越优先,但默认值都为1,优先级为0时不会参与选举,其次RID越高的越优先,修改优先级控制DR更优.OSPF RID当有显式配置时显式配置优先,其次是up的环回接口上的最高者,然后是up的普通接口上的最高者.</p>
<p>选举DR过程和STP选举根交换机类似,也是默认不抢占的.</p>
<ol>
<li>在Hello包中发出自己的优先级和RID.</li>
<li>收到的Hello包更优则发送更优的优先级和RID.</li>
<li>达成一致后和DR建立邻居邻接关系.</li>
<li>同样方式选举BDR,但DR不参与</li>
</ol>
<h4 id="转发地址">转发地址 </h4>
<p>Type 5 LSA转发地址默认是0.0.0.0,此时所有路由器应该把数据包发给ASBR.<br>
如果有以下情况:</p>
<ol>
<li>ASBR指向的下一跳接口启用了OSPF</li>
<li>接口不是被动接口</li>
<li>接口网络类型是广播或非广播类型<br>
需要将0.0.0.0改为下一跳IP地址,OSPF路由器将流量转发给转发地址.</li>
</ol>
<h4 id="配置-10">配置 </h4>
<p>配置模式:</p>
<ol>
<li>router ospf <code>process-id</code>(ospf进程id)</li>
<li>(!RID) router-id <code>router-id</code></li>
<li>network <code>ip-address</code> <code>wildcard-mask</code> area <code>area-id</code>(!<code>wildcard-mask</code>:例如255.255.255.255,匹配所有接口,0.255.255.255,匹配所有ip第一位为<code>ip-address</code>第一位的接口,0.0.0.0精确匹配ip对应的接口)</li>
<li>(!宣告默认路由) default-information originate [always (!没有默认路由也宣告???)] [metric <code>metric-value</code>(!路由度量)] [metric-type <code>metric-type</code>(!路由度量类型)] (!通告静态路由)</li>
<li>(!带宽大于100M时,必须进行此设置)auto-cost reference-bandwidth 40000(!40000意味着带宽最大为40G(40000M)内正确计算开销值,40000拥有更好的跨平台特性)</li>
<li>(!负载均衡)maximum-paths <code>number</code></li>
<li>(!区域启用认证)area <code>area-id</code> authentication [message-digest]</li>
<li>(!末梢区域) area <code>area-id</code> stub [no-summary]</li>
<li>(!NSSA) area <code>area-id</code> nssa {[default-information-originate]|[no-summary]}</li>
<li>(!区域间路由汇总)area <code>area-id</code> range <code>network</code> <code>subnet-mask</code> [advertise(!默认)|non-advertise] [cost <code>metric</code>]</li>
<li>(!外部汇总)summary-address <code>network</code> <code>mask</code></li>
<li>(!虚链路)area <code>area-id</code> virtual-link <code>end-point-RID</code>(!对端RID或区域ID)</li>
<li>(!被动接口)passive-interface {<code>type</code> <code>number</code>|default(!默认所有接口为passive)}</li>
<li>(!区域路由过滤)area filter-list prefix <code>name</code> {in|out}</li>
<li>(!distribute-list in can be used to filter routes from entering the routing table from the OSPF LSDB.)</li>
<li>prefix-suppresion(!suppress the advertisement of the specific interface IP addresses (like 192.168.1.1/32) and only advertise the subnets (192.168.1.0/24))</li>
</ol>
<p>接口模式:</p>
<ul>
<li>(!接口启用认证)ip ospf authentication [message-digest]</li>
<li>(!明文认证密码)ip ospf authentication-key <code>password</code></li>
<li>(!md5认证密码)ip ospf message-digest-key <code>key-number</code> md5 <code>password</code></li>
<li>ip ospf <code>process-id</code> area <code>area-id</code>[secondearies none(!不添加辅助直连网络到LSDB)] (!代替进程下的network指令)</li>
<li>ip ospf cost <code>x</code>(!直接设置开销值)</li>
<li>ip ospf network <code>type</code>(!设置网络类型,例如point-to-point将邻居关系建立在唯一的相邻路由器上，减少网络的控制消息和开销)</li>
<li>(!DR优先级)ip ospf priority <code>0-255</code>(!要立即生效需要重启DR/BDR的ospf进程)</li>
<li>(!定时器)ip ospf {hello-interval|dead-interval} <code>1-65535</code></li>
</ul>
<h4 id="排错-3">排错 </h4>
<ol>
<li>邻居关系<br>
没建立邻居关系通过show cdp neighbor
<ol>
<li>接口关闭</li>
<li>接口上未运行OSPF:
<ol>
<li>show ip ospf interface brief(!不显示被动接口)</li>
<li>show ip protocols</li>
</ol>
</li>
<li>定时器:
<ol>
<li>show ip ospf interface <code>interface-type</code> <code>number</code>(!查看自身)</li>
<li>debug ip ospf hello(!查看邻居)</li>
</ol>
</li>
<li>区域ID
<ol>
<li>show ip ospf interface brief</li>
<li>debug ip ospf adj</li>
</ol>
</li>
<li>区域类型
<ol>
<li>show ip protocols(!查看整个区域的数据统计)</li>
<li>show ip ospf(!该路由器的详细信息)</li>
<li>debug ip ospf hello</li>
</ol>
</li>
<li>子网</li>
<li>被动接口
<ol>
<li>show ip protocols</li>
</ol>
</li>
<li>认证
<ol>
<li>show ip ospf(!查看区域认证)</li>
<li>show ip ospf interface <code>type</code> <code>num</code>(!查看接口认证和密钥ID)</li>
<li>show run interface <code>type</code> <code>num</code>(!查看密钥字符串)</li>
</ol>
</li>
<li>ACL
<ol>
<li>show ip ospf interface <code>type</code> <code>num</code>(!查看接口是否启用ACL)</li>
<li>show access-list <code>num/name</code>(!查看具体ACL配置,注意末尾默认有deny all)</li>
</ol>
</li>
<li>MTU:不匹配会成功建立邻居关系,但会陷入ExStart/ExChange状态
<ol>
<li>show run interface <code>type</code> <code>num</code>(!没有mtu配置则为默认1500)</li>
<li>可以在接口模式中使用ip ospf mtu-ignore</li>
</ol>
</li>
<li>RID重复</li>
<li>网络类型
<ol>
<li>show ip ospf interface <code>type</code> <code>num</code></li>
</ol>
</li>
</ol>
</li>
<li>路由
<ol>
<li>接口未运行OSPF
<ol>
<li>show ip protocols</li>
</ol>
</li>
<li>更优的路由:<a href="#AD-TABLE">AD表</a></li>
<li>路由过滤:OSPF的路由过滤控制的是LSDB中哪些路由进入路由表
<ol>
<li>show ip protocols(!查看是否有,有哪个路由过滤器被应用)</li>
<li>show ip {prefix-list <code>name</code>|access-list <code>name</code>|<code>num</code>|show route-map <code>name</code>}(!查看过滤器具体内容)</li>
</ol>
</li>
<li>末梢区域
<ol>
<li>show ip ospf</li>
</ol>
</li>
<li>接口关闭</li>
<li>DR选举错误:星形帧中继或DMVPN时,只能由中心点作DR
<ol>
<li>show ip ospf interface <code>type</code> <code>num</code>(!查看Designated Router)</li>
<li>show ip ospf interface brief(!查看哪些接口是否是DR)</li>
</ol>
</li>
<li>RID重复</li>
</ol>
</li>
</ol>
<h4 id="ipv6-2">ipv6 </h4>
<p>支持ipv4,ipv6双栈的ospf协议是ospfv3协议家族,与ospfv2不兼容.使用协议ID89.多播地址:FF02::05(ALLSPFRouters),FF02::06(ALLDRouters)</p>
<ul>
<li>SPT计算基于链路而不是子网</li>
<li>新LSA字段确定LSA泛洪范围和未知LSA类型的处理</li>
<li>删除邻居认证,改为使用IPsec(互联网络层安全协议)</li>
<li>使用ipv6链路本地地址.允许不共享子网的路由器建立邻居关系.</li>
<li>多实例</li>
<li>RID必须手动指定 if there's no ipv4 address on interfaces.</li>
<li>The next-hop address is shown as an IPv6 link-local address</li>
</ul>
<h5 id="lsa">LSA </h5>
<p>ospfv3相比v2的区域,自治系统多了链路本地的泛洪范围.<br>
LSA Type字段由8bit扩充为16bit.<br>
前3bit为U,S2,S1</p>
<table>
<thead>
<tr>
<th>U</th>
<th>LSA处理</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>链路本地处理</td>
</tr>
<tr>
<td>1</td>
<td>储存泛洪</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>S2</th>
<th>S1</th>
<th>泛洪范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>链路本地</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>区域</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>自治系统</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>保留</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>LSA Function Code</th>
<th>LS Type</th>
<th>Description</th>
<th>范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0x2001</td>
<td>Router LSA</td>
<td>区域</td>
</tr>
<tr>
<td>2</td>
<td>0x2002</td>
<td>Network LSA</td>
<td>区域</td>
</tr>
<tr>
<td>3</td>
<td>0x2003</td>
<td>Inter-Area Prefix LSA</td>
<td>区域</td>
</tr>
<tr>
<td>4</td>
<td>0x2004</td>
<td>Inter-Area Router LSA</td>
<td>区域</td>
</tr>
<tr>
<td>5</td>
<td>0x4005</td>
<td>AS-external LSA</td>
<td>自治系统</td>
</tr>
<tr>
<td>7</td>
<td>0x2007</td>
<td>NSSA LSA</td>
<td>区域</td>
</tr>
<tr>
<td>8</td>
<td>0x0008</td>
<td>Link LSA</td>
<td>本地</td>
</tr>
<tr>
<td>9</td>
<td>0x2009</td>
<td>Intra-Area Prefix LSA</td>
<td>区域</td>
</tr>
</tbody>
</table>
<h5 id="配置-11">配置 </h5>
<p>配置模式:</p>
<ol>
<li>ipv6 unicast-routing</li>
<li>router ospfv3 <code>process-id</code></li>
<li>(!RID) router-id <code>router-id</code>(!A reserved instance ID in the range 64 to 95 identifies a neighbor adjacency as being used for IPv4.)</li>
<li>(!被动接口)passive-interface {<code>type</code> <code>number</code>|default(!默认所有接口为passive)}</li>
<li>(!地址簇) address-family {ipv6|ipv4} unicast(!在使用该命令后,接口上的ospfv3会自动启用需要的地址簇.进入AF配置模式,比在ospfv3进程下的配置具有更高优先级)</li>
</ol>
<p>接口模式:</p>
<ol>
<li>ospfv3 <code>process-id</code> {ipv4|ipv6} area <code>area-id</code></li>
<li>(!可选) ipv6 ospf cost <code>x</code></li>
<li>(!可选)ip ospf priority <code>num</code></li>
</ol>
<h5 id="排错-4">排错 </h5>
<ul>
<li>show ipv6 protocols
<ul>
<li>PID</li>
<li>RID</li>
<li>路由器类型(ABR,ASBR)</li>
<li>Area ID</li>
<li>区域类型(末梢区域或NSSA?)</li>
<li>接口及接口所属区域</li>
</ul>
</li>
<li>show ipv6 ospf
<ul>
<li>PID</li>
<li>RID</li>
<li>路由器类型(ABR,ASBR)</li>
<li>定时器</li>
<li>Area ID</li>
<li>区域类型</li>
<li>基准贷款</li>
<li>认证</li>
</ul>
</li>
<li>show ipv6 ospf interface brief
<ul>
<li>各接口PID</li>
<li>各接口区域</li>
<li>协议簇</li>
<li>DR/BDR</li>
</ul>
</li>
<li>show ipv6 ospf interface <code>type</code> <code>num</code>
<ul>
<li>网络类型</li>
<li>开销</li>
<li>认证</li>
<li>优先级</li>
<li>定时器</li>
<li>DR ID或BDR ID</li>
</ul>
</li>
<li>show ipv6 ospf neighbor
<ul>
<li>邻居ID</li>
<li>邻居状态</li>
<li>邻居接口ID</li>
<li>对应的本地接口</li>
</ul>
</li>
</ul>
<h3 id="eigrp">EIGRP </h3>
<p>EIGRP会使用RTP建立邻居关系,维护邻居邻接表;建立邻居关系时和邻居交换整个路由表,之后更新增量,维护自身拓扑表,使用DUAL计算最佳路由,并且完成路由的收敛.</p>
<p>EIGRP使用IP协议ID88,多播地址224.0.0.10,mac地址01:00:5e:00:00:0a.</p>
<h4 id="1-邻居关系">1. 邻居关系 </h4>
<p>RTP之间有5种消息包 1. Hello 2. Request 3. Update 4. Query 5. Reply,接收到消息都需要发送ACK包响应,除了Hello和ACK.没有响应重传,16次重传无响应就会重置邻居关系.</p>
<p>有三个定时器:1. Hello 2. hold 3. active.在hold定时器时间范围内每hello定时器发送的hello包得到响应则保持邻居关系.activate见DUAL.</p>
<p>EIGRP区分不同路由器的ID称为RID(router id),EIGRP进程会尝试与另一个在<strong>同一子网</strong>下使用EIGRP的路由器建立邻居关系,需要<strong>认证匹配</strong>,,并且处于<strong>同一自洽系统号</strong>,然后使用名为RTP(可靠传输协议)的协议发送路由更新(整个路由表),一般来说,第一次是完整的路由更新,之后会是部分路由更新.同一自洽系统度量值<strong>K 值</strong>应该相同.</p>
<h4 id="2-拓扑表">2. 拓扑表 </h4>
<p>拓扑表包含网络前缀,EIGRP邻居,RD和跳数,度量相关(负载,可靠性,总时延,最小带宽).例如:</p>
<pre data-role="codeBlock" data-info="IOS" class="language-ios IOS"><code>P 10.12.1.0/24,1 successors, FD is 2816
   via Connected, GigabitEthernet0/3

或 via 10.14.1.4(5376/2616), GigabitEthernet0/2
</code></pre><ul>
<li><code>P</code>代表Passive,表明结构稳定,不然为Active.</li>
<li><code>1 successors</code>表示到达该子网有一个后继路由,即后面的<code>via</code>条数.</li>
<li><code>10.14.1(5376/2616)</code>表示到10.14.1.4的Total Distance/Feasible Distance(RD)</li>
<li><code>GigabitEthernet0/2</code>是自己的接口</li>
</ul>
<h4 id="3-度量值">3. 度量值 </h4>
<p>EIGRP的度量值使用链路的最小带宽和累计延迟做参数,最小带宽和延迟会由通告的消息和自身设备权衡后得出.IOS不会根据物理带宽去计算,所以广域网链路的带宽需要手动设置,局域网可以默认,效果比较好.</p>
<p>修改bandwidth会影响所有使用bandwidth的协议,修改delay只会影响EIGRP中的总时延项.</p>
<p class="math"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>度量</mtext><mo>=</mo><mtext>常数</mtext><mo>∗</mo><mo stretchy="false">[</mo><mo stretchy="false">(</mo><msub><mi>K</mi><mn>1</mn></msub><mo>∗</mo><mfrac><mrow><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><mtext>最小带宽</mtext></mfrac><mo>+</mo><mfrac><mfrac><mrow><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><mrow><msub><mi>k</mi><mn>2</mn></msub><mo>∗</mo><mtext>最小带宽</mtext></mrow></mfrac><mrow><mn>256</mn><mo>−</mo><mtext>负载</mtext></mrow></mfrac><mo>+</mo><msub><mi>K</mi><mn>3</mn></msub><mo>∗</mo><mtext>总时延</mtext><mo>+</mo><msub><mi>K</mi><mn>6</mn></msub><mo>∗</mo><mtext>拓展属性</mtext><mo stretchy="false">)</mo><mo>∗</mo><mfrac><msub><mi>K</mi><mn>5</mn></msub><mrow><mo stretchy="false">(</mo><msub><mi>K</mi><mn>4</mn></msub><mo>+</mo><mtext>可靠性</mtext><mo stretchy="false">)</mo></mrow></mfrac><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">度量=常数*[(K_1*\frac{10^7}{最小带宽}+\frac {\frac {10^7} {k_2*最小带宽} } {256-负载}+K_3*总时延+K_6*拓展属性)*\frac{K_5} {(K_4+可靠性)}]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">度量</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">常数</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.1771em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">最小带宽</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.6223em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.853em;"><span style="top:-2.3319em;"><span class="pstrut" style="height:3.0179em;"></span><span class="mord"><span class="mord">256</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord cjk_fallback">负载</span></span></span><span style="top:-3.2479em;"><span class="pstrut" style="height:3.0179em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.853em;"><span class="pstrut" style="height:3.0179em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0179em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0315em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">∗</span><span class="mord cjk_fallback mtight">最小带宽</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight"><span class="mord mtight">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">总时延</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">拓展属性</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2963em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord cjk_fallback">可靠性</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">]</span></span></span></span></span></p><p>当非宽度量模式时,<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>常数</mtext><mo>=</mo><mn>256</mn></mrow><annotation encoding="application/x-tex">常数=256</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">常数</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">256</span></span></span></span>,为宽度量时,<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>常数</mtext><mo>=</mo><mn>65535</mn></mrow><annotation encoding="application/x-tex">常数=65535</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">常数</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">65535</span></span></span></span>.当<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">K_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>,<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">K_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为1,<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">K_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>,<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mn>4</mn></msub></mrow><annotation encoding="application/x-tex">K_4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>,<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mn>5</mn></msub></mrow><annotation encoding="application/x-tex">K_5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>,<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mn>6</mn></msub></mrow><annotation encoding="application/x-tex">K_6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为0时,满足</p>
<p class="math"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>度量</mtext><mo>=</mo><mn>256</mn><mo>∗</mo><mfrac><mrow><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><mtext>最小带宽</mtext></mfrac><mo>+</mo><mfrac><mtext>总时延</mtext><mn>10</mn></mfrac></mrow><annotation encoding="application/x-tex">度量=256*\frac {10^7} {最小带宽}+\frac {总时延} {10}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">度量</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">256</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.1771em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">最小带宽</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">总时延</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>宽度量适用于带宽大于10gbps的情况.后向兼容的.</p>
<h4 id="4-dual">4. DUAL </h4>
<p>自身对某一特定子网的度量值叫做FD(可行距离),而可以到达该子网的邻居报告的其自身的FD称为RD,当RD小于FD时,报告RD的邻居即为该子网的feasible successor.当没有feasible successor时,会通过DUAL(弥散更新算法)查询那些不是feasible successor的邻居是否可行.feasible successor中FD最小的为successor,即装入路由表中中的路由.(reported distance is to report your feasible distance)</p>
<p>(这个方法很巧妙,无论最简单的环还是复杂的环,其本质也是通过某个节点通过某种路径指向了自身,而FD相当于RD+自身,此处的+可以理解为加上了到自身端口的延迟和开销.</p>
<p>当路由器发现某条链路出现故障时,有feasible successor,选择度量值最小的作为successor,并向路由下游邻居发送新的度量值更新包,收到更新包的路由器也递归的执行自己的DUAL.<br>
如果没有feasible successor:</p>
<ol>
<li>拓扑表中的该路由将会变为主动状态</li>
<li>受影响路由器会发送query包给邻居,query包是时延字段无穷大.</li>
<li>
<ol>
<li>收到查询包,如果查询包来自(该查询包查询的路由)的successor邻居,那么说明(该查询包查询的路由)不可达,自身也会发送查询包给该路由下游邻居.</li>
<li>如果查询包不是来自被查询路由的后继,那么发送应答包,应答该路由不可达或可达路由.</li>
</ol>
</li>
<li>当收到自己发送的所有查询包对应的应答包时,完成DUAL,将路由变更为Passive状态.向上游发送应答.</li>
</ol>
<p>当DUAL过程卡住超过Active计时器一半时间时,称为SIA(Stuck-in-Active),会向邻居发送SIA查询信息,邻居必须在Active计时器一半时间响应,否则视为邻居对来自该邻居的所有路由均返回不可达消息.</p>
<h4 id="路由汇总">路由汇总 </h4>
<p>路由汇总EIGRP会默认安装一条丢弃路由防止路由环回.</p>
<p>汇总度量使用的是被汇总路由中最低的度量值.</p>
<p>EIGRP自动汇总在IOS 15以前自动开启,会自动汇总有类网络.实际网络中,大多不使用.</p>
<h4 id="末梢路由器-and-末梢站点">末梢路由器 and 末梢站点 </h4>
<p>当企业将路由器通过ISP接入互联网时,希望自己的路由器路由的是自己LAN中的流量,不会通过WAN口去进行路由,就需要设置末梢路由器或站点.</p>
<p>EIGRP末梢路由器不会宣告从其他EIGRP对等体学到的路由,默认仅宣告直连和汇总路由.可以配置仅接受或宣告重分发,直连或汇总的任意组合.</p>
<p>EIGRP末梢站点会向WAN口的对等体宣告LAN口上学到的路由.</p>
<h4 id="路由控制">路由控制 </h4>
<p><strong>路由信息</strong></p>
<div class="mermaid">graph LR

邻居--&gt;入站分发列表--&gt;DUAL--&gt;出站分发列表--&gt;另一个邻居
DUAL--&gt;RIB
</div><p>EIGRP可以在路由接受或宣告时使用ACL,IP前缀列表,路由映射,或网关ip地址进行匹配过滤.</p>
<p>EIGRP可以使用度量值偏移列表引导流量,即为满足匹配的路由度量值添加偏移量.</p>
<h4 id="水平分割">水平分割 </h4>
<p>不会宣告路由给路由的来源,称为水平分割.EIGRP默认启用,但在不支持全网状连接的接入介质中,必须禁用水平分割.如DMVPN(所有路由来源都是vpn隧道接口),L2VPN,帧中继.</p>
<h4 id="配置-12">配置 </h4>
<p>EIGRP的配置分为传统配置模式和命名配置模式.命名配置模式支持更多新特性.命名配置模式有三个层级:地址簇子模式,接口子模式和拓扑结构子模式.</p>
<ul>
<li>
<p>命名配置模式</p>
<ul>
<li>创建进程
<ol>
<li>router eigrp <code>process-name</code></li>
<li>(!可选) eigrp router-id <code>RID</code></li>
<li>address-family {ipv4|ipv6} {unicast|vrf <code>vrf-name</code>} autonomous-system <code>as-number</code>(!地址簇子模式)
<ul>
<li>network <code>network</code> <code>mask</code></li>
<li>(!末梢路由器)eigrp stub [{connected|recive-only|redistuibuted|static|summary}] (!一般不使用可选项)</li>
<li>(!末梢站点)eigrp stub-site <code>as-num</code>:<code>identifier</code>(!<code>as-num</code>:<code>identifier</code>在站内设备上相同)(!先在接口子模式上启用末梢站点)</li>
<li>(!路由重分发默认度量)default-metric <code>band-width</code> <code>delay</code> <code>reliability</code> <code>load</code> <code>mtu</code></li>
<li>no auto-summary</li>
<li>exit-address-family</li>
</ul>
</li>
</ol>
</li>
<li><strong>拓扑结构子模式</strong>
<ol>
<li>topology base(!创建)
<ol>
<li>(!可选)metric weights  <code>TOS</code>(!始终为0) <code>K1</code> <code>K2</code> <code>K3</code> <code>K4</code> <code>K5</code> <code>K6</code>(!K6宽度量模式)</li>
<li>(!可选)maximum-paths <code>number</code>(!设置等价开销路由数)</li>
<li>(!可选)variance <code>multiplier</code>(!设置等价开销路由距离容忍倍数,例如RD&lt;最佳RD*multiplier的可行会加入负载均衡中)</li>
<li>(!可选)timers active-time <code>mins</code>(!修改active定时器)</li>
<li>(!路由过滤)distribute-list {<code>acl-number</code>|<code>acl-name</code>|prefix <code>prefix-list-name</code>|route-map <code>route-map-name</code>|gateway <code>prefix-list-name</code>} {in|out} [<code>interface-id</code>]</li>
<li>(!度量值偏移)offset-list <code>offset-value</code> {<code>acl-number</code>|<code>acl-name</code>} {in|out} <code>offset</code>[<code>interface-id</code>]</li>
<li>exit-af-topology(!退出)</li>
</ol>
</li>
</ol>
</li>
<li><strong>接口子模式</strong>
<ul>
<li>af-interface {<code>interface-id</code>|default}(!default上意味着所有接口的默认设置)
<ul>
<li>(!被动接口) passive interface</li>
<li>(!路由汇总)summary-address <code>network</code> <code>mask</code> [leak-map <code>route-map-name</code>(!???)] (!汇总路由,不能在default上用)</li>
<li>(!设置EIGRP协议占最大带宽)bandwidth-percent <code>percentage</code></li>
<li>(!禁用水平分割)no ip split-horizon</li>
<li>(!末梢站点)stub-site wan-interface</li>
<li>(!接口时延)delay <code>delay</code></li>
<li>启用认证
<ol>
<li>authentication key-chain eigrp <code>chian-name</code></li>
<li>authentication mode {md5|hmacsha-256 <code>password</code>}</li>
</ol>
</li>
<li>定时器
<ul>
<li>hello-internal <code>seconds</code>(!默认为5s,低速接口上是60s)</li>
<li>hold-time <code>seconds</code>(!默认是hello定时器的3倍)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>传统配置模式:</p>
<ol>
<li>router eigrp <code>ASN</code>(!自洽系统号)</li>
<li>(!可选) eigrp router-id <code>RID</code></li>
<li>(!可选) timers active-time <code>mins</code></li>
<li>network <code>ip-address</code> {<code>wildcard-mask</code>|}(!留空时默认网络类级别掩码,其他和OSPF相同)</li>
<li>(!可选)eigrp router-id <code>value</code> (!设置EIGRP路由器ID)</li>
<li>(!可选)maximum-paths <code>number</code>(!设置等价开销路由数)</li>
<li>(!可选)variance <code>multiplier</code>(!设置等价开销路由距离容忍倍数,例如RD&lt;最佳RD*multiplier的可行会加入负载均衡中)</li>
<li>(!可选)no auto-summary(!ipv4中自动路由汇总)(!实际网络中,大多不使用)(!default on)</li>
<li>(!路由汇总)ip summary-address eigrp <code>as-num</code> <code>network</code> <code>mask</code> [leak-map <code>route-map-name</code>]</li>
<li>(!可选)metric weights  <code>TOS</code>(!始终为0) <code>K1</code> <code>K2</code> <code>K3</code> <code>K4</code> <code>K5</code></li>
<li>(!末梢站点)eigrp stub [{connected|recive-only|redistuibuted|static|summary}]</li>
<li>(!路由过滤)distribute-list {<code>acl-number</code>|<code>acl-name</code>|prefix <code>prefix-list-name</code>|route-map <code>route-map-name</code>|gateway <code>prefix-list-name</code>} {in|out} [<code>interface-id</code>]</li>
<li>(!度量值偏移)offset-list <code>offset-value</code> {<code>acl-number</code>|<code>acl-name</code>} {in|out} <code>offset</code>[<code>interface-id</code>]</li>
</ol>
<ul>
<li>接口模式:
<ul>
<li>(!被动接口)passive-interface default(!设置为被动接口,不会建立邻居关系)</li>
<li>(!认证)ip authentication key-chain eigrp <code>as-num</code> <code>chian-name</code></li>
<li>(!认证)ip authentication mode eigrp <code>as-num</code> md5</li>
<li>(!hello定时器)ip hello-internal eigrp <code>as-number</code> <code>seconds</code>(!默认为5s,低速接口上是60s)</li>
<li>(!保持定时器)ip hold-time eigrp <code>as-number</code> <code>seconds</code>(!默认是hello定时器的3倍)</li>
<li>(!设置EIGRP协议占最大带宽)ip bandwidth-percent eigrp <code>as-num</code> <code>percentage</code></li>
<li>(!禁用水平分割)no ip split-horizon eigrp <code>as-num</code></li>
<li>(!接口时延)delay <code>delay</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>认证<br>
认证需要先创建一个密钥链,然后在接口上启用</p>
<ul>
<li>创建密钥链
<ol>
<li>key chain <code>chain-name</code></li>
<li>key <code>key-num</code>(!标识,num&lt;2^32-1)</li>
<li>key-string <code>password</code></li>
</ol>
</li>
</ul>
</li>
</ul>
<h4 id="排错-5">排错 </h4>
<h5 id="eigrp邻居关系无法建立可能因为">EIGRP邻居关系无法建立可能因为 </h5>
<ol>
<li>接口中断</li>
<li>AS number:show ip protocols(!当有被动接口时也会显示被动接口)</li>
<li>network语句错误:show ip eigrp interfaces(!不会显示被动接口,所以应先检查被动接口)</li>
<li>K值:show ip protocols</li>
<li>被动接口</li>
<li>子网不同:show ip interface(!应该就可以(???))</li>
<li>认证:
<ol>
<li>show ip eigrp interface detail <code>interface</code>(!查看某接口上使用的认证参数)</li>
<li>show key chain(!查看ID和密钥,要完全匹配才可以)</li>
<li>debug eigrp packets(!查看邻居认证配置,(missing authentication)说明邻居未配置认证,(invalid authentication)说明不匹配)</li>
</ol>
</li>
<li>ACL 过滤了224.0.0.10
<ol>
<li>show ip interface <code>interface</code>(!查看接口使用的acl名称或标号)</li>
<li>show access-lists {<code>num</code>|<code>name</code>}(!查看acl具体信息,注意acl默认末尾deny all)</li>
</ol>
</li>
<li>定时器,hello定时器不能大于另一方的hold定时器,不然会重复震荡<!-- 1. 7.1命令  -->
</li>
</ol>
<h5 id="eigrp路由故障可能">EIGRP路由故障可能 </h5>
<ol>
<li>network语句错误</li>
<li>更优的路由信息源:<a href="#AD-TABLE">AD表</a></li>
<li>路由过滤:
<ol>
<li>show ip protocols(!查看是否有规则,什么规则被应用到了路由过滤)</li>
<li>show {access-lists <code>acl</code>|ip prefix-list|route-map}</li>
</ol>
</li>
<li>末梢配置</li>
<li>接口处于关闭</li>
<li>水平分割:show ip interface <code>interface</code> [detail]</li>
</ol>
<h4 id="ipv6-3">ipv6 </h4>
<p>组播地址为FF02::A.</p>
<p>ipv6没有有类网络,所以没有自动汇总.</p>
<p>show ip变为show ipv6</p>
<h5 id="配置-13">配置 </h5>
<p>命名配置模式:<br>
地址簇选择ipv6<br>
传统配置模式:</p>
<ol>
<li>ipv6 router eigrp <code>ASN</code></li>
<li>(!可选)eigrp router-id <code>id</code></li>
<li>进入接口</li>
<li>ipv6 eigrp <code>ASN</code></li>
</ol>
<h3 id="bgp">BGP </h3>
<p>BGP分为两类,iBGP(相同AS或BGP联盟路由器之间的会话)和eBGP(不同AS路由器之间的会话).</p>
<p>BGP使用AS_PATH防止路由路由环回,但在iBGP中不可行,iBGP TTL设置为255,从iBGP学到的路由只发送给eBGP,从eBGP学到的路由发送给iBGP和eBGP,所以在iBGP中各路由器需要使用多跳会话(如果需要)建立全网状连接.(最好使用静态配置邻居+IGP协议)</p>
<p>eBGP数据包TTL设置为1,禁止多跳会话,不应该使用LoopBack 0接口作为源接口.使用AS_PATH防止路由环回.</p>
<h4 id="通信">通信 </h4>
<p>BGP使用TCP协议port:179通信,本身就需要路由寻址,可以与多跳以外的路由器建立会话,称为多跳会话,多跳会话需要使用路由器RIB中的底层路由(静态或其他路由协议的路由).会话邻居也叫对等体.</p>
<p>消息分为4种:</p>
<ol>
<li>OPEN
<ol>
<li>BGP 版本</li>
<li>ASN</li>
<li>保持定时器时间</li>
<li>BGP RID:使用32bit数字作为BGP RID作标识.</li>
</ol>
</li>
<li>KEEPALIVE
<ol>
<li>保持定时器时间1/3发送KEEPALIVE消息</li>
</ol>
</li>
<li>UPDATE
<ol>
<li>更新路由,也可充当KEEPALIVE消息</li>
</ol>
</li>
<li>NOTIFICATION
<ol>
<li>关闭BGP会话</li>
</ol>
</li>
</ol>
<p>定时器:</p>
<ol>
<li>邻居保持定时器:至少3s,会使用建立关系双方通告的较小值,设置为0禁用Keepalive功能.默认180s.</li>
<li>连接重试定时器</li>
</ol>
<p>邻居关系有6个状态:</p>
<div class="mermaid">flowchart LR

Idle(("Idle(空闲)"))--&gt;Idle
Idle&lt;--发送TCP连接--&gt;Connect(Connect)
Connect--&gt;Connect
Connect&lt;--连接重试定时器超时--&gt;Active
Connect--握手成功--&gt;a[Open Sent]
Active--&gt;Idle
Active--&gt;Active
Active--握手成功--&gt;a[Open Sent]
a[Open Sent]--TCP连接关闭--&gt;Active
a[Open Sent]--比对不成功,发送NOTIFICATION--&gt;Idle
a[Open Sent]&lt;--比对成功--&gt;b[Open Confirm]
b[Open Confirm]--&gt;b[Open Confirm]
b[Open Confirm]--NOTIFICATION--&gt;Idle
b[Open Confirm]--KEEPALIVE--&gt;Established(((Established)))
Established--&gt;Idle
Established--&gt;Established
</div><p>Open-sent比对信息</p>
<ol>
<li>bgp 版本</li>
<li>open消息源ip=配置中邻居ip</li>
<li>open消息asn=配置中邻居asn</li>
<li>BGP RID唯一</li>
<li>安全参数</li>
</ol>
<h4 id="路径属性">路径属性 </h4>
<p>每条路径都关联PA(Path Attribute),PA有四种:</p>
<ul>
<li>Well-known Mandatory(周知强制属性)
<ol>
<li>AS-PATH:经过的AS路径,如果自己的ASN在其中,说明产生环路.</li>
</ol>
</li>
<li>Well-konwn Discretionary(周知自选属性)</li>
<li>Optional Transitive(可选传递属性)</li>
<li>Optional NonTransitive(可选非传递属性)<br>
所有BGP必须支持周知强制和周知自选,宣告的路径前缀必须包含周知强制.</li>
</ul>
<table>
<thead>
<tr>
<th>名称</th>
<th>在AS之间宣告</th>
</tr>
</thead>
<tbody>
<tr>
<td>周知强制</td>
<td>是</td>
</tr>
<tr>
<td>周知自选</td>
<td>否</td>
</tr>
<tr>
<td>可选传递</td>
<td>是</td>
</tr>
<tr>
<td>可选非传递</td>
<td>否</td>
</tr>
</tbody>
</table>
<p>可选非传递属性只在相邻的AS之间或本地AS之内有意义.</p>
<h4 id="nlri">NLRI </h4>
<p>NLRI(Network Layer Reachability Information,网络层可达性信息)由网络前缀,前缀长度,和特定路由的BGP PA组成.</p>
<p>BGP有3张表:</p>
<ol>
<li>Adj-RIB-in:原始信息的NLRI,处理即清除</li>
<li>Loc-RIB:通过了有效性和下一跳检查后的NLRI.向路由表提供路由.
<ol>
<li>通过show bgp <code>afi</code> <code>safi</code> <code>network</code>查看特定网络的路由</li>
</ol>
</li>
<li>Adj-RIB-out:处理了出站策略的NLRI
<ol>
<li>show bgp <code>afi</code> <code>safi</code> neighbors <code>ip</code> advertised-routes</li>
</ol>
</li>
</ol>
<div class="mermaid">graph TB

Adj-RIB-in--&gt;入站策略
入站策略--&gt;Loc-RIB
network语句检查直连,静态路由或路由协议的路由--&gt;RIB检查
RIB检查--&gt;Loc-RIB
Loc-RIB--&gt;下一跳检查
下一跳检查--&gt;确定BGP最佳路径
确定BGP最佳路径--&gt;安装到RIB
确定BGP最佳路径--&gt;出站策略
出站策略--&gt;Adj-RIB-out
</div><h5 id="入站和出站策略">入站和出站策略 </h5>
<ol>
<li>分发列表:根据标准或拓展ACL过滤</li>
<li>前缀列表:前缀匹配规范列表</li>
<li>AS_PATH ACL:正则表达式过滤AS_PATH
<ol>
<li>(!创建)ip as-path access-list <code>acl-number</code> {deny|permit} <code>regex-query</code>(!末尾包含一条隐式拒绝命令)</li>
</ol>
</li>
<li>路由映射:根据前缀属性条件匹配,修改(功能最强大)</li>
</ol>
<p>使用路由控制技术之后一般需要刷新BGP会话后生效,分为硬重置和软重置.硬重置会关闭会话并从BGP对等体删除路由.软重置会使BGP缓存无效重新请求.</p>
<h4 id="bgp拓扑">BGP拓扑 </h4>
<div class="mermaid">graph LR
A&lt;--eBGP--&gt;B
B&lt;--iBGP--&gt;C
C&lt;--eBGP--&gt;D
</div><p>如果使用默认设置,A,D互相通告的网络将无法通过有效性检查,因为B不知道CD网段的路由,C不知道AB网段的路由,所以A,D没有对方网络的路由.</p>
<p>解决措施:</p>
<ol>
<li>IGP宣告(由于跨AS,最好使用被动接口)</li>
<li>使用network语句宣告到BGP中(???)</li>
<li>下一跳控制</li>
</ol>
<h4 id="rr-and-联盟">RR and 联盟 </h4>
<p>全网状连接拓展性差,引入路由反射器和联盟.负责反射路由的路由器称为RR(Route Reflector),被反射iBGP对等体的称为RR client(RR客户端),不被反射的iBGP对等体叫非RR客户端.有三条规则:</p>
<ol>
<li>RR从非RR客户端收到NLRI,宣告给RR客户端,不会将NLRI宣告给非RR客户端.</li>
<li>从RR客户端或eBGP对等体收到NLRI,发送给RR客户端和非RR客户端.</li>
</ol>
<p>联盟是在AS内部再划分sub-AS,使内部建立eBGP会话,eBGP有AS-Path防止环回.通常使用私有ASN(64512-65535或4,200,000,000-4,294,967,294).除了防止路由环回外,整个AS内(sub-AS集合)其他行为(RR,MED,LOCAL_PREF)都像是iBGP一样.</p>
<h5 id="联盟配置">联盟配置 </h5>
<ol>
<li>router bgp <code>as-number</code>(!这个AS为私有sub-AS)</li>
<li>bgp confederation indentifier <code>as-number</code>(!这个AS为真实AS)</li>
<li>bgp confederation peers <code>member-asn</code>(!联盟AS内sub-AS外ebgp邻居的asn)</li>
</ol>
<h4 id="mpbgp">MPBGP </h4>
<p>支持ipv6,MPLS,DMVPN,L3VPN等多协议</p>
<p>ipv6需要启用地址簇外,如只使用ipv6(真的会出现吗)需要显式配置RID</p>
<h5 id="ipv6-over-ipv4">ipv6 over ipv4 </h5>
<ol>
<li>启用可用的ipv4配置和一般的ipv6配置</li>
<li>建立ipv6邻居关系后,使用route-map映射手动设置下一跳ipv6地址.(???)</li>
</ol>
<h4 id="团体">团体 </h4>
<p>团体是一种路由的可选传递属性(PA),32bit.用以标记路由和修改BGP路由策略.有4种全局团体,支持团体功能的路由器必须支持:</p>
<ul>
<li>Internet</li>
<li>No_Advertise:不宣告给任何对等体</li>
<li>No_Export:不宣告给任何eBGP对等体,但会跨越联盟(sub-AS)</li>
<li>Local_AS:只在AS或sub-AS内宣告,不能跨越联盟.</li>
</ul>
<p>团体的条件匹配:在route-map里,需要先使用 ip community-list {1-500|standard <code>list-name</code>|expanded <code>listname</code>} {permit|deny} <code>community-pattern</code>,然后在route-map里使用match community <code>1-500</code>引用团体列表</p>
<p>set community <code>bgp-community</code> [additive(!不覆盖原有的团体)] 为某些路由设置私有团体</p>
<p>BGP communities are not advertised between iBGP neighbors by default.</p>
<h4 id="good-example">good example </h4>
<p>称为BGP汇总.</p>
<div class="mermaid">graph TB

A--100.64.1.0/24--&gt;B
A--100.64.0.0/16--&gt;B
C--100.64.2.0/24--&gt;B
C--100.64.0.0/16--&gt;B
</div><h4 id="bgp最佳路径">BGP最佳路径 </h4>
<ol>
<li>权重高:Cisco定义的本地属性,在路由映射中set weight <code>weight</code>设置匹配前缀的权重.只在本地路由器有意义.默认为0.</li>
<li>LOCAL_PREF(本地优先级)高:周知自选属性,默认值100,0~2^32-1,只对iBGP宣告,不会宣告给eBGP.在路由映射中使用set local-prefrence <code>preference</code>为特定路由设置.在本地AS内有意义.</li>
<li>本地路由器生成的
<ol>
<li>本地宣告的路由(在Loc-RIB中下一跳为0.0.0.0且标记为i)</li>
<li>本地聚合的路由(在Loc-RIB中下一跳为0.0.0.0且标记为?)</li>
<li>从BGP对等体收到的路由</li>
</ol>
</li>
<li>AIGP(Accumulated IGP)度量小:可选非传递属性,在相邻的AS间有意义.路由映射中的命令:set aigp-metric {igp-metric|<code>metric</code>}(!igp-metric将特定路由的aigp度量设置为igp度量),aigp度量计算是递归的
<ol>
<li>有aigp的度量优于无aigp的度量</li>
</ol>
</li>
<li>AS_PATH短:asset视为一个as_path.</li>
<li>路由来源优:周知强制属性.在路由映射中使用set origin {igp|incomplete}设置.
<ol>
<li>IGP(标记为'i'):使用network语句宣告的网络的路由</li>
<li>BGP</li>
<li>不完整路由(标记为'?'):被IGP重分发到BGP的路由</li>
</ol>
</li>
<li>MED小:可选非传递属性,在相邻的AS间有意义.默认值为0.在路由映射中可以使用set metric <code>metric</code>设置.
<ol>
<li>始终比较med值:忽略AS_PATH,始终比较med</li>
<li>BGP确定性med:将相同AS_PATH分为一类,每类比较MED取最优,再把每一类的最优比较MED取最优.</li>
</ol>
</li>
<li>eBGP路径优于iBGP路径
<ol>
<li>eBGP对等体</li>
<li>联盟成员AS对等体</li>
<li>iBGP对等体</li>
</ol>
</li>
<li>最小IGP度量:多个iBGP邻居宣告相同路由,选择igp度量值最低的</li>
<li>对eBGP而言,选最早的</li>
<li>BGP对等体RID最小:如果是RR宣告的度量,就用ORIGINATOR_ID替换RID</li>
<li>最小cluster_list长度:可选非传递属性,不会在AS之间宣告.as内的as_path.</li>
<li>BGP邻居IP地址最小:仅限于iBGP对等体.</li>
</ol>
<p>未被选择的路由继续存放在Loc-RIB中.</p>
<h5 id="等价多路径">等价多路径 </h5>
<p>最佳路径和其他路径必须在以下属性相匹配:</p>
<ol>
<li>权重</li>
<li>本地优先级</li>
<li>AS_PATH长度</li>
<li>AS_PATH内容(联盟内容可以不同)</li>
<li>路由来源</li>
<li>MED</li>
<li>如果来源是BGP,必须同为iBGP或eBGP.</li>
<li>如果来源为iBGP,则还有igp度量<br>
才可以成为等价多路径,安装到RIB里</li>
</ol>
<h4 id="配置-14">配置 </h4>
<p>配置模式:</p>
<ol>
<li>
<p>router bgp <code>as-number</code></p>
<ol>
<li>(!med默认为2^32-1)bgp bestpath med missing-as-worst(!应该在AS所有节点布置此命令)</li>
<li>(!med默认值)default-metric <code>metric</code></li>
<li>(!始终比较med)bgp always-compare-med</li>
<li>(!确定性med)bgp deterministic-med</li>
<li>(!RID)bgp router-id <code>id</code></li>
<li>(!禁止ipv4地址簇自动激活)no bgp default ipv4-unicast</li>
<li>neighbor <code>ip</code> remote-as <code>as-num</code>
<ol>
<li>(!源ip)neighbor <code>ip</code> updatesource <code>interface</code></li>
<li>(!认证)neighbor <code>ip</code> password</li>
<li>(!定时器)neighbor <code>ip</code> timers <code>keepalive</code> <code>holdtime</code> [<code>minimum-holdtime</code>]</li>
<li>(!修改跳数)neighbor <code>ip</code> ebgp-multihop [TTL]</li>
</ol>
</li>
<li>address-family {ipv4|ipv6|vpnv4} {unicast|multicast} (!默认启用ipv4,使用no bgp default ipv4-unicast禁用)
<ol>
<li>neighbor <code>ip</code> activate(if use 'no bgp default ipv4-unicast',it's compulsory)</li>
<li>network mask <code>subnet-mask</code> [route-map <code>map-name</code>] (!标识要安装在Loc-RIB的网络前缀(重分发到BGP的路由不需要network指定))</li>
<li>neighbor <code>ip</code> next-hop-self [all(!修改iBGP前缀下一跳ip)] (!需要在iBGP上设置,收到的eBGP通告下一跳将变为自身)</li>
<li>(!RR)neighbor <code>ip</code> route-reflector-client</li>
<li>(!路由汇总)aggregate-address {<code>ip</code> <code>mask</code>|<code>prefix</code>} [summary-only(!抑制原始组件网络宣告,并且会去掉之前的AS_PATH,新增原子聚合属性,表示该路由出现路径属性丢失,一般都要使用)] [as-set(!保留被聚合前的AS_PATH在AS_PATH的AS_SET字段,一般都不使用)] (!路由汇总总是被宣告,即使网络不可达)</li>
<li>(!distribute list)neighbor <code>ip</code> {distribute-list <code>num/name</code>|distribute-list <code>num/name</code>|filter-list <code>acl-number</code>|router-map <code>map-name</code>} {in|out}</li>
<li>(!BGP团体宣告)neighbor <code>ip</code> send-community [standard(!默认)|extended|both]</li>
<li>(!最大前缀数量)neighbor <code>ip</code> maximum-prefix <code>prefix-count</code> [warning-percentage] [restart <code>time</code>] [warning-only(!默认关闭BGP会话,使用warning-only改为生成告警消息)]</li>
<li>(!最佳路径)neighbor <code>ip</code> {weight <code>weight</code>(!权重)|local-preference <code>preference</code>(!本地优先级)}</li>
<li>(!默认本地优先级)bgp default loacl-preference <code>preference</code>(!???)</li>
<li>(!为邻居启用AIGP)neighbor <code>ip</code> aigp</li>
<li>(!等价多路径)maximum-paths [ibgp] <code>number-paths</code></li>
<li>(!服务端和客户端)neighbor <code>ip</code> transport connection-mode {passive(!服务端)|active(!客户端)}</li>
<li>(!终止私有ASN)neighbor <code>ip</code> remove-private-as</li>
</ol>
</li>
</ol>
</li>
<li>
<p>clear ip bgp {<code>ip-address</code>|*} [soft] [in|out]</p>
</li>
</ol>
<h5 id="bgp更新组">BGP更新组 </h5>
<p>通过Peer Group将BGP对等体放到不同的BGP更新组,使其拥有相同的出站策略.对等体组必须同为iBGP或eBGP.</p>
<p>通过neighbor <code>group-name</code> peer-group定义对等体组,使用neighbor <code>ip</code> peer-group <code>group-name</code>关联BGP对等体和对等体组.使用peer-group <code>group-name</code>代替neighbor <code>ip</code>进行配置.</p>
<p>激活对等体只能使用neighbor <code>ip</code> activate.</p>
<p>BGP会默认为每个邻居生成每条路由的更新消息,会极大的消耗cpu,内存资源.使用BGP对等体组可以节约这些资源.</p>
<h5 id="对等体模板">对等体模板 </h5>
<p>模板可继承,子覆盖父<br>
template peer-session <code>template-name</code><br>
template peer-policy <code>template-name</code></p>
<p>inherit peer-session <code>template-name</code> <code>sequence</code><br>
inherit peer-policy <code>template-name</code> <code>sequence</code></p>
<h4 id="排错-6">排错 </h4>
<p>检查日志文件.</p>
<ol>
<li>邻居关系<br>
show bgp ipv4 unicast neighbor [summary]
<ol>
<li>通过默认路由到达邻居</li>
<li>接口中断
<ol>
<li>show ip interface brief</li>
</ol>
</li>
<li>三层连接中断
<ol>
<li>ping <code>neighbor</code> source <code>source</code></li>
</ol>
</li>
<li>邻居没有到达本地路由器的路径</li>
<li>neighbor语句错误
<ol>
<li>如果as错误,会在active和idle之间切换</li>
</ol>
</li>
<li>ACL:TCP 179端口
<ol>
<li>(!查看端口)show bgp ipv4 unicast neighbor</li>
</ol>
</li>
<li>TTL到期
<ol>
<li>ebgp ttl只有1跳</li>
<li>traceroute确定跳数</li>
</ol>
</li>
<li>认证参数不匹配
<ol>
<li>处于Idle状态</li>
</ol>
</li>
<li>对等体组配置错误</li>
<li>定时器
<ol>
<li>定时器无需匹配,会话会选择最小的定时器设置.但如果设置了最小保持时间,定时器最小值须大于等于最小保持时间</li>
</ol>
</li>
</ol>
</li>
<li>路由故障<br>
show bgp ipv4 unicast(!查看BGP路由,下一跳不为0.0.0.0时说明是从BGP对等体收到的,不然则是重分发(?),network语句(i),或summary(i))
<ol>
<li>network语句错误
<ol>
<li>BGP network语句宣告的网络必须位于路由表并且来源于其他路由信息源(直连,静态,或其他路由协议),mask必须完全匹配.</li>
</ol>
</li>
<li>下一跳不可达
<ol>
<li>当路由的下一跳不可达,BGP路由也不会出现在路由表中.</li>
<li>ping</li>
</ol>
</li>
<li>iBGP水平分割:BGP不会宣告从iBGP那里学来的路由
<ol>
<li>全网状连接</li>
<li>RR</li>
<li>联盟</li>
</ol>
</li>
<li>更优的路由</li>
<li>路由过滤
<ol>
<li>show bgp ipv4 unicast(!查看BGP Loc-RIB是否存在某路由)</li>
<li>show bgp ipv4 unicast neighbors <code>ip</code> advertisee-routes(!查看某邻居是否宣告了某路由)</li>
<li>show ip protocols(!查看被应用的路由过滤器)</li>
<li>show bgp ipv4 neighbors <code>ip</code> | include prefix|filter|Route map</li>
</ol>
</li>
</ol>
</li>
<li>路径选择
<ol>
<li>非必要不使用debug</li>
<li>debug ip routing</li>
<li>debug ip bgp</li>
<li>debug ip bgp update</li>
</ol>
</li>
<li>ipv6</li>
<li>MP-BGP</li>
</ol>
<h3 id="redistribute">redistribute </h3>
<p>路由重分发负责将路由从一种路由协议进程注入另一种路由协议进程,路由只会从路由表进入路由信息库.<br>
(当路由不在路由表中,就无法进行重分发操作)</p>
<table>
<thead>
<tr>
<th>路由源</th>
<th>重分发源</th>
<th>重分发目的</th>
</tr>
</thead>
<tbody>
<tr>
<td>静态路由</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>直连路由</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>EIGRP</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>OSPF</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>BGP</td>
<td>Loc-RIB</td>
<td>是</td>
</tr>
</tbody>
</table>
<ul>
<li>重分发是非传递的,被重分发到某个路由协议的路由不会再被重分发.(全网状重分发<code>:)</code>)</li>
<li>被重分发的路由必须位于RIB中.</li>
</ul>
<table>
<thead>
<tr>
<th>协议</th>
<th>默认种子度量</th>
</tr>
</thead>
<tbody>
<tr>
<td>EIGRP</td>
<td>无穷大,不会被安装到拓扑表(topology)中(所以必须手动配置才可以生效)</td>
</tr>
<tr>
<td>OSPF</td>
<td>所有Type 2外部路由,源自BGP种子度量为1,其他为20</td>
</tr>
<tr>
<td>BGP</td>
<td>来源设为不完整,MED设置为源协议度量,权重为32768</td>
</tr>
</tbody>
</table>
<p>路由重分发点称为边界路由器.</p>
<h4 id="配置-15">配置 </h4>
<p>强制选项:在特定情况下必须使用的选项,不使用会导致重分发无法进行</p>
<p>router {eigrp|ospf|bgp} {<code>as</code>|<code>process</code>}</p>
<ol>
<li>EIGRP
<ol>
<li>assress-family {ipv4|ipv6} [vrf <code>vrf-name</code>]
<ol>
<li>redistribute <code>source-protocol</code> [metric <code>bandwidth</code> <code>delay</code> <code>reliability</code> <code>load</code> <code>mtu</code>] (!强制选项) [route-map <code>route-map-name</code>] [include-connected(!ipv6时)]</li>
</ol>
</li>
<li>EIGRP到EIGRP的重分发会保留路径度量</li>
</ol>
</li>
<li>OSPF
<ol>
<li>redistribute <code>source-protocol</code> [subnets(!强制选项)] [metric <code>metric</code>] [metric-type {1|2}] [nssa-only] [tag <code>0-4294967295</code>] [route-map <code>route-map-name</code>] [include-connected(!强制选项)]</li>
<li>OSPF重分发到OSPF会保留路径度量</li>
</ol>
</li>
<li>BGP
<ol>
<li>[bgp redistribute-internal]</li>
<li>redistribute {connected|static|eigrp <code>as-number</code>|ospf <code>process-id</code>[match {internal(!默认值)|external [1|2] (!一般match internal external 2)}]|bgp <code>as-number</code>} [route-map <code>route-map-name</code>]</li>
</ol>
</li>
</ol>
<p>(优先级:路由映射中&gt;redistribute&gt;default-metric)</p>
<h4 id="排错-7">排错 </h4>
<p>网络应该至少存在两个重分发点.</p>
<p>次优路由的问题需要能正确设置默认种子度量.</p>
<p>AD值低的协议重分发到AD高的协议时,如果存在两个以上边界路由器,要小心流量黑洞(例如EIGRP external-&gt;OSPF或当iBGP作为源),可以使用distance命令设置AD值.</p>
<p>始终不应该将被重分发的路由再次重分发到原始路由域中,最好的办法是设置路由标签(tag).使用route-map deny被打上某些标签的路由.</p>
<p>show {ip|ipv6} protocols(!显示重分发源)</p>
<h2 id="路由过滤">路由过滤 </h2>
<p>条件匹配有ACL和前缀列表.路由映射.</p>
<h3 id="acl">ACL </h3>
<p>IP ACL是通过识别数据包,执行某些操作的功能.可以用来过滤ip数据包,不会对帧生效,也无法应用与switchport或没有分配ip的路由端口上,出方向的ACL不能对路由器自己产生的数据包生效.ACL中的一项称为ACE(access control entry).</p>
<p>主要有三点:ACL的位置和方向,匹配模式,匹配行为.每个ip ACL默认有一条deny all.ACL是队列式匹配,先设先匹.</p>
<p>标准ACL只能匹配源ip地址,标号1-99和1300–1999,拓展ACL还可以匹配目的ip,协议,端口,TOS(type of service,服务类别,见Qos)等别的报头信息.拓展ACL匹配ip需要使用host关键字.分配在route port上的称为RACL,在switch port上的称为PACL(only supported only in hardware,and only support inbound traffic filter),在VLAN上的称为VACL.</p>
<ul>
<li>将拓展ACL放在离源近的位置</li>
<li>标准ASL放在离目的更近的位置</li>
<li>变更ACL前,禁用ACL</li>
<li>更精确的ACL在前面</li>
</ul>
<p>特殊ip:</p>
<ul>
<li>224.0.0.9:520(UDP)(RIPv2)</li>
<li>224.0.0.5,224.0.0.6(ospf)</li>
<li>224.0.0.10(EIGRP)</li>
</ul>
<p>在某些情况:拓展ACL的匹配行为会不同:</p>
<ul>
<li>
<p>在匹配IGP网络时,源地址标识网络,目的标识网络区间允许的最小前缀长度.<br>
{permit|deny} <code>protocol</code> host <code>source</code>(!标识子网地址) host <code>destination</code> (!标识最小前缀长度)</p>
</li>
<li>
<p>在匹配BGP网络时,会像前缀匹配一样匹配ip地址和子网掩码.<br>
{permit|deny} <code>protocol</code> <code>source</code> <code>source-wildcard</code>(!两者一起匹配ip地址) <code>destination</code> <code>destination-wildcard</code>(!两者一起匹配子网掩码)</p>
</li>
</ul>
<p>在非插入的情况下,最好不指定序列号,序列号会自动递增10.</p>
<h4 id="interaction">interaction </h4>
<p>bridged traffic processing order:</p>
<ol>
<li>inbound PACL</li>
<li>inbound VACL</li>
<li>outbound VACL</li>
</ol>
<p>routed traffic processing order</p>
<ol>
<li>inbound PACL</li>
<li>inbound VACL</li>
<li>inbound ACL</li>
<li>outbound ACL</li>
<li>outbound VACL</li>
</ol>
<h4 id="配置-16">配置 </h4>
<p>配置模式:</p>
<ul>
<li>access-list {1-99|1300-1999} {permit|deny} {<code>ip</code> <code>source-wildcard</code>(!默认为0.0.0.0)|any}<br>
(!<code>source-wildcard</code>中二进制为1的数可以忽略,即数据包ip(<code>packet-ip</code>&amp;<code>ip</code>)|<code>source-wildcard</code>为全1时表示匹配这条ACL规则,所以当<code>source-wildcard</code>为全0时需要<code>packet-ip</code>完全等于<code>ip</code>).</li>
</ul>
<p>匹配某一子网时,<code>source-wildcard</code>=255.255.255.255-子网对应的掩码,同理,该子网最大范围为子网ip+<code>source-wildcard</code></p>
<ul>
<li>access-list {100-199|2000-2699} {permit|deny} <code>protocol</code> <code>source-IP</code> [<code>source-port</code>] <code>dest-IP</code> [<code>dst-port</code>]<br>
<code>protocol</code>:{ip|tcp|udp|icmp|...}<br>
<code>IP</code>都是<code>ip</code> {<code>wc-mask</code>(!默认为0.0.0.0)| }的格式,端口使用eq,lt,ne,gt,range <code>x</code> to <code>y</code>关键字.</li>
</ul>
<p>(上面两种方式配置的ACL无法删除特定ACE)</p>
<ol>
<li>标准:
<ol>
<li>ip access-list standard {<code>acl-number</code>|<code>name</code>}(!进入命名ACL配置模式,之后无论标准还是拓展,都从{permit|deny}开始)</li>
<li>[sequence] {permit|deny} <code>source</code> <code>source-wildcard</code></li>
</ol>
</li>
<li>拓展:
<ol>
<li>ip access-list extended {<code>acl-number</code>|<code>name</code>}</li>
<li>[sequence] {permit|deny} [<code>protocol</code>] <code>source</code> <code>source-wildcard</code> [<code>source-port</code>] <code>destination</code> <code>destination-wildcard</code> [<code>dst-port</code>]<br>
应用于接口上:</li>
</ol>
</li>
<li>进入接口</li>
<li>(!ipv4)ip access-group {<code>acl-number</code>|<code>name</code>} {in|out}</li>
<li>(!ipv6)ip traffic-filter <code>acl-number</code> {in|out}</li>
</ol>
<table>
<thead>
<tr>
<th>端口号</th>
<th>协议</th>
<th>应用程序</th>
<th>端口代替关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td>20</td>
<td>TCP</td>
<td>FTP数据</td>
<td>ftp-data</td>
</tr>
<tr>
<td>21</td>
<td>TCP</td>
<td>FTP控制</td>
<td>ftp</td>
</tr>
<tr>
<td>22</td>
<td>TCP</td>
<td>SSH</td>
<td></td>
</tr>
<tr>
<td>23</td>
<td>TCP</td>
<td>Telnet</td>
<td>telnet</td>
</tr>
<tr>
<td>25</td>
<td>TCP</td>
<td>SMTP</td>
<td>smtp</td>
</tr>
<tr>
<td>53</td>
<td>UDP,TCP</td>
<td>DNS</td>
<td>domain</td>
</tr>
<tr>
<td>67</td>
<td>UDP</td>
<td>DHCP服务端</td>
<td></td>
</tr>
<tr>
<td>68</td>
<td>UDP</td>
<td>DHCP客户端</td>
<td></td>
</tr>
<tr>
<td>69</td>
<td>UDP</td>
<td>TFTP</td>
<td>tftp</td>
</tr>
<tr>
<td>80</td>
<td>TCP</td>
<td>HTTP</td>
<td>www</td>
</tr>
<tr>
<td>110</td>
<td>TCP</td>
<td>POP3</td>
<td>pop3</td>
</tr>
<tr>
<td>161</td>
<td>UDP</td>
<td>SNMP</td>
<td>snmp</td>
</tr>
<tr>
<td>443</td>
<td>TCP</td>
<td>SSL</td>
<td></td>
</tr>
<tr>
<td>514</td>
<td>UDP</td>
<td>log</td>
<td></td>
</tr>
</tbody>
</table>
<p>接口模式</p>
<ul>
<li>ip access-group <code>group</code> {in|out}(!在接口上以某方向启用某组ACL)</li>
<li>no ip access-group(!禁用ACL)</li>
</ul>
<h5 id="vacl">VACL </h5>
<ol>
<li>vlan access-map <code>name</code></li>
<li>match {ip address <code>acl-number</code>|<code>acl-name</code>}|{mac address <code>acl-name</code>}</li>
<li>action forward|drop|log</li>
<li>vlan filter <code>name</code> <code>vlan-list</code>(!such as 1,2-4,6)(!apply VACL)</li>
</ol>
<h4 id="ipv6-4">ipv6 </h4>
<p>ipv6 ACL没有了标准和拓展之分,也没有了编号的概念(可以把只能匹配源和目的的叫做标准,可以匹配别的成为拓展),和ipv4的一样,默认规则集末尾是包含deny all的,但放行NS和NA消息,对于ACL规则来说,符合根据生产逐渐添加允许的数据包的场景.ipv6 ACL可匹配以下字段:</p>
<ul>
<li>流量类别(DSCP)</li>
<li>流标签</li>
<li>ipv6下一个头部标签和字段???</li>
<li>源和目的</li>
<li>上层头部细节:TCP,UDP端口号;TCP标签SYN,ACK,FIN,PUSH,URG,RST</li>
<li>icmpv6类型和代码</li>
<li>ipv6拓展头部和类型<br>
ipv6对于icmpv6允许是必要的,因为路由的一部分是建立在NDP之上的,所以在末尾隐含允许icmp nd.</li>
</ul>
<h5 id="配置-17">配置 </h5>
<ul>
<li>ipv6 access-list <code>ACL名称</code> {permit | deny} <code>协议</code> <code>源地址/源前缀长度</code> <code>目标地址/目标前缀长度</code> <code>源端口</code> <code>目标端口</code> [参数选项]</li>
</ul>
<h3 id="前缀匹配">前缀匹配 </h3>
<p>前缀列表用于识别特定ip地址,网络或网络区间.</p>
<p>前缀匹配结构包括高阶比特模式(也叫地址或网络)和高阶比特数(也叫掩码长度),一般其后带匹配长度参数.</p>
<p>例如:a.b.c.d/e ge/le f.代表a.b.c.d二进制前e位匹配.子网掩码ge/le f位.</p>
<h4 id="配置-18">配置 </h4>
<p>ip prefix-list <code>name</code> [seq <code>sequence-number</code>] {permit|deny} <code>high-order-bit-pattern</code>/<code>high-order-bit-count</code> [ge <code>ge-value</code>] [le <code>le-value</code>] (!高阶比特模式/高阶比特数 [匹配长度参数],要求:高阶比特数&lt;ge-value&lt;=le-value)</p>
<p>ipv6 prefix-list <code>name</code> [seq <code>sequence-number</code>] {permit|deny} <code>high-order-bit-pattern</code>/<code>high-order-bit-count</code> [ge <code>ge-value</code>] [le <code>le-value</code>]</p>
<p>在非插入的情况下,最好不指定序列号,序列号会自动递增5.</p>
<h3 id="路由映射">路由映射 </h3>
<p>路由映射包括 1. 序列号 2. 条件匹配规则(空则默认所有路由都匹配) 3. 处理操作 4. 可选操作</p>
<p>执行顺序为,依次匹配每个route-map中的条件匹配,如果匹配成功,则进行<strong>处理操作</strong>和<strong>可选操作</strong>,除非可选操作中有continue,不然停止;所有route-map都未匹配成功的执行隐含的处理操作deny(所以一般都要接一条空的permit route-map标识允许其余所有).</p>
<p>同一类型多个度量是or关系.多个条件匹配之间是and关系.</p>
<h4 id="配置-19">配置 </h4>
<p>route-map <code>route-map-name</code> [permit|deny] (!默认为permit) [<code>sequence-number</code>]</p>
<p>常用条件匹配选项:</p>
<ol>
<li>match as-path <code>acl-number</code></li>
<li>match community <code>community-list</code>(!bgp团体)</li>
<li>match interface <code>interface</code></li>
<li>match ip address [<code>acl-number</code>|<code>acl-name</code>]</li>
<li>match {ip|ipv6} address prefix <code>prefix-list-name</code></li>
<li>match local-preference(!???)</li>
<li>match metric {<code>1-4294967295</code>|external <code>1-4294967295</code>} [+- <code>deviation</code>]</li>
<li>match source-protocol {<code>bgp-asn</code>|connected|eigrp <code>asn</code>|ospf <code>process-id</code>|static}</li>
<li>match tag <code>tag-value</code></li>
</ol>
<p>常用可选操作:</p>
<ol>
<li>set操作:
<ol>
<li>set as-path prepend {<code>as-number-pattern</code>|last-as <code>1-10</code>}</li>
<li>set ip next-hop {<code>ip-address</code>|peer-address self}</li>
<li>set local-preference <code>0-4294967295</code></li>
<li>set metric [+|-] <code>value</code></li>
<li>set origin {igp|incomplete}</li>
<li>set tag <code>tag-value</code></li>
<li>set weight <code>0-65535</code></li>
<li>set metric <code>bandwidth</code> <code>delay</code> <code>reliability</code> <code>load</code> <code>mtu</code>(!EIGRP覆盖种子度量)</li>
</ol>
</li>
<li>continue(!不常使用)</li>
</ol>
<h3 id="pbrpolicy-based-routing条件转发">PBR(Policy-Based Routing,条件转发) </h3>
<p>根据数据包特征进行条件转发.(拓展性方面存在管理负担,缺乏网络智能,故障排查复杂!!!)</p>
<ol>
<li>协议类型(ICMP,TCP,UDP等)</li>
<li>源IP,目的IP</li>
<li>时延,链路速率,特定瞬时流量</li>
</ol>
<h4 id="配置-20">配置 </h4>
<ol>
<li>route-map <code>route-map-name</code> [permit|deny] [<code>sequence-number</code>]</li>
<li>定义条件匹配规则
<ol>
<li>match length <code>minimum-length</code> <code>maximum-length</code>(!定义数据包长度匹配)</li>
<li>match ip address {<code>acl-number</code>|<code>acl-name</code>}</li>
</ol>
</li>
<li>set ip [default] next-hop <code>ip-address</code> [<code>...ip-address</code>] (!设定default时,仅在RIB无目的地址时修改下一跳)</li>
<li>ip [local] policy router-map <code>route-map-name</code>(!设置local,对本地路由器生成的数据包生效)</li>
</ol>
<h2 id="object-track">object track </h2>
<ul>
<li>track <code>track-id</code> ip route <code>route</code> reachability</li>
<li>track <code>track-id</code> interface <code>interface</code> line-protocol</li>
<li>show track [<code>track-id</code>]</li>
</ul>
<h2 id="fhrp">FHRP </h2>
<p>对第一跳路由增加冗余设计的协议,即有多个任务相同的路由器使用同一个虚拟ip地址,也可用于负载均衡.FHRP协议族包括HSRP(Hot standby redundancy protocols,Cisco proprietary),VRRP(Virtual Router Redundency Protocol),GLBP(Gateway Load Balancing Protocol).</p>
<h3 id="hsrp">HSRP </h3>
<p>在HSRP中,优先级更高的路由器会成为活跃路由器,其他称为备份路由器.备份路由器会将自己的数据包路由到活跃路由器.当需要负载均衡时,可以让不同子网中的活跃路由器不同.Virtual address is configured on each HSRP-enabled interface that belongs to the same group,one of interfaces become active router.</p>
<p>如果没有设置抢占机制,当子网中已有一个活跃路由器时,新设置的路由器即使优先级更高也不会成为活跃路由器.</p>
<p>Its virtual MAC is 0000.0C07.ACxx</p>
<p>Default hello time and hold time:3s,10s</p>
<div class="mermaid">flowchart TB

initial---&gt;learn
learn---&gt;listen
listen---&gt;speak
speak---&gt;standby/active
</div><h4 id="hsrp配置">HSRP配置 </h4>
<p>接口模式:</p>
<ol>
<li>standby version 2(!版本需要相同)</li>
<li>standby <code>instance-id</code> ip <code>virtual-ip</code>(!VIP)</li>
<li>(!mac)standby <code>instance-id</code> mac-address <code>mac-address</code></li>
<li>(!timers) standby <code>instance-id</code> timers {<code>seconds</code>|msec <code>milliseconds</code>}</li>
<li>(!authentication)standby <code>instance-id</code> authentication {<code>text-password</code>|text <code>text-password</code>|md5 {key-chain <code>key-chain</code>|key-string <code>key-string</code>} }</li>
<li>(!priority)standby <code>instance-id</code> priority <code>num</code>(!higher priority is preferd,then higher ip)(!100 by default)</li>
<li>(!name)standby <code>instance-id</code> name <code>name</code></li>
<li>(!preempt)standby <code>instance-id</code> preempt(!抢占机制,默认no standby preempt)</li>
<li>(!track)standby <code>instance-id</code> track <code>track-id</code> decrement <code>decrement-value</code>(!setting preemtion first)</li>
<li>(!use bia)standby use-bia(!When you enable this command, the router uses its Burned-In Address (BIA), which is the unique MAC address physically assigned to the router’s network interface card (NIC), instead of the default virtual MAC address for HSRP.)</li>
</ol>
<h3 id="vrrp">VRRP </h3>
<p>operating similar to HSRP.</p>
<ul>
<li>master router and backup router.</li>
<li>enables preemtion by default</li>
<li>MAC use 0000.5e00.01xx(xx is group id in hex)</li>
<li>using 224.0.0.18 for communication</li>
<li>The TTL for VRRP packets must be 255(why???)</li>
<li>only vrrpv3 support ipv6 in FHRPs</li>
</ul>
<h4 id="vrrp-configure">VRRP configure </h4>
<p>vrrpv2:</p>
<ol>
<li>vrrp <code>instance-id</code> ip <code>virtual-ip</code>(!VIP)</li>
<li>(!authentication)vrrp <code>instance-id</code> authentication {<code>text-password</code>|text <code>text-password</code>|md5 {key-chain <code>key-chain</code>|key-string <code>key-string</code>} }</li>
<li>(!可选)vrrp <code>instance-id</code> priority <code>num</code>(!higher priority is preferd,then higher ip)</li>
<li>(!track)vrrp <code>instance-id</code> track <code>track-id</code> decrement <code>decrement-value</code>(!setting preemtion first)</li>
</ol>
<p>vrrpv3:</p>
<ol>
<li>fhrp version vrrp v3</li>
<li>vrrp <code>instance-id</code> address-family {ipv4|ipv6}
<ol>
<li>(!compatibility) vrrpv2</li>
<li>address <code>address</code></li>
<li>priority <code>num</code></li>
<li>track <code>track-id</code> decrement <code>decrement-value</code></li>
</ol>
</li>
</ol>
<h3 id="glbp">GLBP </h3>
<p>ensuring each member of GLBP group takes care of forwarding the traffic.</p>
<ul>
<li>AVG(active virtual gateway):replying to the ARP request with the virtual MAC of the AVF</li>
<li>AVF(active virtual forwarder):receiving the virtual MAC address from AVG,then being assigned to a host</li>
</ul>
<p>glbp supports four active ACFs and one AVG per group.A router can be an AVG and an AVF at the same time.</p>
<h4 id="glbp-configure">glbp configure </h4>
<ol>
<li>glbp <code>instance-id</code> ip <code>virtual-ip</code></li>
<li>glbp <code>instance-id</code> preempt</li>
<li>glbp <code>instance-id</code> priority <code>num</code></li>
<li>glbp <code>instance-id</code> timers {<code>seconds</code>|msec <code>milliseconds</code>}</li>
<li>glbp <code>instance-id</code> authentication {<code>text-password</code>|text <code>text-password</code>|md5 {key-chain <code>key-chain</code>|key-string <code>key-string</code>} }</li>
<li>(!enter interface configure)
<ol>
<li>glbp <code>instance-id</code> load-balancing {host-dependent|round-robin|weighted}</li>
<li>glbp <code>instance-id</code> weighting <code>weight</code></li>
</ol>
</li>
</ol>
<h3 id="排错-8">排错 </h3>
<table>
<thead>
<tr>
<th>场景</th>
<th>路由器都活跃?</th>
<th>重复ip?</th>
<th>根据活跃路由器改变VIP</th>
</tr>
</thead>
<tbody>
<tr>
<td>HSRP版本不匹配</td>
<td>是</td>
<td>是</td>
<td>N/A</td>
</tr>
<tr>
<td>HSRP组号码不匹配</td>
<td>是</td>
<td>是</td>
<td>N/A</td>
</tr>
<tr>
<td>ACL阻塞HSRP数据包</td>
<td>是</td>
<td>否</td>
<td>N/A</td>
</tr>
<tr>
<td>VIP不同</td>
<td>否</td>
<td>N/A</td>
<td>是</td>
</tr>
</tbody>
</table>
<h2 id="multicast">multicast </h2>
<p>multicast provide one-to-many communication. 224.0.0.0/4(to 239.255.255.255)is for multicast addressing.<br>
rely on IGMP(Internet Group Management Protocol) and PIM(Protocol Independent Multicast).</p>
<table>
<thead>
<tr>
<th>designing</th>
<th>address range</th>
<th>introduction</th>
</tr>
</thead>
<tbody>
<tr>
<td>Local Network control block</td>
<td>224.0.0.0 to 224.0.0.255</td>
<td>not be forwarded outside of a broadcast domain</td>
</tr>
<tr>
<td>Internet control network</td>
<td>224.0.1.0 to 224.0.1.255</td>
<td>may be forwarded outside through Internet</td>
</tr>
<tr>
<td>All hosts</td>
<td>224.0.0.1</td>
<td></td>
</tr>
<tr>
<td>All routers</td>
<td>224.0.0.2</td>
<td></td>
</tr>
<tr>
<td>All OSPF routers</td>
<td>224.0.0.5</td>
<td></td>
</tr>
<tr>
<td>All OSPF DRs</td>
<td>224.0.0.6</td>
<td></td>
</tr>
<tr>
<td>All RIPv2</td>
<td>224.0.0.9</td>
<td></td>
</tr>
<tr>
<td>All EIGRP</td>
<td>224.0.0.10</td>
<td></td>
</tr>
<tr>
<td>PIM</td>
<td>224.0.0.13</td>
<td></td>
</tr>
<tr>
<td>HSRPv2</td>
<td>224.0.0.102</td>
<td></td>
</tr>
<tr>
<td>NTP</td>
<td>224.0.1.1</td>
<td></td>
</tr>
<tr>
<td>organization-local scope(administratively scoped block)(used for an enterprise's internal network)</td>
<td>239.0.0.0 to 239.255.255.255</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="igmpv2-and-v3">IGMPv2 and v3 </h3>
<p>IGMP manages the joining, and leaving of multicast groups.</p>
<p>IGMP message's ip protocol number is 2, ttl is 1.</p>
<p>IGMPv3 can specify the source it would like to receive multiple traffic from for its membership report(join) by using include mode and exclude mode to filter the sources.</p>
<ul>
<li>type(8bit)
<ul>
<li>version3/2/1 membership report(called join too)</li>
<li>version2 leave group</li>
<li>general membership query,send to all hosts(224.0.0.1) to see any members are in the attached subnet.set group address to 0.0.0.0.</li>
<li>group specific query:response to a leave group message</li>
</ul>
</li>
<li>max response time(8bit)</li>
<li>checksum(16bit)</li>
<li>group address(32bit)</li>
</ul>
<p>router with lowerst ip address is elected the IGMP Querier when more than one router is in the same LAN segment</p>
<h4 id="igmp-snooping">IGMP snooping </h4>
<p>IGMP snooping can let switch snoop IGMP report(join) message to adjust its mac address table for better multicast.</p>
<p>The switch listens for PIM or IGMP messages to identify which port is connected to the multicast router (mrouter) port.</p>
<p>IGMP membership report messages from hosts are used to identify the ports that have interested receivers.</p>
<h5 id="ip-to-mac">ip to mac </h5>
<p>mac=01005E+binary(0)+binary(ip)[-23:],the 8th bit is called I/G(individual/group)bit for the '01'.</p>
<h3 id="pim">PIM </h3>
<p>multicast route protocol is to locate and request multicast streams from other routers,using ip protocol number 103,one of them is PIM</p>
<p>PIM distribution trees include source trees(also known as <strong>SPTs</strong>(shortest path trees)),and shared trees(also refered to as <strong>RPTs</strong>(rendezvous point trees),root named RP).</p>
<p>use (S(!server address),G(!group address)) to notate a source tree,and (*,G) to notate a share tree.Use notation on nodes of a tree.</p>
<ul>
<li>RPF(Reverse Path Forwarding) interface:the interface with lowest-cost path to the source.(SPT or RP).(if costs are equal,prefer higher ip)</li>
<li>RPF neighbor:PIM neighbor on the RPF interface.</li>
<li>Upstream/Incoming interface(IIF):flows from the receiver to the source,which is the same as RPF interface.</li>
<li>Downstream/Outgoing interface(OIF):Away from the source of the tree and toward the receivers.</li>
<li>LHR(last-hop router):attached to the receiver</li>
<li>FHR(first-hop router):attached to the source</li>
<li>MRIB(multicast RIB):contains S,G,IIF,OIFs,RPF neighbor</li>
<li>MFIB(multicast FIB):</li>
<li>Multicast state:composed of(S,G,IIF,OIF,and so on).</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>Des</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hello</td>
<td>all PIM</td>
</tr>
<tr>
<td>Register</td>
<td>RP</td>
</tr>
<tr>
<td>Reister stop</td>
<td>FHR</td>
</tr>
<tr>
<td>join/prune</td>
<td>all PIM</td>
</tr>
<tr>
<td>Bootstrap</td>
<td>all</td>
</tr>
<tr>
<td>Assert</td>
<td>all</td>
</tr>
<tr>
<td>Candidate RP???</td>
<td></td>
</tr>
<tr>
<td>State fresh</td>
<td>all</td>
</tr>
<tr>
<td>DF election</td>
<td>all</td>
</tr>
</tbody>
</table>
<h4 id="dense-modepim-dm">Dense mode(PIM-DM) </h4>
<p>if a router has active receviers,the flooding tree continue to flood.If no receivers requested the multicast stream,the router sends a prune message which prunes off the branch.</p>
<p>prunes expire every three minutes.</p>
<p>not widely deployed.</p>
<h4 id="spare-mode">Spare mode </h4>
<ol>
<li>receiver send an IGMP join to LHR
<ol>
<li>LHR send a PIM join (*,G) to RP hop-by-hop,building a branch of the shared tree connecting RP with LHR</li>
</ol>
</li>
<li>source sends a multicast packet
<ol>
<li>FHR sends a unidirectional PIM register message,which encaptulates the multicast data in a PIM-SM message.</li>
<li>RP will unicast a register stop message if there's no shared tree</li>
<li>not so it will forwards the multicast packet down the shared tree</li>
<li>RP send a PIM join (S,G) to FHR</li>
<li>RP receives data down the SPT,RP sends a register stop to FHR</li>
</ol>
</li>
<li>LHR receives a packet down the SPT and then the shared tree,it sends a (S,G) PIM join.
<ol>
<li>if the SPT RPF differs from the RPT RPF,the LHR will receive duplicate multicast traffic,it will switch the RPF interface to the SPT RPF interface and send a (S,G) PIM prune message to the RP</li>
</ol>
</li>
<li>when multiple routers exist in a lan,elect a DR.(like OSPF)
<ol>
<li>higher priority is prefered(default 1)</li>
</ol>
</li>
</ol>
<h5 id="rpf">RPF </h5>
<p>packets need to arrive on the RPF interface(use to send unicast to the source for FHR,to the RP for the LHR),then are forwarded to OIF(interface in OIL),not so packets will be discarded.</p>
<h5 id="rp">RP </h5>
<ol>
<li>static<br>
need to configure on every router in the multicast domain</li>
<li>auto-RP(cisco proprietary)
<ol>
<li>
<p>candidate RPs(C-RPs)</p>
</li>
<li>
<p>RP mapping Agents(MAs)</p>
</li>
<li>
<p>A C-RP advertise RP announcement message(higher ip is prefered)</p>
<ol>
<li>(per 60s,224.0.1.39,default group 224.0.0.0/4(con be configured))</li>
</ol>
</li>
<li>
<p>MAs join group 224.0.1.39 to receive the RP announcements.</p>
</li>
<li>
<p>MAs advertise the RP mappings to 224.0.1.40.</p>
<ol>
<li>MA announcement contains elected RPs and group-to-RP mapping.</li>
</ol>
</li>
</ol>
</li>
<li>PIM Bootstrap Router
<ol>
<li>highest priority and then highest ip C-BSR(candidate BSR) become BSR<!-- 1. BSR discover and announce RP set information. -->
</li>
<li>BSR floods BSMs(bootstrap message) hop-by-hop with address 224.0.0.13 and TTL of 1</li>
<li>C-RP(candidate RP) unicast C-RP-Adv(candidate RP advertisement) to BSR after reveiving BSM and know the address of BSR</li>
<li>BSR sends the list of all C-RP-Advs in its group-to-RP mapping cache per 60s.</li>
<li>C-RPs use hashing algorithm to elect active RP.<!-- 1. multicast group range
1. RP priority
2. RP address
3. Hash mask
4. SM/ -->
</li>
</ol>
</li>
</ol>
<h4 id="pim-forwarder">PIM forwarder </h4>
<p>When a specific (S,G) is received into its OIF,triggers the assert mechanism.</p>
<ul>
<li>router will send PIM assert message into the LAN,message is composed of its AD and metric.</li>
<li>lower ad, then lower metric,then higher ip will remains,and the losing one prunes its interface.</li>
<li>prunes remain three minutes on the losing router.</li>
</ul>
<p>commonly used by PIM-DM,rarely by PIM-SM.</p>
<h1 id="lan">LAN </h1>
<p>mac address-table reside in CAM(content addressable memory,faster ram)</p>
<p>几台pc通过一台交换机连接时,组成一个LAN.它们同属一个广播域(发送的所有消息会被所有同一广播域的设备接收).现在的各种链路都使用的是Ethernet(以太网标准).Ethernet规定了物理层和数据链路层的行为和标准,lan中定位使用MAC地址.</p>
<h2 id="vlan">VLAN </h2>
<p>交换机默认广播域为所有接口,可以通过设置vlan将特定某几个接口组成独立的广播域.<br>
默认所有接口属于vlan 1.<br>
正常范围1<sub>1005,所有交换机可以正常使用,拓展范围1006</sub>4094</p>
<p>vlan encapsulation only across trunk:<br>
TPID(Tag protocol identifier):16bit<br>
PCP(priority code point):3bit<br>
DEI(Drop eligible indicator):1bit,whether the packet can be dropped<br>
VLAN-id:12bit</p>
<h3 id="配置-21">配置 </h3>
<p>进入某个或某些接口:</p>
<ol>
<li>switchport access vlan <code>num</code></li>
<li>switchport mode access(!无1默认为native vlan)</li>
</ol>
<h3 id="语音vlan">语音vlan: </h3>
<p>interface FastEthernet0/1<br>
switchport access vlan 1<br>
switchport voice vlan 1</p>
<h3 id="trunk">trunk </h3>
<p>802.1q.设置两台交换机,或一台交换机一台路由器之间,甚至一台服务器与交换机之间的接口为trunk,可以只用一条链路充当多个vlan之间的链路,可以使用DTP(Dynamic Trunking Protocol)协商.</p>
<p>native vlan穿越trunk不用添加头.(思科建议修改为一个没有主机连接交换机的???完全不用的vlan)</p>
<h4 id="配置-22">配置 </h4>
<p>接口模式:</p>
<ol>
<li>switchport trunk encapsulation {dot1q|negotiate}</li>
<li>switchport mode {trunk|dynamic desirable(主动协商)|dynamic desirable auto(被动允许)}(!如果双方都是dynamic desirable,会在第一次配置的时候主动协商,但是可能会失败,最后只是access,最好有一者默认trunk)</li>
</ol>
<ul>
<li>switchport trunk allowed vlan {[remove|add] <code>vlan</code>|none|all}(!不中继某些vlan)</li>
<li>switchport trunk native vlan <code>num</code></li>
</ul>
<p>配置模式:</p>
<ul>
<li>vlan <code>vlan-id</code></li>
</ul>
<h2 id="vtp">VTP </h2>
<p>通告vlan配置的协议,每一次修改会增加vlan配置数据库的版本并同步到整个vtp域中.客户端不能对vlan配置</p>
<p>vtp修剪:trunk目的接口的所有vlan中没有某些vlan接口时过滤掉对应的vlan通告.配置在服务端.</p>
<h3 id="配置-23">配置 </h3>
<p>配置模式:</p>
<ol>
<li>vtp mode {server|client|transparent(!透明,转发但不应用配置)|off(!禁用)}</li>
<li>vtp domain <code>domain-name</code></li>
<li>vtp password <code>passwordvalue</code></li>
<li>vtp pruning(vtp修剪)</li>
</ol>
<h2 id="交换机堆栈和机框汇聚">交换机堆栈和机框汇聚 </h2>
<h3 id="堆栈">堆栈 </h3>
<p>将多台交换机使用堆栈接口(stacking port)通过FlexStack(-plus)组成一个逻辑交换机,一般用在接入层</p>
<h3 id="机框汇聚chassis-aggregation">机框汇聚(chassis aggregation) </h3>
<p>使用以太网接口汇聚交换机,组成一个逻辑交换机,多用在分布层和核心层</p>
<h2 id="stp-rstprapid-and-pvst">STP, RSTP(rapid) and PVST </h2>
<p>在设计Ethernet网络时,冗余是必要的.但二层的冗余可能导致产生环回,STP(802.1D)可以通过自动禁用某些端口解决环回问题.RSTP(802.1W)是更快速的STP,新增备份端口.PVST+(ieee in show command)是可以对不同vlan调整不同生成树的STP.rapid-pvst(rstp in show command)是使用rstp的pvst,cisco私有.mst(802.1S)是针对相似vlan只创建一个rstp实例.</p>
<h3 id="bpdu">BPDU </h3>
<p>In STP,</p>
<ul>
<li>configuration BPDU:election(prefer low priority and then inferior mac)</li>
<li>TCN BPDU</li>
</ul>
<p>In RSTP, the BPDU type field distinguishes between RSTP BPDUs and the traditional STP BPDUs.</p>
<h3 id="mst">MST </h3>
<p>Multiple Spanning Tree Protocol(MST) can compute 1 instance(MST instance) for one or multiple vlans(they share identical topology).MST instance 0 called IST runs on all interfaces of all swicths.</p>
<p>MST region is like a single switch for connected non-MST switch.</p>
<p>The MSTI topology is independent from the individual VLAN. It is a best practice to remove all VLANs that are part of the same MSTI when pruning is required.</p>
<h4 id="配置-24">配置 </h4>
<ol>
<li>spanning-tree mode mst</li>
<li>spanning-tree mst <code>instance-number</code> {priority <code>priority</code>|root {primary|secondary} }</li>
<li>spanning-tree mst configuration
<ol>
<li>instance <code>instance-number</code> vlan <code>vlan-id</code></li>
</ol>
</li>
<li>rivision <code>version</code></li>
<li>name <code>regio-name</code></li>
</ol>
<h3 id="topology-change">Topology change </h3>
<p>switch that detects a link status change sends a TCN(topology change notification).Upon receipt of the TCN,the root bridge sends a configuration BPDU with the topology change flag set. This flush out MAC addresses table for devices those have not communicated in 15s window when switch received TCN.</p>
<h3 id="原理">原理 </h3>
<p>先选举根交换机,再选举根端口,再在每个网段中选举指定端口.将拓扑结构中的图消去环变成树.</p>
<ul>
<li>根开销:去往根交换机的开销总和,一台交换机BPDU消息中只有一个最小根开销,但各个端口的根开销不同</li>
<li>选举根网桥:prefer lower priority(32768 by default) and then mac address.</li>
<li>选举根端口(RP):lowest path cost and then lowest priority and the lowest mac.(cost is based on the link speed,priority is 128 by default)</li>
<li>选举指定端口(DP):not RP and lower path cost continue forward,then lower priority and mac switch continue forward.</li>
</ul>
<table>
<thead>
<tr>
<th>状态</th>
<th>STP</th>
<th>RSTP</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>禁用</td>
<td>丢弃</td>
</tr>
<tr>
<td></td>
<td>阻塞</td>
<td>丢弃</td>
</tr>
<tr>
<td></td>
<td>侦听</td>
<td>无</td>
</tr>
<tr>
<td></td>
<td>学习</td>
<td>学习</td>
</tr>
<tr>
<td></td>
<td>转发</td>
<td>转发</td>
</tr>
</tbody>
</table>
<h3 id="configure">configure </h3>
<ol>
<li>spanning-tree mode {pvst|rapid-pvst|mst}</li>
<li>spanning-tree vlan <code>vlan-id</code> {priority <code>x</code>|root primary|root secondary}(!x mod 4096 === 0)</li>
<li>interface <code>interface</code>
<ol>
<li>spanning-tree [vlan <code>vlan-id</code>] cost <code>x</code>(!based on link speed by default)</li>
<li>spanning-tree [vlan <code>vlan-id</code>] port-priority <code>priority</code>(!128 by default)</li>
</ol>
</li>
</ol>
<h3 id="特性">特性 </h3>
<h4 id="1-etherchannel8023ad">1. EtherChannel(802.3AD) </h4>
<p>多个物理链路视为同一逻辑链路,在逻辑链路上某一链路出问题时不需要STP收敛.也可用于负载均衡.</p>
<ul>
<li>PAgP:cisco proprietary
<ul>
<li>0100:0CCCC:CCCC</li>
</ul>
</li>
<li>LACP
<ul>
<li>0180:C200:0002</li>
</ul>
</li>
</ul>
<p>can set minimum and maxmum for 1 Etherchannel interface.</p>
<ul>
<li>LACP system priority choose which switch to be the primary switch for Etherchannel. Primary switch desides which interface to be active based on   interface priority when more interfaces than maxmum.</li>
</ul>
<h4 id="2-portfast">2. PortFast </h4>
<p>让端口从阻塞立刻过渡到转发状态,适用于与终端设备相连的接口</p>
<h4 id="3-bpdu-guard">3. BPDU guard </h4>
<p>在PortFast端口上,收到BPDU信息时,将端口禁用,保护stp安全</p>
<h4 id="4端口类型">4.端口类型 </h4>
<p>为共享(share)则为半双工,为边缘(edge)则启用了portfast.</p>
<h4 id="5-root-guard">5. root guard </h4>
<p>部署在指向永远也不会成为根桥的交换机的接口上.</p>
<h4 id="6-bpdu-filter">6. bpdu filter </h4>
<p>blocks BPDUs from being transmitted out a port.</p>
<h4 id="7-loop-guard">7. loop guard </h4>
<ul>
<li>When BPDUs are not received, the port moves to the BKN status (loop inconsistent) until BPDUs are received again.</li>
<li>Loop guard is configured on root ports.</li>
</ul>
<h3 id="配置-25">配置 </h3>
<p>接口模式:</p>
<ul>
<li>(!EtherChannel)
<ol>
<li>channel-group <code>number</code> mode {on(!另一端只能为on)|desirable(!另一端可以为auto)(!use PAgP)|activate(!另一端可以为passive)(!use LACP)}</li>
<li>(!在交换机的路由端口上时,物理和逻辑上都要使用)no switchport</li>
</ol>
</li>
<li>(!PortFast)
<ul>
<li>spanning-tree portfast [default|trunk]</li>
</ul>
</li>
<li>(!BPDU)
<ul>
<li>spanning-tree portfast bpduguard default</li>
<li>spanning-tree bpduguard {enable|disable}</li>
</ul>
</li>
<li>(!root guard)
<ul>
<li>spanning-tree guard root</li>
</ul>
</li>
<li>(!bpdu filter)
<ul>
<li>spanning-tree portfast bpdufilter default</li>
<li>spanning-tree bpdufilter enable</li>
</ul>
</li>
<li>(!problems with unidirectional links)
<ol>
<li>stp loop guard</li>
<li>udld ???</li>
</ol>
<!-- 2. unidirectional links detection -->
</li>
</ul>
<h3 id="排错-9">排错 </h3>
<ul>
<li>etherchannel points
<ul>
<li>configuration must match on the member interfaces.
<ul>
<li>port type</li>
<li>port mode</li>
<li>native vlan</li>
<li>allowed vlan</li>
<li>speed</li>
<li>duplex</li>
<li>mtu</li>
<li>load interval(???)</li>
<li>storm control</li>
</ul>
</li>
</ul>
</li>
<li>etherchannel commands
<ul>
<li>show etherchannel summary</li>
<li>show interface port-channel <code>num</code></li>
<li>show etherchannel port(!very detailed)</li>
<li>show {lacp|pagp} neighbor [detail]</li>
<li>show {lacp|pagp} counters</li>
</ul>
</li>
</ul>
<h2 id="端口安全">端口安全 </h2>
<p>允许某端口最多有多少个mac地址传入帧,如果违规执行定义的行为,默认是丢弃所有帧.</p>
<h3 id="配置-26">配置 </h3>
<p>配置模式:</p>
<ol>
<li>switchport port-security</li>
<li>(!可选)switchport port-security maximum <code>max-num</code></li>
<li>(!可选)switchport port-security violation {protect|restrict|shutdown}(!收到规定地址之外的帧时的动作,默认是关闭接口)</li>
<li>(!可选)switchport port-security mac-address <code>mac-address</code>(!允许的mac地址)</li>
<li>(!可选)switchport port-security macaddress sticky(!动态配置mac地址)</li>
<li>(!aging time)switchport port-security aging-time <code>seconds</code></li>
</ol>
<h2 id="排错-10">排错 </h2>
<ul>
<li>erase startup-config不能清楚数据库中的vlan配置,需要delete flash:vlan.dat</li>
<li>vtp域要相同才能同步</li>
<li>md5摘要相同(域名和密码)</li>
<li>加入新交换机,可以将交换机配置为transparent清除之前的记录,再配置为服务端或客户端</li>
<li>show etherchannel summary</li>
</ul>
<h3 id="stp">STP </h3>
<ol>
<li>判断根交换机,根端口<br>
show spanning-tree,show spanning-tree root查看根交换机</li>
<li>计算根开销</li>
</ol>
<table>
<thead>
<tr>
<th></th>
<th>10M</th>
<th>100M</th>
<th>1G</th>
<th>10G</th>
</tr>
</thead>
<tbody>
<tr>
<td>根开销</td>
<td>100</td>
<td>19</td>
<td>4</td>
<td>2</td>
</tr>
</tbody>
</table>
<ol start="3">
<li>判断指定端口<br>
根开销相等时判断BID,小者胜出</li>
</ol>
<h3 id="etherchannel">EtherChannel </h3>
<ul>
<li>关键字要匹配</li>
<li>STP开销相等</li>
</ul>
<h3 id="trunk-1">Trunk </h3>
<ul>
<li>vlan要匹配</li>
<li>native vlan要匹配</li>
</ul>
<h2 id="其他">其他 </h2>
<ol>
<li>路由器直连交换机可以在路由器上设子接口,子接口中分配ip和encapsulation,与其相连的交换机使用trunk.</li>
<li>使用SVI(vlan虚拟接口)配置路由.相当于在每个vlan在交换机上有一个路由接口.但是不会默认配置路由协议,相当于只能在交换机有的vlan间路由.可以自己配置路由协议进行学习.(核心层和分布层)</li>
<li>交换机也可以使用路由端口实现vlan间路由,此时这个物理端口在逻辑上就是一个路由器的端口一样使用.(点对点链路中使用)</li>
</ol>
<h3 id="配置-27">配置 </h3>
<ol>
<li>ROAS
<ol>
<li>interface <code>type</code> <code>num</code>.<code>num</code>(!进入子接口)</li>
<li>encapsulation {dot1q|negotiate} vlan <code>num</code></li>
<li>ip address <code>ip</code> <code>mask</code></li>
</ol>
</li>
<li>SVI
<ol>
<li>sdm prefer lanbase-routing(!重启后分配更多资源给路由)</li>
<li>(!可选,EXEC模式)reload</li>
<li>ip routing(!启用ip路由)</li>
<li>进入需要配置的vlan接口</li>
<li>ip address <code>ip</code> <code>mask</code></li>
<li>(!可选)no shutdown</li>
</ol>
</li>
<li>no switchport
<ol>
<li>进入需要配置的接口</li>
<li>no switchport</li>
<li>ip address <code>ip</code> <code>mask</code></li>
</ol>
</li>
</ol>
<h2 id="wireless">Wireless </h2>
<h3 id="theory">theory </h3>
<ul>
<li>
<p>wave</p>
<ul>
<li>frequency
<ul>
<li>hertz(Hz)</li>
<li>range as band</li>
<li>needed for the transmitted named bandwidth</li>
<li>RF(radio frequency):3kHz to 300GHz</li>
</ul>
</li>
<li>phase</li>
<li>wavelength</li>
<li>RF Power
<ul>
<li>
<p>watts(W)</p>
</li>
<li>
<p>decibel(db):use logarithm to compare two wave's power</p>
<table>
<thead>
<tr>
<th>Power change</th>
<th>db Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>=</td>
<td>0db</td>
</tr>
<tr>
<td>*/2</td>
<td>+-3</td>
</tr>
<tr>
<td>*/10</td>
<td>+-10</td>
</tr>
</tbody>
</table>
<ul>
<li>dbm:dBm是指相对于1毫瓦（mW）的功率级别。它是一个绝对功率的度量标准。
<ul>
<li>1 mW对应0 dBm，10 mW对应10 dBm。</li>
</ul>
</li>
<li>dBi表示天线增益相对于理想各向同性天线（即在所有方向上均匀辐射能量的假想天线）的增益。
<ul>
<li>例如，一个天线增益为5 dBi，意味着它比各向同性天线在最佳方向上强5 dB。</li>
<li>dBi=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>B</mi><mi>d</mi><mo>+</mo><mn>2.15</mn></mrow><annotation encoding="application/x-tex">dBd+2.15</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2.15</span></span></span></span></li>
</ul>
</li>
<li>EIRP表示一个天线在其最大增益方向上辐射的等效功率。
<ul>
<li>Be regulated by government agencies in most countries</li>
<li>EIRP&nbsp;(dBm)=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>发射功率&nbsp;</mtext><mo stretchy="false">(</mo><mi>d</mi><mi>B</mi><mi>m</mi><mo stretchy="false">)</mo><mo>+</mo><mtext>天线增益&nbsp;</mtext><mo stretchy="false">(</mo><mi>d</mi><mi>B</mi><mi>i</mi><mo stretchy="false">)</mo><mo>−</mo><mtext>馈线损耗&nbsp;</mtext><mo stretchy="false">(</mo><mi>d</mi><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">发射功率&nbsp;(dBm)+天线增益&nbsp;(dBi)−馈线损耗&nbsp;(dB)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">发射功率</span><span class="mord">&nbsp;</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">天线增益</span><span class="mord">&nbsp;</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">馈线损耗</span><span class="mord">&nbsp;</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span></li>
</ul>
</li>
<li>H plane:XY plane</li>
<li>E plane:XZ plane</li>
<li>beemwidth:the angular separation between the points in the main lobe that are down from the maximum gain by 3 dB.</li>
</ul>
</li>
<li>
<p>FSPL(free space path loss)(db)=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>10</mn></msub><mo stretchy="false">(</mo><mi>d</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo><mo>+</mo><mn>20</mn><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>10</mn></msub><mo stretchy="false">(</mo><mi>f</mi><mi>r</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>y</mi><mo stretchy="false">)</mo><mo>+</mo><mn>32.44</mn></mrow><annotation encoding="application/x-tex">20log_{10}(distance)+20log_{10}(frequency)+32.44</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">20</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">20</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">cy</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">32.44</span></span></span></span></p>
<ul>
<li>the signal strength falls quickly near the transmitter but more slowly father more</li>
<li>The loss is a function of distance and frequency only</li>
</ul>
</li>
<li>
<p>RSSI(received signal strength indicator):the power level of received signal should be greater than the <strong>sensitivity level</strong> of receiver.</p>
<ul>
<li>be greater than the noise level</li>
<li>SNR(signal-to noise ratio,信噪比)(db):<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>e</mi><mi>F</mi><mi>l</mi><mi>o</mi><mi>o</mi><mi>r</mi><mo>−</mo><mi>R</mi><mi>S</mi><mi>S</mi><mi>I</mi></mrow><annotation encoding="application/x-tex">NoiseFloor - RSSI</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal">i</span><span class="mord mathnormal">se</span><span class="mord mathnormal" style="margin-right:0.01968em;">Fl</span><span class="mord mathnormal" style="margin-right:0.02778em;">oor</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">RSS</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span>(higher is prefered)</li>
<li>recommended minimum SNR:20 for common,25 for voice<!-- OR 25 --></li>
</ul>
</li>
</ul>
</li>
<li>modulation.
<ul>
<li>frequency</li>
<li>phase</li>
<li>amptilude</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>standard</th>
<th>2.4GHz?</th>
<th>5GHz?</th>
</tr>
</thead>
<tbody>
<tr>
<td>802.11b WiFi1</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>802.11a WiFi2</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>802.11g 3</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>802.11n 4</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>802.11ac 5</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>802.11ax 6</td>
<td>Yes</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<ul>
<li>802.11会根据信号强度(距离影响强度)调整调频方式,获得不同的速率</li>
</ul>
</li>
</ul>
<p>vertical antenna need to match the receiver's antenna to make polarizations match.</p>
<p>pan'yu</p>
<h3 id="infrastructure">infrastructure </h3>
<ul>
<li>Autonomous APs:self-contained,each offering one or more fullly functional ,standalone BSSs(Basic service sets),connecting wireless SSIDs(service set identifiers,WLAN name) to wired VLAN.</li>
<li>Lightweight:has to join a WLC(wireless LAN controller) to become fully functional.(cooperation named split-MAC architecture).An AP and a WLC are joined by a logical pair of CAPWAP tunnels.(every WLC can support maximum number of APs in use)
<ul>
<li>modes:
<ul>
<li>Local:offer BSSs</li>
<li>FlexConnect:forwarding data normally with or without CAPWAP tunnel connected to the WLC</li>
<li>Monitor:Its receiver acts as a dedicated <a href="http://sensor.In">sensor.In</a> this mode, the AP continuously scans all channels for rogue devices and other wireless issues, but it does not provide any client services.</li>
<li>Sniffer:Receive 802.11 traffic from other sources,forwarding to a <a href="http://PC.It">PC.It</a> does not provide client services.</li>
<li>Rouge detector:This mode is used to detect rogue devices by listening for MAC addresses and comparing them against a known list. It does not provide client services.</li>
<li>Bridge:bridge between two networks</li>
<li>Flex+Bridge</li>
<li>SE-Connect:analyze wireless channels</li>
</ul>
</li>
<li>deployments
<ul>
<li>Centrsllized wireless deployment:one large WLC
<ul>
<li>The RTT(round trip time) between an AP and a WLC should be less than 100ms</li>
<li>AP must operate in FlexConnect with a public Cloud WLC(means far)
<ul>
<li>cloud-based controller</li>
</ul>
</li>
<li>6000-64000 Aps</li>
</ul>
</li>
<li>Distributed wireless deployment:many smaller WLC
<ul>
<li>200-5000 APs</li>
</ul>
</li>
<li>EWC(embedded wireless controller):regular APs that also run WLC software
<ul>
<li>controller-less deployment:100-200 APs</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>wlc modes(???):</p>
<ul>
<li>master controller mode:All new APs that join the WLAN are assigned to the master controller</li>
</ul>
<h4 id="ap-states">AP states </h4>
<div class="mermaid">flowchart TB

b[AP boots up]--&gt;d[WLC discover]
d--&gt;t[CAPWAP Tunnel]
t--&gt;j[WLC join]
j--&gt;dj[Download image]
dj--&gt;df[Download config]
df--&gt;r[run]
r-.-&gt;Reset
</div><ul>
<li>WLC discover to build a list of candidates
<ol>
<li>broadcast to the localnet
<ul>
<li>relay broadcast requests on UDP port 5246 to specific
<ol>
<li>ip forward-protocol udp 5246</li>
<li>interface vlan <code>vlan</code></li>
<li>ip helper-address <code>WLC-address</code></li>
</ol>
</li>
</ul>
</li>
<li>unicast CAPWAP Discover Request to a controller's IP over UDP port 5246  with nonvolatile memory</li>
<li>DHCP server suggest a list of WLC addresses with DHCP option 43.
<ol>
<li><em>option 43 hex f104.<code>Convert each octet to hexadecimal</code></em>(!example:convert 172.16.50.5 to AC10.3205)</li>
</ol>
</li>
<li>DNS request with the name CISCO-CAPWAP-CONTROLLER.<code>localdomain</code></li>
<li>reset</li>
</ol>
</li>
<li>select a WLC
<ol>
<li>previouslt joined or been configured or <code>primed</code> with a primary,secondary and tertiary controller</li>
<li>master controller</li>
<li>least-loaded WLC</li>
</ol>
</li>
</ul>
<h3 id="wireless-configure">wireless configure </h3>
<p>legacy:group APs into logical AP groups sharing a common set of WLAN and RF parameters</p>
<p>current:</p>
<ul>
<li>default-site-tags
<ul>
<li>AP profile:local mode</li>
<li>Flex profile</li>
</ul>
</li>
<li>defualt-rf-tags
<ul>
<li>2.4G</li>
<li>5G</li>
<li>6G</li>
</ul>
</li>
<li>default-policy-tags
<ul>
<li>WLAN profile</li>
<li>Policy profile</li>
</ul>
</li>
</ul>
<p>alsso can assign the appropriate tags to the APs.</p>
<p>high availability with stateful switchover redundency.</p>
<h3 id="roam-and-locate">roam and locate </h3>
<p>roam between Autonomous APs:</p>
<ul>
<li>For the client,when client find the signal degrade and look for a stronger signal,reassociation with the new AP</li>
<li>For the APs,old AP's association was canceled and new AP's association is established</li>
</ul>
<p>roam between lightweights:For the client,it's same as roaming between autonomous APs</p>
<ul>
<li>Intracontroller roaming:WLC just modifies its database
<ul>
<li>10ms</li>
</ul>
</li>
<li>Intercontroller roaming:between different WLC's APs
<ul>
<li>Layer 2 roaming:if the old and new WLCs are in the same vlan,the old WLC delete the association and the new WLC create an association
<ul>
<li>client can maintain its ip</li>
<li>20ms</li>
</ul>
</li>
<li>Layer 3 roaming:if the old and new WLCs are in different vlans,the anchor controller(original WLC) will build a new CAPWAP tunnel with the foreign controller(new WLC).The tunnel tethers the client to its original anchor controller and original IP subnet.
<ul>
<li>can configure a controller to be a static anchor controller for a WLAN</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>With the client reassociation,some problems will bring out</p>
<ul>
<li>DHCP</li>
<li>Client authentication
<ul>
<li>CCKM(Cisco Centrolized Key Management):controller maintains a database of clients and keys.require CCX(Cisco Compatible Extension) from clients</li>
<li>Key caching:client maintains a list of key used with prior AP associations</li>
<li>802.11r:client cache a portion of authentication server's key to future APs,also QoS parameters<br>
(ALL stategies requires help on client)</li>
</ul>
</li>
</ul>
<h4 id="roam-domain">roam domain </h4>
<p>one roam(up to 72 groups) can have many groups(up to 24 WLCs).if two WLCs are in the same group:</p>
<ul>
<li>fast roam</li>
<li>CCKM</li>
<li>key caching</li>
<li>802.11r</li>
<li>All controllers must be configured with the same virtual interface IP address in the same Mobility Group.</li>
</ul>
<p>if not in the same group but in the same domain:</p>
<ul>
<li>roam</li>
</ul>
<h4 id="locate">locate </h4>
<p>by the circles of RSS(received signal strength)</p>
<p>RF fingerprinting:reprents mapped area's contruction</p>
<p>in real-time map,green dots means associated devices,and red dots means sending requests but not being associated</p>
<h4 id="authentication">authentication </h4>
<ol>
<li>802.11
<ol>
<li>open authentication:client need to use an 802.11 authentication request</li>
<li>WEP:rc4密钥流对称加密</li>
</ol>
</li>
<li>WPA
<ol>
<li>WPA1</li>
<li>WPA2</li>
<li>WPA3</li>
</ol>
</li>
</ol>
<p>all WPA versions support two modes:pre-shared key(PSK) and 802.1x(also known as personal mode and enterprise mode).</p>
<p>WPA1 and WPA2 are not entirely safe now.<br>
3. EAP with 802.1x(based on WPA enterprise mode)(should always use as higher as possible version)(802.x need a radius server)</p>
<p>客户端设备通过802.1x（通过EAPOL）认证后，会生成两种类型的密钥：用于单播通信的PMK和用于组通信的GMK。这些主密钥用于派生更具体的密钥（PTK和GTK），这些密钥对不同类型的网络流量进行加密，确保无线网络通信的安全。</p>
<ol>
<li>WebAuth ways
<ol>
<li>LWA with an internal database on the WLC</li>
<li>LWA with an external database on a RADIUS or LDAP server(make sense)</li>
<li>LWA with an external redirect after authentication</li>
<li>splash page redirect,using an internal webpage on the WLC</li>
<li>passthrough???</li>
</ol>
</li>
</ol>
<p>enable AAA Override to assign vlan correctly</p>
<h2 id="hierarchichal-lan-design-model">hierarchichal LAN Design Model </h2>
<ol>
<li>Access layer(network edge)</li>
<li>distribution layer
<ol>
<li>for layer 2,creates a boundry for STP</li>
<li>for layer 3,provide a logical point to summarize IP routing information</li>
</ol>
</li>
<li>core layer</li>
</ol>
<p>traditionnally,use a Layer 2 access layer and layer 3 distribution layer</p>
<ul>
<li>restrict a vlan to a single access layer switch</li>
<li>redundent layer 3 switch with FHRP</li>
</ul>
<p>Routed access is an alternative choice</p>
<ul>
<li>no FHRP required</li>
<li>no STP required</li>
<li>Increased uplink utilization(for no STP block)</li>
<li>Easier troubleshooting</li>
<li>faster convergence</li>
</ul>
<p>simplified campus tools:</p>
<ul>
<li>
<p>VSS(Virtual Switching System),single point of management for improved efficiency</p>
</li>
<li>
<p>SWV(StackWise Virtual),clustering two physical switches into a single logical switch(distribution or core layer often)</p>
</li>
<li>
<p>StackWise,stacking two or more switches into a single logical switch.(access layer often)</p>
<ul>
<li>simplfied design</li>
<li>no FHRP required</li>
<li>reduced STP dependence</li>
<li>increased uplink utilization</li>
<li>easier troubleshooting</li>
<li>faster convergence</li>
<li>high availability</li>
</ul>
</li>
</ul>
<div class="mermaid">flowchart LR
subgraph g1[physical layout]
a[L3] &amp; b[L3]---c[/L2/] &amp; d[/L2/]

a---b
a---b
end

subgraph g2[Logical layout with VSS or Swv]
a2[L3]---c2[/L2/] &amp; d2[/L2/]
a2---c2 &amp; d2
end

subgraph g3[Logical layout with VSS or Swv and StackWise]
a3[L3]---c3[/L2/]
a3---c3
end
g1---g2---g3
</div><h3 id="high-availability-technologies">High Availability Technologies </h3>
<p>RP:router processor</p>
<p>some combinations that allow the network work during an RP switchover:</p>
<ol>
<li>SSO and NSF</li>
<li>SSO and NSF with GR</li>
<li>SSO and NSF with NSR</li>
<li>SSO and NSF with NSR and GR:use GR for GR-aware router else use NSR for GR-unaware router</li>
</ol>
<ul>
<li>SSO:SSO allows router with redundant RPs to checkpoint the router configuration,line card operation and Layer 2 state information from the active RP to the standby RP.
<ul>
<li>no Layer 3 control plane information about any neighbor router</li>
</ul>
</li>
<li>NSF:checkpoint FIB</li>
<li>GR:allow a neighbor to be aware that the router undergoing switchover,continuing forwarding packets with invalid neighbor relationship
<ul>
<li>SSO/NSF-capable router</li>
<li>GR-aware router(GR helper)</li>
<li>GR-unaware router</li>
</ul>
</li>
<li>NSR:enable SSO checkpoint all Layer 3 information even include TCP sockets</li>
</ul>
<h2 id="排错-11">排错 </h2>
<p>command:</p>
<ul>
<li>show mac address-table|address <code>address</code>|dynamic|vlan <code>vlan-id</code></li>
<li>clear mac address-table dynamic [{address <code>mac-address</code>}|interface <code>interface</code>|vlan <code>vlan-id</code>]</li>
<li>show interfaces <code>interface</code> switchport</li>
<li>show interfaces status</li>
</ul>
<h2 id="sdasoftware-define-access">SDA(software define access) </h2>
<p>features:</p>
<ul>
<li>Network automation:through the use of Cisco DNA center(Digital Network Architecture)</li>
<li>Network assurance and analytics:proactive telemetry</li>
<li>Host mobility:similar to LISP</li>
<li>Identity service:</li>
<li>policy enforcement:SGACLs(security group access control lists) provides much simpler and more scalable form based on identity</li>
<li>secure segmentation:</li>
<li>network virtualization:</li>
</ul>
<p>SD-Access=Campus fabric(overlay solution)+Cisco DNA center</p>
<ol>
<li>Management Layer
<ol>
<li>DNA center GUI
<ol>
<li>Base automation</li>
<li>design</li>
<li>policy</li>
<li>provision</li>
<li>Assurance</li>
</ol>
</li>
</ol>
</li>
<li>Controller Layer
<ol>
<li>DNA center
<ol>
<li>NCP network control platform:provides all the underlay and fabric automation using NETCONF/YANG,SNMP,SSH/Telnet and so on.And get information to the manager layer</li>
<li>NDP network data platform:data collection and analytics and assurance.provide contextual information to NCP and ISE.</li>
</ol>
</li>
<li>ISE identity service:provide identity and policy service for the physical and network layer,using 802.1x,MAB(MAC Authentication Bypass) and WebAuth</li>
</ol>
</li>
<li>Network Layer
<ol>
<li>fabric overlay(recommended MTU size 9100)
<ol>
<li>control plane,based on LISP.
<ol>
<li>based on EID,RLOC,MS</li>
</ol>
</li>
<li>data plane,based on VXLAN.
<ol>
<li>use VXLAN-GPO with VXLAN format enhanced with SGTs(scalable group tags,also referred to as TrustSec Security Group Tags)
<ol>
<li>Group policy id:16bit identifier</li>
<li>G bit(group based policy extension):SGT is carried within Group policy id when set to 1</li>
<li>D bit(don't learn):VTEP(virtual tunnel endpoint???) must not learn the source address when set to 1</li>
<li>A bit(policy applied):group policy has been applied when set to 1,only when G bit set to 1</li>
</ol>
</li>
</ol>
</li>
<li>policy plane,based on CTS(cisco TrustSec)
<ol>
<li>SGT tags are assigned to authenticated groups</li>
<li>network policy is based on the SGT tag instead of ip or mac address</li>
</ol>
</li>
</ol>
</li>
<li>underlay(settings,protocol):recommond to use layer 3 as the IGP(IS-IS is prefered).
<ol>
<li>manual setting</li>
<li>automated setting
<ol>
<li>creates an IS-IS routed access campus design</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>Physical Layer</li>
</ol>
<h3 id="fabric-overlay">fabric overlay </h3>
<div class="mermaid">flowchart TB
a["network services(WLC,DNA,ISE)"]---fabric
fabric---b["wireless/wired endpoints and users"]
</div><p>There are five roles for basic devices in the fabric overlay:</p>
<ol>
<li>
<p>control plane node:MS/MR,contain the settings and map EID-to-RLOC</p>
</li>
<li>
<p>Fabric border node:PxTRs,connects external Layer 3 device to the SDA fabric<br>
has three roles:</p>
<ol>
<li>Internal border:connect to known areas by the organization</li>
<li>Default border:connect to unknown areas with a default route</li>
<li>Internal + default border</li>
</ol>
<p>and one function:</p>
<ol>
<li>translate VRF and SGT infomation from one domain to another</li>
</ol>
</li>
<li>
<p>Fabric edge node:connects wired endpoints to the SDA fabric</p>
<ol>
<li>be a xTR</li>
<li>first identify and authenticate(through 802.1x) wired devices, in order to place then into a overlay <strong>host pool</strong>(SVI and VRF instance by static or DHCP) and scalable group(SGT)</li>
<li>responsible for hosting the anycast gateway</li>
</ol>
</li>
<li>
<p>Fabric WLAN controller:connects APs and wireless endpoints to the SDA fabric</p>
<ol>
<li>connects APs and wireless endpoints to the SD-Access fabric.(perform as edge and border nodes at the same time)</li>
<li>Just use CAPWAP tunnel outside the <a href="http://fabric.In">fabric.In</a> the fabric,data plane use VXLAN tunnel to encapsulate.</li>
<li>The WLC is connected outside of the fabric(located in controller layer)</li>
</ol>
</li>
<li>
<p>Intermediate nodes:just provide underlay service</p>
</li>
</ol>
<p>some benefits:</p>
<ol>
<li>Virtual Network(VN):provide virtualization at the device level with VRF.(cloud service)</li>
<li>Hostm pool:use SVI for each pool and EID mapping to advertise each host pool</li>
<li>Scaleble group:assign every endpoints a scalable SGT tags,meaning the policy of devices in the group is easy to manage</li>
<li>anycast gateway:SVI gateways with the same ip and mac address</li>
</ol>
<h1 id="wan">WAN </h1>
<p>从企业或个人的角度看,要使用广域网(WAN)连接远端的另一个子网,物理层上来说,需要专线;二三层上来说,需要数据链路协议,例如HDLC或PPP.要将专线与路由器连接,中间一般需要一个CSU/DSU(信道服务单元/数据服务单元)做中继.现在很多专线本身集成了适配WIC(wan接口卡)的CSU/DSU.CSU/DSU设备工作时充当DCE(数据电路终端),此时路由器充当DTE(数据终端设备).两个路由器通过wan口相连时,一方使用DTE线缆,另一方使用DCE线缆.老版IOS需要在DCE段设置clock rate配置时钟.</p>
<p>从ISP的角度看,要提供的互联网服务往往会跨越很大的物理距离,所以不能单纯的将所有待接入的专线全部接到一块儿,所以需要对网络进行设计.城市级别的称为MetroE(城域以太网),也被称为 carrier Ethernet(载体以太网).MetroE有3类服务,E-line,E-LAN,E-Tree.通过MPLS搭建的,也会被称为VPWS(虚拟私有线路服务),VPLS(虚拟私有LAN服务),EoMPLS(Ethernet over MPLS)(这个和E-Tree不对应).</p>
<p>E-Line服务会创建一条点对点的EVC(Ethernet Virtual Connection,以太网虚拟连接),表示EVC两边端点可以通信.显然,E-Line两端路由器相连的两个端口需在同一子网.E-LAN(以太局域网服务)通过全互联的方式连接所有站点,相连在E-LAN的路由器需要在同一子网.E-Tree(以太网树服务)则是部分互联,也叫星形拓扑,点到多拓扑.E-Tree的根与叶相连的接口要使用同一子网,但由于叶之间并没有直接连接,所以路由要求只能根与叶成为邻居.需要针对路由协议进行额外的配置.</p>
<h2 id="hdlc">HDLC </h2>
<p>标准HDLC定义了如何在bit流中通过标志字段找到待传数据,并且通过FCS字段完成校验功能等,完成了数据链路层的工作.Cisco私有的HDLC较于标准HDLC增加了类型部分.一般串口为up时默认使用的就是HDLC.</p>
<h3 id="配置-28">配置 </h3>
<p>接口模式:</p>
<ul>
<li>encapsulation HDLC</li>
<li>clock rate <code>speed</code><br>
EXEC:</li>
<li>show controller serial <code>number</code>(查看是否为DCE端)</li>
</ul>
<h2 id="ppp">PPP </h2>
<p>封装结构与Cisco私有的HDLC类似.还定义了LCP(链路控制协议)和NCP(网络控制协议).LCP中有认证和多链路支持等功能.</p>
<h3 id="认证">认证 </h3>
<p>认证分为PAP和CHAP两种,PAP是明文传输的,CHAP是加密传输的.两种认证方式双方都必须配置了用户名和密码.</p>
<h4 id="配置-29">配置 </h4>
<p>接口模式:</p>
<ol>
<li>encapsulation ppp</li>
<li>hostname <code>name</code>(!被配置路由器的用户名)</li>
<li>username <code>name</code> password <code>password</code>(!邻居路由器的用户名和密码)</li>
<li>ppp authentication {chap|pap|chap pap(!先使用chap,再使用pap)}</li>
<li>(pap need) ppp pap sent-username <code>name</code> password <code>password</code>(!同2)</li>
</ol>
<h3 id="多链路支持">多链路支持 </h3>
<p>链路层接口级别的负载均衡,逻辑上被视为一个三层接口,encapsulation 命令需要同时在串行接口和多链路接口启用.多链路双方接口link-num应相同,group-num应相同</p>
<h4 id="配置-30">配置 </h4>
<p>配置模式:</p>
<ol>
<li>interface multilink <code>link-num</code>(!创建多链路接口)<br>
进入逻辑接口的接口模式:</li>
<li>encapsulation ppp</li>
<li>ppp multilink</li>
<li>ip address <code>address</code> <code>mask</code>(!在该逻辑接口上配备ip和掩码)</li>
<li>ppp multilink group <code>group-num</code></li>
</ol>
<p>物理接口的接口模式:</p>
<ol>
<li>encapsulation ppp</li>
<li>ppp multilink</li>
<li>no ip address</li>
<li>ppp multilink group <code>group-num</code></li>
<li>!验证等在此处配置</li>
</ol>
<h3 id="排错-12">排错 </h3>
<ul>
<li>线路状态和协议状态均为down/down时,一般是物理层问题.</li>
<li>当线路up,协议down时
<ul>
<li>两端协议均down: 使用协议不匹配(encapsulation命令不匹配) 或 PPP认证失败</li>
<li>一端down,另一端up:使用HDLC时,up一方禁用了Keepalive</li>
</ul>
</li>
<li>线路和协议均up/up时,无法路由时,问题出在第三层.当两个串口相连时,他们理应在同一子网.不然,虽然PPP链路可以ping通,但无法交换路由信息.</li>
</ul>
<h2 id="vrf-litevirtual-routing-and-forwarding">VRF-lite(virtual routing and forwarding) </h2>
<p>vrf-lite是在物理路由器上创建虚拟路由器实例的技术.</p>
<p>VRF-lite does not support IGRP and ISIS.<br>
•VRF-lite does not support all MPLS-VRF functionality: label exchange, LDP adjacency, or labeled packets.<br>
•VRF-lite does not affect the packet switching rate.<br>
•The capability vrf-lite subcommand under router ospf should be used when configuring OSPF as the routing protocol between the PE and the CE.</p>
<h3 id="配置-31">配置 </h3>
<p>配置模式:</p>
<ol>
<li>ip vrf <code>name</code>
<ol>
<li>address-family {ipv4|ipv6}</li>
<li>interface <code>interface</code>(!如果是子接口,必须是dot1q封装方式)
<ol>
<li>ip vrf forwarding <code>name</code>(!分配给某vrf实例)<br>
其余和普通配置一样,设置ip等</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="排错-13">排错 </h3>
<ul>
<li>show ip route vrf <code>name</code></li>
</ul>
<h2 id="mpls">MPLS </h2>
<p>位于MPLS边缘的路由器会在数据包出入MPLS网络时,对数据包添加和移除MPLS头部,内部设备转发数据基于标签字段.MPLS VPN是SP的一项主营业务,可以不加密数据的前提下,确保一个客户的数据不会被发给另一个客户,而且不需要客户都处于同一个子网.</p>
<p>MPLS可以转发除IPv4以外的三层协议,还支持多种服务.</p>
<ul>
<li>LIB(MPLS Lable Information Base):对标路由中的RIB.</li>
<li>LFIB(MPLS Lable Forwarding Information Base):对标路由中的FIB,but used for labeled packets</li>
<li>LSR(Label Switch Router):MPLS域中支持MPLS的路由器,位于MPLS域边缘的称为E-LSR(Edge LSR),不在边缘的称为中间LSR.边缘LSR负责为进入域的数据包添加标签(称为Ingress E-LSR),为离开MPLS的数据包删除标签(称为Egress E-LSR).</li>
<li>LSP(Label Switched Path):IP数据包穿越MPLS域所采用的累积标签路径.
<ul>
<li>LSPs are unidirectional.</li>
</ul>
</li>
<li>LDP:标签分发协议,对标路由协议.通过UDP224.0.0.2:646多播Hello包.通过TCP 646端口建立TCP会话交换标签信息.自己分配一个标签,并从邻居学习标签填充自己的LIB.最佳标签填充LFIB.</li>
</ul>
<p>数据包穿越MPLS的过程:添加标签-&gt;添加标签到外层,删除里层标签-&gt;到达倒数第二跳,只删除标签-&gt;根据IP转发,出MPLS域<br>
(在倒数第二跳不会继续添加标签,只会删除标签)</p>
<h3 id="header">header </h3>
<ul>
<li>header:20+3+1+8 bit
<ul>
<li>label:20bit,used to identify LSP</li>
<li>EXP:3bit,used for Qos</li>
<li>S:1bit,which when set to 1,means this is the label immediately preceding the IP header</li>
<li>TTL:8bit,like TTL in ip
<ul>
<li><img src="image-33.png" alt="alt text"></li>
<li>can disable MPLS TTL propagation to allow ingress E-LSR to set the MPLS TTL to 255 to hide the MPLS network.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="ldplabel-distribute-protocol">LDP(label distribute protocol) </h3>
<p>when a LSR learn a new route, it will allocate a label for it and advertise this binding to its LDP neighbor.</p>
<h4 id="configuration-1">configuration </h4>
<ol>
<li>mpls ip(!enabled by default)</li>
<li>mpls label protocol {ldp|tdp|both} (!ldp by default)</li>
<li>(!mpls router id)mpls ldp router-id <code>interface</code> [force]</li>
<li>mpls label range <code>min</code> <code>max</code>(!need to use <em>reload</em>)</li>
<li>mpls ldp neighbor [vrf <code>vrf</code>] <code>ip-address</code> [password [0-7] <code>password</code>]</li>
<li>interface <code>interface</code></li>
<li>mpls ip</li>
</ol>
<h3 id="mpls-vpn">MPLS VPN </h3>
<ul>
<li>CE(customer edge):客户边缘路由器</li>
<li>PE(provider edge):提供商边缘路由器,边缘LSR
<ul>
<li>need to use multiple vrfs to learn probably overlapping ipv4 route from CEs.And redistribute them into BGP.</li>
</ul>
</li>
<li>RD(Router Distinguisher):路由鉴别符,64bit,8字节,拓展IP用.
<ul>
<li>defined in MP-BGP.Add a 64-bit RD to ipv4 prefix of a route.</li>
<li>formatted with ipv4:num or ASN:num</li>
</ul>
</li>
<li>RT(Route Targets):advertised in BGP Updates as BGP Extended PA.
<ul>
<li><img src="image-1.png" alt="alt text"></li>
</ul>
</li>
<li>VPNv4:RD+ipv4地址</li>
<li>P:provider 中间LSR</li>
</ul>
<p>PE路由器通过创建VRF实例将CE路由隔离,PE以每个VRF实例生成RD,P路由器对CE透明.PE路由器重分发路由后通过MP-iBGP交换路由,P路由器不参与BGP进程.VRF中的路由全是关于VPNv4的路由.</p>
<ol>
<li>CE和PE通过路由协议交换IP路由</li>
<li>PE将IP路由放入VRF的路由表</li>
<li>将VRF中的IP路由作为VPNv4重分发到MP-BGP中</li>
<li>PE路由器通过MP-BGP交换iBGP路由</li>
<li>PE路由器将VPNv4重分发为Ip路由到特定VRF的路由协议中</li>
<li>PE与另一端CE协商IP路由</li>
</ol>
<h4 id="data-plane">data plane </h4>
<p>MPLS VPN先添加VPN标签(inner label),再添加MPLS标签(outer label),中间转发和MPLS过程相同,VPN label只对egress PE有意义.</p>
<ul>
<li>The outer label identifies the segments of the LSP between the ingress PE and theegress PE, but it does not identify how the egress PE should forward the packet.</li>
<li>The inner label identifies the egress PE’s forwarding details, in particular the outgoing interface for the unlabeled packet.</li>
</ul>
<h3 id="configuration-2">configuration </h3>
<ol>
<li>(!Creating each VRF, RD, and RT, plus associating the customer-facing PE interfaces with the correct VRF)
<ol>
<li>ip vrf <code>vrf-name</code>
<ol>
<li>rd <code>rd-value</code></li>
<li>route-target {import|export|both} <code>rt-value</code></li>
</ol>
</li>
<li>interface <code>interface</code>
<ol>
<li>ip vrf forwarding <code>vrf-name</code></li>
</ol>
</li>
</ol>
</li>
<li>(!Configuring the IGP between PE and CE)</li>
<li>(!Configuring mutual redistribution between the IGP and BGP)</li>
<li>(!Configuring MP-BGP between PEs)
<ol>
<li>router bgp <code>as-num</code></li>
<li>neighbor <code>ip</code> remote-as <code>as</code></li>
<li>neighbor <code>ip</code> update-source <code>source-ip</code></li>
<li>address-family vpnv4
<ol>
<li>neighbor <code>ip</code> activate</li>
</ol>
<!-- 2. neighbor `ip` send-community -->
</li>
</ol>
</li>
</ol>
<h3 id="排错-14">排错 </h3>
<ol>
<li>show mpls inetrfaces</li>
<li>show mpls forawarding-table</li>
</ol>
<h2 id="sd-wan">SD-WAN </h2>
<ul>
<li>centuralize divice configuration and network management</li>
</ul>
<p>two solutions:</p>
<ol>
<li>
<p>cisco SD-WAN</p>
<ol>
<li>SD-WAN edge devices:devices who forwards traffic</li>
<li>vManage Network Management System(NMS):provides GUI for managing the SD-WAN solution. Performs remote software upgrades for WAN Edge, vSmart, and vBond.</li>
</ol>
<!-- And authenticate the routers and the vSmart controllers -->
<ol start="3">
<li>
<p>vSmart controller:advertising routes and data policies to edge devices</p>
<ol>
<li>use DTLS tunnel with edge devices to establish OMP(Overlay Management Protocol).</li>
<li>advertise reachability information in the fabric</li>
<li>implement all the control plane policies created on vManage</li>
</ol>
<p>OMP is a proprietary routing protocol similar to BGP</p>
</li>
<li>
<p>vBond orchestration:authenticates and orchestrates connectivity between edge devices,NMS, and controllers<br>
every vbond has a permanent control plane over a DTLS(datagram transport layer security) tunnel with every vSmart controller.</p>
<ol>
<li>authentication</li>
<li>NAT detection</li>
<li>load balancing</li>
</ol>
</li>
<li>
<p>vAnalytics</p>
</li>
</ol>
</li>
<li>
<p>Meraki SD-WAN:require UTM(unified threat management)</p>
</li>
</ol>
<h3 id="sd-wan-cloud">SD-WAN cloud??? </h3>
<p>CoR(cloud OnRamp):a set of functionalities addressing optimal cloud SaaS application access and IaaS connectivity.</p>
<ul>
<li>Policy
<ul>
<li>Local policy:pushed to the edge decice by the vManager</li>
<li>centralized policy
<ul>
<li>topology</li>
<li>VPN membership</li>
<li>AAR(application-aware routing):enhance forwarding on application-by-application basis</li>
<li>traffic data:filter traffic on an application-by-application basis,modify traffic,Qos,loss protection</li>
</ul>
</li>
</ul>
</li>
<li>Application-aware routing:utilize BFD(bidirectional forwarding dtection) in the SD-WAN tunnels to track a tunnel's quality.</li>
</ul>
<h1 id="internet-and-vpn">Internet and VPN </h1>
<p>当接入WAN时,本地和ISP连接.许多ISP和连接到ISP的子网共同组成了全球互联网--Internet(<code>:)</code>).</p>
<p>企业可以使用VPN技术通过互联网技术实现WAN专线一样的服务.</p>
<p>VPN一般基于GRE隧道.DMVPN基于GRE和NHRP</p>
<p>GRE隧道可以实现端对端的vpn.</p>
<p>DMVPN支持一点对多点的mGRE隧道vpn,单点部分充当中心站点和NHRP(下一跳解析协议)服务器,多点部分充当分支站点(NHS)和NHRP客户端(NHC).NHRP服务端会自动帮助客户端学习客户端之间的路由,使客户端之间的消息可以经过Spoke-to-Spoke隧道,不经过中心路由器转发.</p>
<p>GRE可以通过IPsec实现数据安全.</p>
<h2 id="gre">GRE </h2>
<p>最初的GRE旨在为不可路由的协议提供传输机制.GRE隧道也叫叠加网络.GRE将数据包添加IP数据包报头,将原始信息作为数据段封装起来,如果有需要,还可以对数据部分加密.</p>
<p>GRE隧道会对IP数据报在IP报头之前添加GRE IP报头,GRE标志的封装.</p>
<h2 id="nhrp">NHRP </h2>
<p>NHRP是为NBMA网络(非广播网络,但允许多个路由器在一个网段,DMVPN也是)提供地址解析的方法(ARP),从协议地址解析到NBMA地址.服务端(NHS,next-hop server)维护地址信息,为客户端(NHC,next-hop client)提供地址查询的服务.</p>
<p>NBMA地址是传输网络的地址,协议地址是分配给叠加网络的地址.</p>
<p>NHRP数据包都必须包含NBMA地址,源协议地址,目的协议地址和NHRP消息类型.</p>
<table>
<thead>
<tr>
<th>消息类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Registration</td>
<td>NHC发送给NHS其NBMA地址</td>
</tr>
<tr>
<td>Resolution</td>
<td>解析请求和解析应答</td>
</tr>
<tr>
<td>Redirect</td>
<td>第三阶段,NHS通知NHC使用Spoke-to-Spoke隧道</td>
</tr>
<tr>
<td>Purge(清除)</td>
<td>通常由NHS发送给NHC,表明其地址不再有效</td>
</tr>
<tr>
<td>Error</td>
<td>告诉NHRP发送端出现错误</td>
</tr>
</tbody>
</table>
<h2 id="dmvpn阶段">DMVPN阶段 </h2>
<ol>
<li>Spoke to Hub
<ol>
<li>在NHS和NHC之间建立永久VPN隧道,这个阶段所有数据包都会经过NHS.</li>
</ol>
</li>
<li>Spoke to Spoke
<ol>
<li>在NHC之间按需建立VPN通道进行Spoke to Spoke通信.不允许路由汇总和多级分层之间进行Spoke-to-Spoke通信</li>
<li>详细流程:
<ol>
<li>Spoke站点通过Spoke to Hub发送数据包到另一Spoke站点</li>
<li>Hub发送NHRP重定向消息给Spoke站点</li>
<li>Spoke站点通过Spoke to Hub发送NHRP解析请求给另一Spoke站点,请求建立Spoke to Spoke隧道</li>
<li>另一站点通过Spoke to Spoke尝试返回NHRP解析应答,如果成功,则一个方向的Spoke to Spoke建立成功,另一方向同理.</li>
</ol>
</li>
</ol>
</li>
<li>分层树状Spoke to Spoke
<ol>
<li>优化Spoke to Spoke之间的路由,多级分层也可以Spoke-to-Spoke通信</li>
</ol>
</li>
</ol>
<p>There are more routing protocol restrictions with Phase 2 than DMVPN Phases 1 and 3. For example, summarization and default routing is NOT allowed at the hub, and the hub always preserves the next hop on spokes. Spokes need specific routes to each other networks.</p>
<p>DM-VPN链路状态:</p>
<ol>
<li>INTF:隧道线路协议down</li>
<li>IKE:IPsec未通过,未建立IKE(Internet Key Exchange)会话</li>
<li>IPsec:建立IKE会话,为建立IPsec SA(Security Association)</li>
<li>NHRP:分支路由器未注册</li>
<li>Up:acc</li>
</ol>
<h2 id="nhrp路由控制">NHRP路由控制 </h2>
<p>NHRP会覆盖某些路由的下一跳或安装新的路由.第三阶段会实行路由汇总.</p>
<h2 id="fvrf">FVRF </h2>
<p>DMVPN会遇到一些问题:</p>
<ol>
<li>递归路由
<ol>
<li>传输网络和叠加网络宣告互相干扰时,如EIGRP添加了使用OSPF的传输网络接口,EIGRP通过OSPF的路由,穿过隧道建立邻居关系,然后宣告路由,然后OSPF路由失效,EIGRP邻居不可达,一直循环</li>
</ol>
</li>
<li>出站接口选择<br>
解决办法是FVRF.</li>
</ol>
<p>与传输网络关联的VRF称为FVRF(Front Door VRF),为每个DMVPN隧道使用FVRF是应该的.</p>
<p>通过DHCP分配ip的FVRF会自动安装AD值254的默认路由.</p>
<h2 id="ipsec">IPsec </h2>
<p>数据安全包含三要素:</p>
<ul>
<li>数据机密性:确保授权用户才能查看数据.对数据加密</li>
<li>数据完整性:仅授权用户才能修改数据.哈希能发现数据被修改与否</li>
<li>数据可用性:数据传输网络始终可用</li>
</ul>
<p>IPsec由AH(Authentication Herder)和ESP(Encapsulating Security Payload)提供数据完整性和机密性.可以单独使用也可以组合使用.</p>
<ul>
<li>AH:Authentication Header,创造数字签名确保数据包不被修改.IP协议号51.</li>
<li>ESP:对数据部分加密保证数据机密性.分为传输模式和隧道模式.IP协议号50.
<ul>
<li>传输模式:加密和认证数据包净荷.在数据报数据与IP报头之间添加ESP报头,数据之后添加ESP尾部和ESP认证.传输模式ESP报头添加在GRE IP报头之后,GRE标志之前.(只不加密IP报头)</li>
<li>隧道模式:在IP报头前添加新IP报头和ESP报头,尾部添加ESP尾部和ESP认证.GRE同理.(即对原始IP报头也加密)</li>
</ul>
</li>
</ul>
<p>SA(security association,安全关联)包含两台端点设备之间协商一致的安全参数,包括:</p>
<ul>
<li>IKE SA:控制平面,bidirectional</li>
<li>IPsec SA:数据平面,单向,至少需要入站和出站两个<br>
两台端点设备之间只能有一个IKE SA,但能有多个IPsec SA.</li>
</ul>
<h3 id="site-to-site-ipsec">site-to-site ipsec </h3>
<p>ways:</p>
<ol>
<li>(!crypto maps(not good))
<ol>
<li>ip access-list extended <code>acl-name</code>
<ol>
<li>permit gre host <code>tunnel-source-ip</code> host <code>tunnel-destination-ip</code></li>
</ol>
</li>
<li>crypto isakmp policy <code>priority</code>(!1 is the highest)
<ol>
<li>encryption {des|3des|aes|aes 192|aes 256}(!des by default,not recommened,aes is recommoned)</li>
<li>hash {sha|sha256|sha384|md5}(!sha by default)</li>
<li>authentication {rsa-sig|rsa-encr|pre-share}</li>
<li>group {1|2|5|14|15|16|19|20|24}(!recommend to use 14 or higher)</li>
</ol>
</li>
<li>crypto isakmp key <code>keystring</code> address <code>address</code> [mask]</li>
<li>crypto ipsec transform-set <code>transform-set-name</code> [ESP加密] [ESP认证] [AH认证] (!各只能选一个.建议aes和sha)
<ol>
<li>mode {transport|tunnel(!默认)}(!选择transport更好)</li>
</ol>
</li>
<li>crypto map <code>map-name</code> <code>seq-name</code> [ipsec-isakmp]
<ol>
<li>match address <code>acl-name</code></li>
<li>set peer {hostname|ip-address}</li>
<li>set transform-set <code>transform-set-name</code> [transform-set-name2] --- [transform-set-name6]</li>
</ol>
</li>
<li>any physical interface
<ol>
<li>crypto map <code>map-name</code></li>
</ol>
</li>
</ol>
</li>
<li>(!<strong>tunnel IPsec profile</strong>)
<ol>
<li>crypto isakmp policy <code>priority</code>(!1 is the highest)
<ol>
<li>encryption {des|3des|aes|aes 192|aes 256}(!des by default,not recommened,aes is recommoned)</li>
<li>hash {sha|sha256|sha384|md5}(!sha by default)</li>
<li>authentication {rsa-sig|rsa-encr|pre-share}</li>
<li>group {1|2|5|14|15|16|19|20|24}(!recommend to use 14 or higher)</li>
</ol>
</li>
<li>crypto isakmp key <code>keystring</code> address <code>address</code> [mask] (!set address to 0.0.0.0 for all neighbors)</li>
<li>crypto ipsec transform-set <code>transform-set-name</code> [ESP加密] [ESP认证] [AH认证] (!各只能选一个.建议aes和sha)
<ol>
<li>mode {transport|tunnel(!默认)}(!选择transport更好)</li>
</ol>
</li>
<li>crypto ipsec profile <code>profile-name</code>
<ol>
<li>set transform-set <code>transform-set-name</code></li>
</ol>
</li>
<li>进入待加密gre接口
<ol>
<li>tunnel protection ipsec profile <code>profilename</code> [shared] (!must use interface as source)</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 id="transform-set">transform set </h4>
<table>
<thead>
<tr>
<th>ESP加密</th>
<th>ESP认证</th>
<th>AH认证</th>
<th>IP compression</th>
</tr>
</thead>
<tbody>
<tr>
<td>esp-aes {128|192|256}</td>
<td>esp-sha[256|384|512]-hmac</td>
<td>ah-md5-hmac</td>
<td>comp-lzs</td>
</tr>
<tr>
<td>esp-gcm {128|192|256}</td>
<td>esp-md5-hmac</td>
<td>ah-sha[256|384|512]-hmac</td>
<td></td>
</tr>
<tr>
<td>esp-gmac</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>esp-[3]des</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>esp-seal</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="预共享密钥认证">预共享密钥认证 </h3>
<p>预共享密钥认证是实现IPsec的一种部署方法.包含:</p>
<ol>
<li>
<p>IKEv2密钥环:预共享密钥的存储库</p>
<ol>
<li>crypto ikev2 keyring <code>keyring-name</code></li>
<li>peer <code>peer-name</code>(!一个密钥环支持多个对等体,使用不同的密码)</li>
<li>address <code>network</code> <code>mask</code></li>
<li>pre-shared-key [address <code>address</code>] <code>secure-key</code></li>
</ol>
</li>
<li>
<p>IKEv2配置文件:一组不可协商的安全参数.</p>
<ol>
<li>crypto ikev2 profile <code>ike-profile-name</code></li>
<li>match identity remote address {<code>ip-address</code>|0.0.0.0(!match all)}</li>
<li>(!PKI认证)identity local address <code>ip-address</code>(!与注册证书使用的地址匹配,建议使用环回接口)</li>
<li>(!FVRF)match fvrf {<code>vrf-name</code>|any}</li>
<li>authentication local {pre-share(!预共享密钥认证)|rsa-sig(!证书认证)}</li>
<li>authentication remote {pre-share|rsa-sig}</li>
<li>keyring local <code>keyring-name</code></li>
</ol>
</li>
<li>
<p>IPsec转换集:指定通过ESP还是AH对数据加密</p>
<ol>
<li>crypto ipsec transform-set <code>transform-set-name</code> [ESP加密] [ESP认证] [AH认证] (!各只能选一个.建议aes和sha)</li>
<li>mode {transport|tunnel(!默认)}(!选择transport更好)</li>
</ol>
</li>
<li>
<p>IPsec配置文件:将转换集和IKEv2配置文件关联起来.</p>
<ol>
<li>crypto ipsec profile <code>profilename</code></li>
<li>set transform-set <code>transform-set-name</code></li>
<li>set ikev2-profile <code>ike-profile-name</code></li>
</ol>
</li>
<li>
<p>其他:</p>
<ol>
<li>(!数据包重放保护)crypto ipsec securityassociation replay window-size <code>size</code>(!默认64,cisco建议使用最大值1024)</li>
<li>(!DPD,dead peer detection,失效对等体检测)crypto ikev2 dpd [<code>interval-time</code>] [<code>retry-time</code>] on-demand(!仅在分支路由器上配置)</li>
<li>(NAT保活)crypto isakmp nat keepalive <code>seconds</code>(!分支路由器上使用)</li>
</ol>
</li>
<li>
<p>保护</p>
<ol>
<li>crypto ikev2 limit {max-in-neogotation-sa <code>limit</code>|max-sa <code>limit</code>}[outgoing] (!半开SA阈值防Dos)</li>
<li>crypto ikev2 cookie-chanllenge <code>chanllenge-number</code></li>
</ol>
</li>
<li>
<p>加密隧道接口:</p>
<ol>
<li>进入待加密gre接口</li>
<li>tunnel protection ipsec profile <code>profilename</code> [shared]</li>
</ol>
</li>
</ol>
<h3 id="配置-32">配置 </h3>
<p>单点配置模式:</p>
<ol>
<li>
<p>interface tunnel <code>num</code></p>
</li>
<li>
<p>(!可选)tunnel mode {gre|ipsec} {ip|ipv6}(!选择封装方式,默认为GRE)</p>
</li>
<li>
<p>ip address <code>address</code> <code>mask</code>(!分配ip和掩码)</p>
</li>
<li>
<p>tunnel source {<code>ip-address</code>|<code>inerface-id</code>}</p>
</li>
<li>
<p>tunnel destination {<code>ip-address</code>|<code>hostname</code>}(!目的路由器的物理地址)</p>
</li>
<li>
<p>(!带宽)bandwidth <code>1-10,000,000</code></p>
</li>
<li>
<p>(!keepalive)keepalive [<code>seconds</code> [<code>retries</code>] ]</p>
</li>
<li>
<p>ip mtu <code>mtu</code></p>
</li>
</ol>
<p>DMVPN(如果ipv6,ip换成ipv6)(!注意在隧道接口上配置链路本地地址):</p>
<ul>
<li>HUB(中心路由器):
<ol>
<li>(!创建隧道接口)interface tunnel <code>tunnel-number</code></li>
<li>tunnel sourcee {<code>ip-address</code>|<code>interface</code>}(!不建议使用环回接口,会产生Qos问题)(!传输ip地址,也叫nbma地址)</li>
<li>(!mGRE隧道)tunnel mode gre multipoint [ipv6(!ipv6时设置)]</li>
<li>ip address <code>ip-address</code> <code>subnet-mask</code>(!子网掩码决定了隧道的可容纳数)</li>
<li>ip nhrp network-id <code>0-255.255.255.255</code>(!DMVPN网络ID,本地意义)
<ol>
<li>ip nhrp registration no-unique(!使用dhcp是最好启用,或强制启用)</li>
</ol>
</li>
<li>(!密钥)tunnel key <code>0-4294967295</code></li>
<li>(!FVRF)tunnel vrf <code>vrf-name</code></li>
<li>(!多播)ip nhrp map multicast dynamic(!多播支持,不启用则是非广播网段,启用则是广播网段)</li>
<li>(!NHRP重定向)ip nhrp redirect</li>
<li>bandwidth <code>1-10000000</code></li>
<li>ip mtu <code>mtu</code>(!默认1400)</li>
<li>ip tcp adjust-mss <code>mss-size</code>(!TCP MSS(Max Segment Size),默认1360)(!minimize the risk of fragmentation on a GRE/IP tunnel)</li>
<li>[ip nhrp authentication <code>password</code>] (!启用NHRP认证机制)</li>
<li>(!NHRP保持时间)ip nhrp holdtime <code>1-65535</code>(!默认7200s,建议值600s)</li>
<li>(!NHRP超时时间)ip nhrp registration timeout <code>1-65535</code>(!默认为保持时间的1/3)</li>
</ol>
</li>
<li>Spoke(分支路由器):
<ol>
<li>interface tunnel <code>tunnel-number</code></li>
<li>tunnel sourcee {<code>ip-address</code>|<code>interface</code>}
<ol>
<li><em><strong>tunnel destination <code>ip-address</code></strong></em>(!中心路由器的nbma地址,这一步是GRE隧道建立所需)(!第一阶段DMVPN使用此命令)</li>
<li><em><strong>tunnel mode gre multipoint [ipv6(!ipv6时设置)]</strong></em>(!第三阶段或第二阶段GRE隧道)</li>
</ol>
</li>
<li>ip address {<code>ip-address</code> <code>subnet-mask</code>|dhcp}或ipv6 address <code>ipv6-address/prefix-length</code>
<ol>
<li>ip nhrp registrationno-unique(!使用dhcp是最好启用,或强制启用)</li>
</ol>
</li>
<li>ip nhrp network-id <code>1-255.255.255.255</code>(!ID和中心路由器相同)</li>
<li>(!第三阶段开启shortcut数据包)ip nhrp shortcut</li>
<li>tunnel key <code>0-4294967295</code>(!密钥和中心路由器相同)</li>
<li>(!FVRF)tunnel vrf <code>vrf-name</code></li>
<li><em><strong>ip nhrp nhs <code>nhs-address</code> nbma <code>hub-nbma-address</code> [multicast]</strong></em>(!nbma地址是中心路由器的传输ip地址,nhs地址是其协议ip地址,是中心路由器第4步的ip地址)(!可以冗余设置)<br>
或:
<ol>
<li>ip nhrp map <code>nhs-address</code> <code>hub-nbma-address</code>(!映射NBMA地址为隧道ip地址)</li>
<li>[ip nhrp map multicast [<code>nbma-address</code>|dynamic] ] (!映射NBMA地址为广播或多播地址)</li>
<li>ip nhrp nhs <code>nhs-address</code>(!创建NHS表项将其分配给隧道IP地址???)</li>
</ol>
</li>
<li>bandwidth <code>1-10000000</code></li>
<li>ip mtu <code>mtu</code></li>
<li>ip tcp adjust-mss <code>mss-size</code>(!max segment size)(!minimize the risk of fragmentation on a GRE/IP tunnel)</li>
<li>[ip nhrp authentication <code>password</code>] (!启用NHRP认证机制)</li>
<li>(!NHRP保持时间)ip nhrp holdtime <code>1-65535</code>(!默认7200s,建议值600s)</li>
<li>(!NHRP超时时间)ip nhrp registration timeout <code>1-65535</code>(!默认为保持时间的1/3)</li>
</ol>
</li>
<li>FVRF
<ol>
<li>vrf definition <code>vrf-name</code>(!和MPLS处不同)</li>
<li>address-family {ipv4|ipv6}</li>
<li>interface <code>interface-id</code>
<ol>
<li>vrf forwarding <code>vrf-name</code></li>
<li>ip address {<code>ipv4</code> <code>mask</code>|<code>ipv6/prefix</code>}</li>
</ol>
</li>
<li>ip route vrf <code>vrf-name</code> 0.0.0.0 0.0.0.0 <code>next-hop-ip</code></li>
</ol>
</li>
</ul>
<h3 id="排错-15">排错 </h3>
<ul>
<li>show dmvpn [detail]</li>
<li>show ip nhrp [brief|detail]查看nhrp缓存</li>
</ul>
<h2 id="lispcisco-locatorid-separation-protocol">LISP(Cisco Locator/ID Separation Protocol) </h2>
<p>Be used to solve the problems of the default-free zone.</p>
<ul>
<li>aggreagtion issua</li>
<li>traffic engineer</li>
<li>multihoming</li>
<li>routing instability</li>
</ul>
<p>terminology:</p>
<ul>
<li>EID:the IP address of an endpoint within a LISP site</li>
<li>LISP router
<ul>
<li>ITR(ingress tunnel router):LISP-encapsulate IP packets destined outside the LISP site</li>
<li>ETR(egress tunnel router):de-encapsulate LISP-encapsulate destined the EIDs within the LISP site</li>
<li>xTR:perform ITR and ETR at the same time</li>
<li>PITR(proxy ITR):for packets from non-LISP sites to EID destination</li>
<li>PETR(proxy ETR):for packets destined to non-LISP sites</li>
<li>PxTR:perform PITR and PETR at the same time</li>
</ul>
</li>
<li>RLOC(Routing locator):ipv4 or ipv6 address of an ETR facing the Internet</li>
<li>MS(Map server):learn and store EID-to-prefix mapping entries in EID-to-RLOC database</li>
<li>MR(Map resolver):cunsulting the MS and response requests</li>
<li>MS/MR</li>
</ul>
<h3 id="architecture">architecture </h3>
<ul>
<li>route by EID in LISP site,by RLOC in the Internet</li>
<li>based on a pull model(only request the nessary information) in comparison with push model(push all the routes to the routers)</li>
<li>Data plane
<ul>
<li>Outer LISP IP header
<ul>
<li>source RLOC IP</li>
<li>Destination RLOC IP</li>
</ul>
</li>
<li>Outer LISP UDP header
<ul>
<li>Source port</li>
<li>Destination port</li>
</ul>
</li>
<li>LISP Header
<ul>
<li>Flags</li>
<li>Map version</li>
<li>Instance ID:enables VRF and VPNs for virtualization and segmentation</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="operation">Operation </h3>
<ul>
<li>Map Registration and notification
<ul>
<li>ETR sends a map register message to the MS to register its associated EID prefix</li>
</ul>
</li>
<li>Map Request and Reply
<ul>
<li>When ITR receives the packet destined to other LISP site,if there's no matched non-default route and no matched entry in cache,send a map request to the MR</li>
<li>MR forward the request to the MS</li>
<li>MS forward the request to the ETR</li>
<li>ETR sends to the ITR a map reply</li>
</ul>
</li>
<li>LISP data path
<ul>
<li>ITR encapsulates the packet to the ETR with ITR's RLOC address as source address and ETR's RLOC address as destination address</li>
<li>ETR de-encapsulates it</li>
</ul>
</li>
<li>Proxy ETR
<ul>
<li>ITR sends a map request to the MR</li>
<li>MR responds with a negative map reply that includes a calculated non-LISP prefix(shortest prefix which matches the requested destination but does not match any LISP EIDs) and PETR's address</li>
<li>ITR add the prefix into cache and sends packets to PETR</li>
</ul>
</li>
<li>Proxy ITR
<ul>
<li>behave in the same as ITRs</li>
</ul>
</li>
</ul>
<h2 id="vxlan">Vxlan </h2>
<p>VXLAN extends Layer 2 and Layer 3 overlay networks over a Layer 3 underlay network.(VXLAN（Virtual Extensible LAN，虚拟可扩展局域网）是一种网络技术，它允许在现有的第三层（Layer 3）网络基础设施上创建第二层（Layer 2）和第三层（Layer 3）的虚拟网络（overlay networks）)</p>
<p>VNI(VXLAN network identifier) of 24 bit,is to provide segmentation for Layer 2 and Layer 3.</p>
<p>use VTEPs(virtual tunnel endpoints) to discover VNI over the underlay Layer 3. VTEPs connect between Overlay and Underlay network and they are responsible for encapsulating frame into VXLAN packets to send across IP network (Underlay) then decapsulating when the packets leaves the VXLAN tunnel. . Each VTEP has two parts:</p>
<ul>
<li>Local Lan interfaces</li>
<li>IP interface</li>
</ul>
<p>VXLAN just defines VXLAN as a data plane,but it does not define a VXLAN control plane.</p>
<ul>
<li>VXLAN with Multicast underlay(most popular)</li>
<li>VXLAN with static unicast VXLAN tunnels</li>
<li>VXLAN with MP-BGP EVPN control plane(most popular)</li>
<li>VXLAN with LISP control plane(campus preferred)
<ul>
<li>Cisco Software-Defined Access is an example</li>
</ul>
</li>
</ul>
<h2 id="pppoe">PPPoE </h2>
<p>PPPoE可以在以太网中创建一条PPP链路.可以通过以太网启用拨号接口.</p>
<h3 id="配置-33">配置 </h3>
<ul>
<li>一层
<ul>
<li>interface dialer <code>number</code></li>
<li>进入接口</li>
<li>dialer-pool <code>number</code></li>
<li>pppoe-client dial-pool-number <code>number</code></li>
</ul>
</li>
<li>二层
<ul>
<li>拨号接口</li>
<li>encapsulation ppp</li>
<li>ppp chap hostname <code>name</code></li>
<li>ppp chap password <code>password</code></li>
<li>以太网接口</li>
<li>pppoe enable</li>
</ul>
</li>
<li>三层
<ul>
<li>拨号接口中</li>
<li>ip address negotiated(!自动获取)</li>
<li>mtu 1492</li>
<li>以太网接口</li>
<li>no ip address</li>
</ul>
</li>
</ul>
<h1 id="qos">QOS </h1>
<p>Qos(quality of service)系列工具管理网络流量的带宽,延迟,抖动,丢包.</p>
<p>Trust Boundary should be done as close to end-point as possible.</p>
<h2 id="models">models </h2>
<ol>
<li>
<p>Best effort<br>
does not require qny special treatment</p>
</li>
<li>
<p>Intergrated Services<br>
use RSVP(Resource Reservation Protocol) to reserve resources for a specific application and provide CAC(call admission control) to guarantee no other IP traffic can use the reserved resources.</p>
<p>but need all nodes support,build,and maintain RSVP path state for every flow.</p>
</li>
<li>
<p>Differentiated Services(DiffServ)<br>
divides IP traffic into classes and marks it.</p>
</li>
</ol>
<h3 id="分类和标记">分类和标记 </h3>
<p>首先Qos会根据数据包的字段,等进行匹配和标记(数据生成之初执行复杂匹配,标记之后进行简单匹配,节约性能),当数据包不能通过简单的判断分类时,会使用名为NBAR2(Network Based Application Recognition version 2,基于网络的应用识别)的工具.使用标记和分类Qos时需要设定Qos的信任边界,不信任接入层的终端设备的标记.</p>
<ul>
<li>descriptors used for classification
<ul>
<li>Internal:QoS group</li>
<li>Layer 1:interface or port</li>
<li>Layer 2:mac and 802.1Q/p class(CoS) bit</li>
<li>Layer 2.5:MPLS experimental(EXP) bits</li>
<li>Layer 3:DSCP(Differentiated Services Code Points),IP precedence,and ip addresses</li>
<li>Layer 4:TCP or UDP port</li>
<li>Layer 7:NBAR2</li>
</ul>
</li>
</ul>
<p>DiffServ建议了统一的DSCP标记值,有加速转发(EF),确保转发(AF),类别选择器(CS)等.加速转发即优先被路由,确保转发定义了四个独立队列,在队列中定义了三个优先级.根据标记的不同在不同队列中有不同优先级的丢弃行为.类别选择器(CS),IPP对应的值*8为对应DSCP的值</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>头部</th>
<th>长度(bit)</th>
<th>适用范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>DSCP</td>
<td>ip</td>
<td>6</td>
<td>端到端数据包</td>
</tr>
<tr>
<td>IPP(IP优先级)</td>
<td>ip</td>
<td>3</td>
<td>端到端数据包</td>
</tr>
<tr>
<td>Cos</td>
<td>802.1Q</td>
<td>3</td>
<td>Vlan Trunk</td>
</tr>
<tr>
<td>TID</td>
<td>802.11</td>
<td>3</td>
<td>WIFI</td>
</tr>
<tr>
<td>EXP</td>
<td>MPLS</td>
<td>3</td>
<td>MPLS WAN</td>
</tr>
</tbody>
</table>
<h4 id="nbar2">NBAR2 </h4>
<p>can recognize close to 1500 applications.</p>
<ul>
<li>protocol discover</li>
<li>Modular QoS CLI</li>
<li>use layer 3 to layer 7</li>
</ul>
<h4 id="mark">mark </h4>
<ol>
<li>layer 2(802.1p)
<ol>
<li>TPID(Tag Protocol Identifier)</li>
<li>TCI(tag control information)
<ol>
<li>
<p>PCP(Priority Code Point,mark packets as a specific CoS)</p>
<table>
<thead>
<tr>
<th>value</th>
<th>Acronym</th>
<th>Traffic Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>BK</td>
<td>background</td>
</tr>
<tr>
<td>1</td>
<td>BE</td>
<td>Best effort</td>
</tr>
<tr>
<td>2</td>
<td>EE</td>
<td>Excellent effort</td>
</tr>
<tr>
<td>3</td>
<td>CA</td>
<td>Critical applications</td>
</tr>
<tr>
<td>4</td>
<td>VI</td>
<td>Vedio &lt;100ms latency and jitter</td>
</tr>
<tr>
<td>5</td>
<td>VO</td>
<td>Vedio &lt;10ms latency and jitter</td>
</tr>
<tr>
<td>6</td>
<td>IC</td>
<td>Internet control</td>
</tr>
<tr>
<td>7</td>
<td>NC</td>
<td>net control</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>DEI(Drop Eligible Indicator)<br>
set to 1 to indicate that the frame can be dropped</p>
</li>
<li>
<p>VLAN ID</p>
</li>
</ol>
</li>
</ol>
</li>
<li>layer 2.5
<ol>
<li>MPLS</li>
</ol>
</li>
<li>layer 3
<ol>
<li>TOS
<ol>
<li>IPP(3bit) before</li>
<li>DS(DiffServ field,8bit) now<br>
PHB(per-hop behavior) is expediting,delaying,or dropping a collection of packets by BAs(Behavior Aggregate),which based on DSCP value
<ol>
<li>6bit DSCP(DiffServ Code Point)
<ol>
<li>CS(Class Selector) PHB:backward compatible with IPP,higher values mean higher priority:{0|1}{0|1}{0|1}+000
<ol>
<li>CS1 means <strong>Scavenger Class</strong>,less than best-effort service.</li>
</ol>
</li>
<li>DF(Default Forwarding) PHB:used for best effort:000000</li>
<li>AF(Assured Forwarding) PHB:guaranteed bandwidth service:{000~100}+{0|1}{0|1}0,the former means IPP priority,the later means dorp probability</li>
<li>EF(Expedited Forwarding) PHB:used for low-delay service:101110,46 in decimal</li>
</ol>
</li>
<li>2bit ECN(Explicit Congestion Notification)</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="拥塞控制队列-和-避免">拥塞控制(队列) 和 避免 </h3>
<p>所有网络互联设备都使用队列机制.例如轮询调度,使权重更高的队列得到的带宽更多(这样还可以实现带宽控制);优先级队列,将语音数据的队列永远优先处理(语音数据量大时会导致其他队列饥饿,使用CAC解决).</p>
<p>依赖于TCP中的拥塞避免机制,设立丢弃一些数据包的阈值和级别,当队列满到某个阈值时,丢弃某个百分比的数据包,队列越满,丢弃越多.</p>
<p>legacy queue:</p>
<ul>
<li>FIFO(First-in,First-out)</li>
<li>Round robin:multiple equal-priority FIFO</li>
<li>WRR(Weighted round robin):queue receive a portion of interface bandwidth
<ul>
<li>CQ(Custom queuing):Cisco implementation of WRR.Causing long delay and being not support to DSCP</li>
</ul>
</li>
<li>PQ(Priority queuing):always serve higher-priority queue,possibly making lower-priority queue starve</li>
<li>WFQ(Weighted fair queuing):divides the interface bandwidth by IPP.can't provide a fixed-bandwidth guanrantee for any particular flow.</li>
</ul>
<p>current queue:</p>
<ul>
<li>CBWFQ(class-based weighted fair queuing)<br>
suitble for non-real-time data traffic.characteristics:
<ul>
<li>up to 256 queues</li>
<li>packet classfication</li>
<li>minimum bandwidth</li>
<li>weight</li>
<li>maximum packets limit</li>
</ul>
</li>
<li>LLQ<br>
CBWFQ with PQ,a single priority queue schedules all the combined traffic with multiple bandwidth guarantees and if a class is not using the bandwidth,it is shared.more suitble for real-time traffic.</li>
</ul>
<p>aviodance tool:</p>
<ul>
<li>tail drop:drop when outpuit queue buffers are full without differentiated Services,causing TCP congest over and over again.</li>
<li>RED(early detection):monitering the buffer depth and performs early drops on random packet</li>
<li>WRED(weighted RED):RED with supports of DSCP,IPP or ECN.</li>
</ul>
<h3 id="整形和限速policing-and-shaping">整形和限速(policing and shaping) </h3>
<p>限速工具通过检测数据包,对超过速率限制的数据包丢弃,实现限速功能.限速工具通常是ISP对企业使用,企业则需要使用整形工具,通过将达到速率限制的数据包推迟发出,达到对速率整形的目的.</p>
<ol>
<li>policer and shaper</li>
<li>markdown:mark the excess traffic with a lower-priority</li>
</ol>
<h4 id="token-bucket-algorithms">Token Bucket Algorithms </h4>
<ul>
<li>CIR(Committed Information Rate,bps)</li>
<li>PIR(Peak Information Rate)</li>
<li>Tc(Committed Time Interval,time interval,ms):<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>c</mi><mo>=</mo><mo stretchy="false">(</mo><mi>B</mi><mi>c</mi><mi mathvariant="normal">/</mi><mi>C</mi><mi>I</mi><mi>R</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>1000</mn></mrow><annotation encoding="application/x-tex">Tc=(Bc/CIR)/1000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">c</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">)</span><span class="mord">/1000</span></span></span></span>,recommend to 8 to 125 ms,shorter Tc reduce interpacket delay</li>
<li>Bc(Committed Burst Size,bytes):the maximum amount of traffic within a Tc</li>
<li>Be(excess burst size)</li>
<li>Token:1 byte</li>
<li>Token Bucket:sending packet takes tokens from the bucket(such as the Bc if a single bucket).if tokens of bucket are not enough,it will
<ul>
<li>waiting for tokens to accumulate(traffic shaping)</li>
<li>Drop(policing)</li>
<li>Mark</li>
</ul>
</li>
</ul>
<h4 id="policers">policers </h4>
<ol>
<li>Single-rate two-color<br>
single-rate:CIR<br>
two-color:Conform and exceed</li>
<li>Single-rate three-color(srTCM)<br>
another bucket to store tokens left over<br>
single-rate:CIR<br>
Three-color:Conform,exceed(over Bc but under Be) and violate</li>
<li>Two-rate three-color<br>
Two-rate:CIR and PIR(maximum rate of traffic <a href="http://allowed.Be">allowed.Be</a> Greater than CIR)<br>
Three-color:Conform,exceed(over Bc but under Be) and violate</li>
</ol>
<h3 id="modular-qos-climqc">Modular QoS CLI(MQC) </h3>
<p>cisco's approach to implementing QoS on Cisco router.</p>
<ol>
<li>class map<br>
define traffic classification</li>
<li>policy map<br>
provide QoS action for each class</li>
<li>service policy<br>
apply policy maps to interface</li>
</ol>
<h4 id="configure-1">configure </h4>
<ol>
<li>class-map [match-any|match-all(!default)] <code>class-map-name</code>
<ol>
<li>match {<br>
access-group <code>num/name</code><br>
|cos <code>cos-value-list</code>(!CoS???)<br>
|[ip(!meaning ipv4)] dscp <code>dscp-value-list</code><br>
|[ip(!meaning ipv4)] precedence <code>precedence-list</code><br>
|ip rtp <code>starting-port-number</code> <code>port-number-range</code><br>
|protocol <code>protocol-name</code>(!match NBAR protocol name)<br>
|qos-group <code>qos-group-name</code><br>
|protocol http [url <code>url-string</code>|host <code>hostnamr-str</code>|mime <code>mime-type</code>]<br>
|protocol rtp [audio|vedio|payload-type <code>payload-string</code>]<br>
|protocol <code>peer-to-peer-application</code><br>
|any<br>
}</li>
</ol>
</li>
<li>policy-map <code>policy-map-name</code>
<ol>
<li>
<p>class <code>class-map-name</code></p>
<ol>
<li>set {qos-group <code>qos-group-id</code><br>
|cos <code>cos-value</code><br>
|[ip] precedence <code>ipp</code><br>
|[ip] dscp <code>dscp-value</code>}</li>
<li>police [cir] <code>cir-in-bps</code> [ [bc] <code>Bc</code>] [ [be] <code>Be</code>(!default equeals Bc)] [pir <code>Pir</code>] [comform-action <code>action</code>(!default transmit)] [exceed-action <code>action</code>(!default drop)] [violate-action <code>action</code>(!default drop)] (!cir,bc,be are just nonates)<br>
action:
<ul>
<li>drop</li>
<li>transmit</li>
<li>set-dscp-transmit</li>
<li>set-prec-transmit</li>
<li>set-cos-transmit</li>
<li>set-qos-transmit(only valid on inbound policy map)</li>
</ul>
</li>
<li>priority(!PQ)(!cannot coexist with random-detect,shape,fair-queue and bandwidth in the same class)(!don't support police in the same class???)<br>
[<code>police-rate-in-kbps</code> [<code>burst-in-bytes</code>]<br>
|percent <code>police-rate-in-percentage</code><br>
|level {1|2} (!just co-exist with bandwidth remaining in the same map)<br>
|level {1|2} <code>police-rate-in-kbps</code> [<code>burst-in-bytes</code>]<br>
|level {1|2} percent <code>police-rate-in-percentage</code>(!relative percent,as shaper's setting)<br>
] (!priority is only in effect only during time of congestion)</li>
<li>bandwidth<br>
{<code>bandwidth-in-kbps</code><br>
|remaining percent <code>percentage</code>(!relative percent,as shaper's setting)<br>
|remaining ratio <code>ratio</code>(!relative ratio,as shaper's setting)<br>
|percent <code>percentage</code>(!absolute percent)<br>
}</li>
<li>fair-queue(!used on class-default to manage multiple flows???,require the bandwidth or shape)</li>
<li>shape {average|peak(!not commonly used)} <code>mean-rate-in-bps</code> [ [<code>Bc</code>] [<code>Bs</code>] ]</li>
<li>queue-limit <code>queue-limit-size</code> {cos <code>cos-value</code>|dscp <code>dscp-value</code>|<code>IPP</code>} percent <code>percantage-of-packets</code> (!require the bandwidth,shape,or priority in the same class)</li>
<li>random-detect [dscp-based|precedence-based|cos-based] (!enables WRED,require the bandwidth or shape in the same class)</li>
</ol>
<p>example:<br>
class vedio or voip:priority level percent, other classes:bandwidth percent<br>
OR class vedio or voip:priority level, other classes:bandwidth remaining percent,</p>
<p>default:fair,random,queue-limit,bandwidth like other classes</p>
</li>
</ol>
</li>
<li>interface <code>interface</code></li>
<li>service-policy [input|ouput] <code>policy-map-name</code></li>
</ol>
<h2 id="netflow">netflow </h2>
<p>netflow:gather statistics.Netflow has two parts that must be configured:</p>
<ol>
<li>data capture:based on flow(source ip,destination ip,source port,destination port,layer3 protocol type,ToS,input logical interface)
<ol>
<li>ingress
<ol>
<li>ip to ip</li>
<li>ip to MPLS</li>
<li>frame relay</li>
<li>ATM</li>
</ol>
</li>
<li>egress
<ol>
<li>ip</li>
<li>MPLS to ip</li>
</ol>
</li>
</ol>
</li>
<li>data export</li>
</ol>
<p>flexible netflow has 4 components:</p>
<ol>
<li>flow records
<ol>
<li><strong>match</strong> command is used to select key field</li>
<li><strong>collect</strong>  command is used to select non-key field</li>
</ol>
</li>
<li>flow monitors</li>
<li>flow Exporters</li>
<li>flow samplers</li>
</ol>
<h3 id="configure-2">configure </h3>
<ul>
<li>ip flow {ingress|egress}</li>
<li>ip flow-export [version <code>version</code>|destination <code>ip</code>]</li>
</ul>
<h3 id="show">show </h3>
<ul>
<li>show ip flow interface</li>
<li>show ip flow export</li>
<li>show ip cache flow</li>
</ul>
<h1 id="security">security </h1>
<p>To address the issue,cisco creates a SAFE(secure architectural framework) to help design secure solutions based on the PINs(places in the network):</p>
<ul>
<li>branch
<ul>
<li>endpoint malware</li>
<li>rogue APs for MitM(man-in-the-middle)</li>
<li>Dos</li>
<li>unauthorized/malicious client</li>
</ul>
</li>
<li>campus
<ul>
<li>phishing</li>
<li>web-based exploit</li>
<li>unauthorized access</li>
<li>malware</li>
<li>botnet infestation</li>
</ul>
</li>
<li>data center
<ul>
<li>data extraction</li>
<li>malware</li>
<li>unauthorized access</li>
<li>botnet infestation</li>
<li>data loss</li>
<li>privilege escalation</li>
<li>reconnaissance</li>
</ul>
</li>
<li>edge:most important for e-commerce
<ul>
<li>web server vulnerrabilities</li>
<li>DDoS</li>
<li>data loss</li>
<li>MitM attack</li>
</ul>
</li>
<li>cloud:provide services
<ul>
<li>web server vulnerabilities</li>
<li>loss of access</li>
<li>data loss</li>
<li>malware</li>
<li>MitM attack</li>
</ul>
</li>
<li>WAN
<ul>
<li>malware</li>
<li>unauthorized access</li>
<li>WAN sniffing</li>
<li>MitM attack</li>
</ul>
</li>
</ul>
<h2 id="attack-continuum">attack continuum </h2>
<ol>
<li>before:establish policies and implement prevention
<ul>
<li>firewall</li>
<li>access control</li>
<li>identity services</li>
</ul>
</li>
<li>during:detect,block and defend
<ul>
<li>next-generation intrusion prevention systems</li>
<li>next-generation firewall</li>
<li>malware protection</li>
<li>email and web security solution</li>
</ul>
</li>
<li>after:detect,contain and remediate an attack
<ul>
<li>cisco advanced malware protection</li>
<li>next-generation firewall</li>
<li>malicious network behavior analysis(cisco secure network analytics)</li>
</ul>
</li>
</ol>
<h2 id="next-generation-endpoint-security">next-generation endpoint security </h2>
<ol>
<li>Cisco Talos:detect,analyze and protect against known and emerging threats</li>
<li>Cisco Secure Malware Analytics:perform static file anylisis by running the files in sandbox</li>
<li>Cisco AMP(Advanced Malware Protection):malware anylisis and protection
<ol>
<li>AMP cloud</li>
<li>AMP connectors
<ol>
<li>secure endpoint</li>
<li>secure email</li>
<li>secure web appliance</li>
<li>AMP for network</li>
<li>AMP for Meraki MX</li>
</ol>
</li>
<li>Threat intelligence from Talos and Secure Malware Analytics</li>
</ol>
</li>
<li>Cisco Secure Client:VPN and enhanced security</li>
<li>Cisco Umbrella:OPENDNS of cisco.(anycast;)</li>
<li>Cisco WSA(secure web application):an all-in-one web gateway including a wide variety of protections that can block websites
<ol>
<li>before an attack:web reputation filter,web filter and cisco AVC(application visibility and control)</li>
<li>during an attack:cloud access security,parallel av scanning,file reputation(AMP),data loss prevention</li>
<li>after an attack:file sandboxing(AMP),file retrospection(AMP),cognitive threat analytics</li>
</ol>
</li>
<li>Cisco ESA(Secure Email):</li>
<li>Cisco Secure IPS(intrusion prevention system):
<ol>
<li>IDS(intrusion detection system):passively monitor and analyze traffic for potential network intrusion attacks and log attack data for security analysis</li>
<li>IPS:provide IDS function and automatically blocks intrusion attacks</li>
<li>NGIPS(next generation IPS):IPS and below features
<ol>
<li>real-time contextual awareness</li>
<li>advanced threat protection</li>
<li>intelligent security automation</li>
<li>Unparalled performance and scalability</li>
<li>AVC and URL filtering</li>
</ol>
</li>
</ol>
</li>
<li>Cisco Secure Firewall:monitor incoming and outgoing traffic and filter them
<ol>
<li>NGFW(next generation firewall):firewall and below features
<ol>
<li>stateful inspection</li>
<li>integrated IPS</li>
<li>application-level inspection</li>
<li>leverage external security intelligence to address evoling security threats</li>
</ol>
</li>
</ol>
</li>
<li>Cisco Secure FMC(firewall manage center)</li>
<li>Cisco Secure Network Analytics:perform network security analysis and monitoring to automatically detect threats
<ol>
<li>manager(formerly SMC(stealthwatch management console))</li>
<li>cisco secure network analytics flow collector:collect netflow and IPFIX(ip flow information export)</li>
<li>cisco secure network analytics flow rate license:define the volume of flows that can be collected</li>
</ol>
</li>
<li>Cisco Secure Cloud Analytics:
<ol>
<li>cisco sucure public cloud monitoring(formerly stealthwatch cloud public cloud monitoring):provides visibility and threat detection in AWS,GCP and Azure cloud <a href="http://infrasturcture.It">infrasturcture.It</a> is an SaaS-based solution.</li>
<li>cisco secure network analytics SaaS(formerly stealthwatch cloud private network monitoring):provides visibility and threat detection for on-premises network from a cloud-SaaS solution</li>
</ol>
</li>
<li>Cisco ISE(indentity services engine):security policy management platform that provides NAC(network access control) to users and devices across wired,wireless and VPN network.</li>
</ol>
<h2 id="nacnetwork-access-control">NAC(network access control) </h2>
<h3 id="8021x">802.1x </h3>
<p>802.1x is a port-based NAC standard that provides an authentication mechanism for LAN and WLAN.<br>
has the following components:</p>
<ul>
<li>EAP(Extensible authentication protocol):encapsulated transport</li>
<li>EAP method(EAP type)
<ul>
<li>challenge-based authentication method
<ul>
<li>EAP-MD5:lack of authentication from supplicant to authentication server</li>
</ul>
</li>
<li>TLS authentication method
<ul>
<li>EAP-TLS:most sucure but difficult to deploy,both need certificate</li>
</ul>
</li>
<li>tunneled(refered as outer) TLS authentication method:
<ul>
<li>EAP-FAST(flexible authentication via secure tunneling):like PEAP but faster,support EAP chain(do not require a radius server certificate???)
<ul>
<li>EAP-chain:combine machine and user authentication into single authentication</li>
</ul>
</li>
<li>EAP-TTLS(tunneled TLS):similar to PEAP but support more legacy inner methods</li>
<li>PEAP(protected extensible authentication methods):only server needs certificate</li>
</ul>
</li>
<li>EAP inner authentication method:tunneled within PEAP,EAP-FAST and(or???) EAP-TTLS
<ul>
<li>EAP-GTC(generic token card)</li>
<li>EAP-MSCHAPv2(microsoft handshake authentication protocol v2)</li>
<li>EAP TLS:most secure but complex to deploy</li>
</ul>
</li>
</ul>
</li>
<li>EAP over LAN</li>
<li>RADIUS protocol</li>
</ul>
<p>802.1x devices consists of</p>
<ul>
<li>supplicant:client
<ul>
<li>must specify the EAP method</li>
</ul>
</li>
<li>authenticator:A network access device such as switch,AP or WLC
<ul>
<li>do not need to specify the EAP method</li>
</ul>
</li>
<li>authentication server:usually a RADIUS server
<ul>
<li>must specify the EAP method</li>
</ul>
</li>
</ul>
<h3 id="mabmac-authentication-bypass">MAB(MAC authentication bypass) </h3>
<p>port-based access control using MAC address,and it's typically used as fallback mechanism to 802.1x.</p>
<ol>
<li>send an EAPoL per 30 seconds.after 3*30 seconds,fallback to MAB</li>
<li>crafts a RADIUS access-request message using the endpoint's MAC address(before fallback to MAB,don't learn mac address)</li>
<li>RADIUS server determine access level and response a Access-Accept</li>
</ol>
<p>mac addresses is easily spoofed,MAB need to use dACLs(downloadable ACLs),dVLAN and SGTs.</p>
<h3 id="web-authentication">web authentication </h3>
<p>fallback for 802.1x and MAB.</p>
<p>need user to enter username and password.</p>
<ol>
<li>LWA(Local web authentication):switch or wireless controller redirect web traffic to a locally hosted web portal
<ol>
<li>guest VLAN and LWA are mutually exclusive</li>
<li>only support ACL assignment</li>
</ol>
</li>
<li>CWA(central web authentication) with cisco ISE
<ol>
<li>supports CoA(change of authentication),dACL and vlan</li>
</ol>
</li>
</ol>
<h3 id="flexauthflexvible-authentication">FlexAuth(Flexvible authentication) </h3>
<p>allow multiple authentication methods concurrently.</p>
<h3 id="ibns20identity-based-networking-services">IBNS2.0(identity-based networking services) </h3>
<p>combination of FlexAuth,C3PL(cisco common classification policy language) and ISE.</p>
<h3 id="cisco-trustsec">Cisco trustsec </h3>
<p>next-generation access control solution using VLANs and maintaining firewall rules and ACLs with SGTs(security group tag).<br>
SGT represent the context of the user,device,use case or function to perform ingress tagging and egress filtering.<br>
SGT assignment is deliverd to the authenticator as an authorization option.</p>
<p>3 phases of configuration:</p>
<ol>
<li>ingress classification
<ol>
<li>dynamic assignment</li>
<li>static assignment</li>
</ol>
</li>
<li>propagation
<ol>
<li>inline tagging:inserts tthe SGT into frame.if device don't support native tagging in hardware,the frame will be dropped.</li>
<li>SXP propagation:SXP is a TCP-based protocol.IP-to-SGT mapping can be communicated between non-inline devices.</li>
</ol>
</li>
<li>egress enforcement
<ol>
<li>SGACL(security ACL)</li>
<li>SGFW(security group firewall)</li>
</ol>
</li>
</ol>
<h3 id="macsec">MACsec </h3>
<p>Macsec is defined by 802.1AE, and is a layer2 hop-by-hop encryption method.<br>
encrypt egress traffic and decrypt ingress traffic for switches.</p>
<p>key mechanisms:</p>
<ol>
<li>SAP(security association protocol):cisco proprietary</li>
<li>MKA(MACsec Key Agreement) protocol:provides the required session keys and manage the required encryption keys.</li>
</ol>
<p>Uplink MACsec:mean a link between switchs.use SAP by default.dynamic MACsec need 802.1x authentication<br>
Downlink MACsec:mean the encryped link between an endpoint and a switch.</p>
<h2 id="aaaauthenticationauthenrization-and-accounting">aaa(authentication,authenrization and accounting) </h2>
<ul>
<li>authentication:identify</li>
<li>authenrization:privileges and restictions</li>
<li>accounting:track and log use access</li>
</ul>
<p>use two protocol:</p>
<ul>
<li>RADIUS(remote authentication dial-in user service):prefered protocol for secure network access control
<ul>
<li>UDP</li>
<li>use EAP(802.1x)</li>
</ul>
</li>
<li>TACACS+(terminal access controller access-control system plus):more suitble for network device access control
<ul>
<li>TCP:49</li>
<li>will separate authentication into terminal with ((TACACS+ client) using telnet or ssh) and ((TACACS+ client with TACACS+ server) using TACACS+)<br>
aaa服务器会集中保护交换机和路由器的用户名/密码对,aaa服务器可以是一个或多个服务器组成的服务器,aaa服务器会对启用了802.1x的认证方传来的消息认证,一般交换机充当认证方,终端充当请求方,认证成功交换机就不会过滤这个端口的消息了,认证不成功请求方可以重试.用户请求通过EAPoL传输到交换机,交换机发送RADIUS或TACACS+到aaa服务器.</li>
</ul>
</li>
</ul>
<p>如果使用aaa,802.1x需要在局域网的所有设备上开启,使用EAP(类似UDP)进行通信.802.1x一般需要在连接终端用户的接口上启用.</p>
<h3 id="aaa配置">aaa配置 </h3>
<p>!配置模式:</p>
<ol>
<li>
<p>aaa new-model</p>
<!-- 2. username `username` password  `num` `password`(!存在本地数据库,对应local验证) -->
</li>
<li>
<p>(!tacacs-server or radius server)</p>
<!-- 1. tacacs-server host {`server-name`|`ip`} key `key`(!for prior version) -->
<ol>
<li>tacacs server <code>name</code>
<ol>
<li>address ipv4 {<code>hostname</code>|<code>ip</code>} [auth-port <code>port</code>] [ari <code>port</code>] [acc <code>port</code>]</li>
<li>key <code>key</code></li>
</ol>
</li>
<li>radius server <code>server-name</code>
<ol>
<li>address ipv4 {<code>hostname</code>|<code>ip</code>} [auth-port <code>port</code>] [ari <code>port</code>] [acc <code>port</code>]</li>
<li>key <code>key</code></li>
</ol>
</li>
</ol>
</li>
<li>
<p>ip {radius|tacacs} source-interface <code>source-interface</code></p>
</li>
<li>
<p>(!enable ISE)[aaa server {radius|tacacs} dynamic-author]</p>
<ol>
<li>client <code>ip</code> server-key <code>encryption-level</code> <code>key</code></li>
</ol>
</li>
<li>
<p>aaa group server {radius|tacacs+} <code>group-name</code></p>
<ol>
<li>server name <code>server-name</code>(!allow multiple servers)</li>
</ol>
</li>
<li>
<p>aaa authentication login {default|<code>line-name</code>} <code>method</code> <code>method2</code>(!method={group <code>group-name</code>|local|enable})</p>
<!-- 8.  port `port` -->
<!-- 8. aaa authenrization default `method1` `method2`(!medthod={`group-name|server-name`|local(!本地用户名认证)|login(!密码认证)}) -->
</li>
<li>
<p>aaa authenrization exec {default|<code>line-name</code>} <code>method</code> <code>method2</code></p>
</li>
<li>
<p>aaa authenrization console</p>
</li>
<li>
<p>aaa authenrization commands {privilege <code>level</code>} {default|<code>line-name</code>} <code>method</code> <code>method2</code></p>
</li>
<li>
<p>aaa authenrization config-commands(!enable all authenrization command)</p>
</li>
<li>
<p>aaa accounting exec {default|<code>line-name</code>} {start-stop|stop-only|wait-start} <code>method</code> <code>method2</code>(!login accounting)</p>
</li>
<li>
<p>aaa accounting commands   {privilege <code>level</code>} {default|<code>line-name</code>} {start-stop|stop-only|wait-start} <code>method</code> <code>method2</code></p>
</li>
</ol>
<h3 id="排错-16">排错 </h3>
<ol>
<li>需要使用aaa new-model启用aaa</li>
</ol>
<h2 id="coppcontrol-plane-policing">CoPP(control plane policing) </h2>
<p>QoS policy to classify traffic into various types.</p>
<h3 id="configure-3">configure </h3>
<ul>
<li>创建acl识别流量</li>
<li>创建分类映射定义流量类别
<ol>
<li>class-map [match-any|match-all] <code>class-name</code></li>
<li>match [access-group name <code>acl-name</code>|protocol <code>protocol</code>|ip prec <code>prec</code>|ip dscp <code>dscp</code>]</li>
<li>exit</li>
</ol>
</li>
<li>创建策略映射定义服务策略
<ol>
<li>policy-map <code>policy-name</code></li>
<li>class <code>class-name</code></li>
<li>police [<code>cir</code>|<code>rate</code>] conform-action [transmit|drop] exceed-action [transmit|drop] violate-action [transmit|drop]</li>
</ol>
</li>
<li>应用于控制平面
<ol>
<li>control plane</li>
<li>service-policy {input(!received)|output(!generated)} <code>policy-name</code></li>
<li>end</li>
</ol>
</li>
</ul>
<h3 id="verify">verify </h3>
<h2 id="device-hardening">device hardening </h2>
<ul>
<li>disable topology discover tools
<ul>
<li><em>no cdp enable</em></li>
<li><em>no lldp transmit</em></li>
<li><em>no lldp receive</em></li>
</ul>
</li>
<li>enable keepalives for TCP sessions
<ul>
<li><em>service tcp-keepalive-in</em></li>
<li><em>service tcp-keepalive-out</em></li>
</ul>
</li>
<li>disable ip redirect services
<ul>
<li><em>no ip redirects</em></li>
</ul>
</li>
<li>disable proxy arp
<ul>
<li><em>no ip proxy-arp</em></li>
</ul>
</li>
<li>disable service configuration
<ul>
<li><em>no service config</em></li>
</ul>
</li>
<li><em>no mop enabled</em></li>
<li><em>no service pad</em></li>
</ul>
<h1 id="snmpsimple-network-manage-protocol">SNMP(simple network manage protocol) </h1>
<p>SNMP是一种网络管理协议,用于管理网络设备,被管理的网络设备运行SNMP代理,维护自身的MIB数据库,MIB里有自身的变量信息.SNMP使用GET消息获取变量,SET消息修改变量.SNMP代理还可以主动使用Trap或Inform发起通知.Trap使用UDP,不可靠.Inform也使用UDP,但实现了可靠性.</p>
<p>SNMPv2c对于权限的管理使用了团体机制,分为RO(read only)和RW(read write)团体,只有RW团体可以发送SET消息.SNMPv3不使用团体,而使用组,每个组都有自己的安全等级和读写权限,默认都有读权限,写权限需要手动为组添加.组的用户的安全等级需要和组匹配.SNMPv3的通知需要单独为用户设置,通知的安全等级和用户的组应相同.</p>
<ul>
<li>SNMP需要使用access list限制来源.</li>
<li>SNMPv1 by default</li>
</ul>
<p>配置一般步骤:</p>
<ol>
<li>define the SNMP host or the NMS to send traps to</li>
<li>create an acl</li>
<li>define read-only</li>
<li>define read-write</li>
<li>define SNMP location</li>
<li>define SNMP contact</li>
</ol>
<h2 id="配置-34">配置 </h2>
<h3 id="snmpv2c">SNMPv2c </h3>
<p>配置模式:</p>
<ol>
<li>配置代理
<ol>
<li>snmp-server community <code>string</code> RO|RW [ipv6 <code>acl-name</code>] [<code>acl-name</code>]</li>
<li>(!可选)snmp-server location <code>location</code></li>
<li>(!可选)snmp-server contact <code>name</code></li>
</ol>
</li>
<li>配置通知
<ol>
<li>snmp-server host {<code>hostname</code>|<code>ip-address</code>} [inform] version 2c <code>notification-community</code></li>
<li>snmp-server enable traps [config] (!enable all traps)</li>
</ol>
</li>
</ol>
<h3 id="snmpv3">SNMPv3 </h3>
<ol>
<li>snmp-server group <code>groupname</code> v3 {noauth|auth|priv} [write v1default] [access [ipv6] <code>aclname</code>]
<ul>
<li>snmp-server user <code>username</code> <code>groupname</code> v3(!noauth的user)</li>
<li>snmp-server user <code>username</code> <code>groupname</code> v3 auth md5|sha <code>password</code>(!auth的user)</li>
<li>snmp-server user <code>username</code> <code>groupname</code> v3 priv des|3des|aes [128|192|256(!aes才需要)]<code>encryption-key</code>(!priv的user)</li>
</ul>
</li>
<li>snmp-server host {<code>hostname</code>|<code>ip-address</code>} [informs|traps(!默认)] version 3 {noauth|auth|priv} <code>username</code></li>
<li>snmp-server enable traps</li>
</ol>
<h1 id="ip-sla-and-span">IP SLA and SPAN </h1>
<h2 id="ip-sla">IP SLA </h2>
<p>IP SLA是测量和查看各种性能和可用性的指示器.比如定时发出一个ICMP Echo消息,记录是否收到响应可以对网络可达性记录.</p>
<h2 id="spanswitched-port-analyzer">SPAN(switched port analyzer) </h2>
<p>SPAN就像用于交换机上的wireshark.能将某个或某些接口上收到或发出的数据帧复制输出到某个端口作分析用.</p>
<ol>
<li>SPAN目的端口只能用于同一SPAN会话</li>
<li>目的不能作源</li>
<li>目的端口只会用于SPAN,不能像普通端口一样通信</li>
<li>不可以同时使用接口和vlan作源</li>
</ol>
<ul>
<li>local switched port analyzer</li>
<li>remote switched port analyzer(RSPAN):layer 2</li>
<li>encapsulated remote switched port analyzer(ERSPAN):layer 3</li>
</ul>
<h2 id="命令">命令 </h2>
<ol>
<li>IP sla
<ol>
<li>ip sla <code>operation-num</code>
<ol>
<li>icmp-echo {<code>destination-ip</code>|<code>destination-host-name</code>} [source-ip {<code>ip-address</code>|<code>hostname</code>}]
<ol>
<li>frequency <code>frequency</code></li>
</ol>
</li>
<li>或 http {get|raw} <code>url</code> [name-server <code>ip</code>] [version <code>version</code>] [source-ip {<code>ip</code>|<code>host</code>}] [source-port <code>port</code>] [cache {enable|disable}] [proxy <code>proxy-url</code>]</li>
</ol>
</li>
<li>ip sla schedule <code>operation-num</code> [life {forever|<code>seconds</code>}] [start-time {[<code>bb:mm:ss</code>] [<code>month day</code>|<code>day month</code>]| pending|now|after <code>bb:mm:ss</code>}] [ageout <code>seconds</code>] [recurring]</li>
</ol>
</li>
<li>
<ol>
<li>Local SPAN
<ul>
<li>monitor session <code>number</code> source {interface <code>type</code> <code>number</code> [- <code>last-in-range</code>] | vlan <code>vlan-id</code>} [rx|tx|both] (!定义SPAN源端口或vlan,r means received,t means sent)</li>
<li>monitor session <code>number</code> destination interface <code>interface-id</code> [encapsulation replicate] (!use <em>encapsulation replicate</em> to dupcicate like BUDUs,CDP,VTP,DTP and so on)</li>
<li>monitor session <code>number</code> destination interface <code>interface-id</code> ingress {dot1q vlan <code>vlan-id</code>|untagged vlan <code>vlan-id</code>} (!<em>dot1q</em> require the packets with specified VLAN ID)(!<em>untagged</em> keyword accept incoming packets and associate them to the specified VLAN ID)</li>
</ul>
</li>
<li>RSPAN
<ul>
<li>vlan <code>vlan-num</code>
<ul>
<li>name <code>name</code></li>
<li>remote-span</li>
</ul>
</li>
<li>monitor session <code>number</code> source {interface <code>type</code> <code>number</code> [- <code>last-in-range</code>] | vlan <code>vlan-id</code>} [rx|tx|both]</li>
<li>monitor session <code>number</code> destination remote vlan <code>vlan-num</code><br>
!or source use <em>remote vlan <code>vlan-num</code></em> and destination use interface</li>
</ul>
</li>
</ol>
<!-- - monitor session `number` destination interface `interface-id` [encapsulation 
{dot1q [ingress {dot1q vlan `vlan-id`|untagged vlan `vlan-id`|vlan `vlan-id`}] (!*dot1q* require the packets with specified VLAN ID)
|replicate [ingress {dot1q vlan `vlan-id`|untagged vlan `vlan-id`}] (!use *encapsulation replicate* to dupcicate like BUDUs,CDP,VTP,DTP and so on)
|ingress {dot1q vlan `vlan-id`|untagged vlan `vlan-id`|vlan `vlan-id`}(!*untagged* keyword accept incoming packets and associate them to the specified VLAN ID)
}] -->
<ol start="3">
<li>ERSPAN
<ul>
<li>monitor session <code>span-session-number</code> type erspan-source
<ul>
<li>description <code>string</code></li>
<li>source {interface <code>interface</code>|vlan <code>vlan-id</code>} [,|-|both|rx|tx]</li>
<li>filter {ip <code>acl</code>|ipv6 <code>acl</code>}|vlan <code>vlan-ID</code></li>
</ul>
</li>
</ul>
<!-- - monitor session `span-session-number` type erspan-destination -->
<ul>
<li>
<p>destination</p>
<ul>
<li>ip address <code>ip</code></li>
<li>erspan-id <code>erspan-id</code></li>
<li>origin ip address <code>address</code></li>
<li>exit</li>
</ul>
</li>
<li>
<p>exit</p>
</li>
<li>
<p>erspan ttl <code>ttl</code></p>
</li>
<li>
<p>monitor session <code>span-session-number</code> type erspan-destination</p>
<ul>
<li>destination {interface <code>interface</code>}</li>
<li>source
<ul>
<li>ip address <code>ip</code></li>
<li>erspan-id <code>erspan-id</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h2 id="排错-17">排错 </h2>
<ul>
<li>show ip sla application</li>
<li>show ip sla configuration</li>
<li>show monitor erspon-source session</li>
<li>show ip sla statistics <code>sla-num</code>(!显示统计数据)</li>
<li>show ip sla history [enhanced] <code>sla-num</code>(!显示历史状态)</li>
</ul>
<h1 id="aas-and-虚拟网络功能和服务">aas and 虚拟网络功能和服务 </h1>
<p>aaS(as a Service,云服务)有五个方面:</p>
<ol>
<li>按需自助服务</li>
<li>多种网络访问</li>
<li>资源池</li>
<li>快速恢复能力:客户可以快速申请资源</li>
<li>测量的服务<br>
有三种类型:IaaS(架构即服务,比如云服务器),SaaS(软件即服务,比如网盘),PaaS(开发平台即服务,包含开发工具的云服务器??)<br>
访问云服务从网络的角度有五种方式:<br>
互联网云交换是由云服务提供商与客户中间新增一个互联网云交换公司负责云服务的连接</li>
</ol>
<table>
<thead>
<tr>
<th></th>
<th>安全性</th>
<th>QoS</th>
<th>容量规划???</th>
<th>是否方便迁移</th>
<th>快速使用公有云</th>
</tr>
</thead>
<tbody>
<tr>
<td>Internet</td>
<td>无</td>
<td>无</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>Internet VPN</td>
<td>有</td>
<td>无</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>MPLS VPN</td>
<td>有</td>
<td>有</td>
<td>是</td>
<td>否</td>
<td>否</td>
</tr>
<tr>
<td>以太网私有WAN</td>
<td>有</td>
<td>有</td>
<td>是</td>
<td>否</td>
<td>否</td>
</tr>
<tr>
<td>互联云交换</td>
<td>有</td>
<td>有</td>
<td>是</td>
<td>是</td>
<td>否</td>
</tr>
</tbody>
</table>
<p>在云服务中,可以使用虚拟的路由器和防火墙,称为VNF.<br>
把应用迁移到云服务时,需要修改DNS,DHCP和NTP</p>
<h1 id="sdn">SDN </h1>
<ul>
<li>数据平面(data plane):也被称为转发平面,意思是为转发消息所作的工作, 主要是对各种表的查询匹配,是在ASIC芯片上进行的</li>
<li>控制平面:对数据平面的控制行为,主要是创建修改各种表</li>
<li>管理平面:telnet或ssh之类让网络工程师对设备进行管理的协议<br>
传统的控制平面是分布式的,SDN则是集中式的,管理平面自然也是集中式的.SDN中控制平面被集中到了控制器.控制器有南向接口和北向接口.南向接口负责与数据平面设备通信,北向接口与管理平面或其他程序通信,比如集中式的OSPF.</li>
</ul>
 <!-- | 条件 | 开放SDN | ACI | APIC-EM |-->  
<h2 id="virtualization">virtualization </h2>
<ul>
<li>VM(virtual machine):emulation of a physical server with an operating system.
<ul>
<li>Type 1:hypervisor directly runs on the system hardware(refered as bare metal or native)</li>
<li>Type 2:hypervisor requires a host OS.</li>
</ul>
</li>
<li>container:isolated environment for an application(without the operating system).</li>
<li>vSwitch(virtual switch):sofware-based Layer 2 switch.cannot share the same pNIC(physical network interface cards).
<ul>
<li>too slow in IO for too many interrupts with an OVS(open vSiwtch)</li>
</ul>
</li>
<li>NFV(network function virtualization):architectual framework that defines standards to create VNF</li>
<li>VNF(virtual network function):virtual of software version of an NF</li>
</ul>
<h3 id="io-technologies">IO technologies </h3>
<p>to overcome the performance impact on throughtput due to interrupts:</p>
<ul>
<li>OVS-DPDK:receive data from user space bypassing the kernel
<ul>
<li>require one or more CPU dedicated in OVS</li>
</ul>
</li>
<li>PCI passthrough:bind one pNIC to a single VNF,bypassing the kernel and directly  getting to the VNF.
<ul>
<li>entire pNIC with only one VNF</li>
</ul>
</li>
<li>SR-IOV(Single-root I/O virtualization):enhanced PCI that allow multiple VNFs to share one pNIC.
<ul>
<li>one PF(physical function) map multiple VFs(virtual functions)</li>
<li>has two modes:
<ul>
<li>VEB(virtual ethernet switch):VNF attached to the same pNIC is switched by the pNIC</li>
<li>VEPA(virtual ethernet port aggregator):VNF attached to the same pNIC is switched by an external switch</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="enfvcisco-enterprise-nfv">ENFV(cisco enterprise NFV) </h3>
<p>running required functions as VNFs on x86-based hosts.consists of</p>
<ul>
<li>MANO(management and orchestration):DNA provides management and orchestration
<ul>
<li>design,provision,manage and monitor</li>
</ul>
</li>
<li>VNFs</li>
<li>NFVIs(network functions vitualization infrastrcture):an operating system that provides vitualization capabilities and facilitates
<ul>
<li>be based on standard linux packaged with additional functions</li>
<li>components:
<ul>
<li>linux</li>
<li>hypervisor:based on KVM and includes QEMU</li>
<li>vswitch:OSV</li>
<li>vm lifecycle management</li>
<li>plug and play client</li>
<li>orchestration</li>
<li>HTTPS web server</li>
<li>device management</li>
<li>RBAC(role-based access control)</li>
</ul>
</li>
</ul>
</li>
<li>hardware resources</li>
</ul>
<h1 id="杂项">杂项 </h1>
<h2 id="tcamternary-content-addressable-memory">TCAM(ternary content addressable memory) </h2>
<ul>
<li>belong to switch</li>
<li>extension of CAM</li>
<li>allow for Layer 2/3 source/destination addresses.protocol,QoS marking and so on</li>
</ul>
<h2 id="traceroute">traceroute </h2>
<p>在 <code>traceroute</code> 命令的输出中，各种标志表示不同的网络错误或状态。以下是常见的标志及其含义：</p>
<ol>
<li>
<p><strong><code>!A</code></strong> - <strong>Communication Administratively Prohibited</strong>:</p>
<ul>
<li>表示通信被管理策略禁止。通常由防火墙或路由器的安全策略阻止。</li>
</ul>
</li>
<li>
<p><strong><code>!H</code></strong> - <strong>Host Unreachable</strong>:</p>
<ul>
<li>目标主机不可达。通常是由于目标主机关闭或网络配置错误引起的。</li>
</ul>
</li>
<li>
<p><strong><code>!N</code></strong> - <strong>Network Unreachable</strong>:</p>
<ul>
<li>目标网络不可达。通常表示路由器找不到目标网络的路由条目。</li>
</ul>
</li>
<li>
<p><strong><code>!P</code></strong> - <strong>Protocol Unreachable</strong>:</p>
<ul>
<li>协议不可达。目标主机不支持或没有启用指定的协议。</li>
</ul>
</li>
<li>
<p><strong><code>!F</code></strong> - <strong>Fragmentation Needed and Don't Fragment was Set</strong>:</p>
<ul>
<li>数据包需要分片，但设置了禁止分片标志。通常是由于数据包太大且中间路由器无法处理导致的。</li>
</ul>
</li>
<li>
<p><strong><code>!S</code></strong> - <strong>Source Route Failed</strong>:</p>
<ul>
<li>源路由失败。通常表示数据包的源路由选项无效或被中间设备拒绝。</li>
</ul>
</li>
<li>
<p><strong><code>!X</code></strong> - <strong>Communication Administratively Prohibited</strong>:</p>
<ul>
<li>与 <code>!A</code> 类似，表示通信被管理策略禁止。通常由防火墙或路由器的安全策略阻止。</li>
</ul>
</li>
<li>
<p><strong><code>!V</code></strong> - <strong>Host Precedence Violation</strong>:</p>
<ul>
<li>主机优先级违规。表示数据包的优先级设置不符合网络的优先级策略。</li>
</ul>
</li>
<li>
<p><strong><code>!C</code></strong> - <strong>Precedence Cutoff in Effect</strong>:</p>
<ul>
<li>优先级截断生效。表示数据包的优先级被降低，通常由于网络设备配置的优先级策略。</li>
</ul>
</li>
</ol>
<p>这些标志帮助网络管理员快速诊断网络路径中的问题，并采取相应的措施来解决网络连接问题。了解这些标志的含义有助于更有效地排查网络故障。</p>
<h2 id="bfd">BFD </h2>
<p>可以更快的检测邻居可达性是否正常.</p>
<h3 id="配置-35">配置 </h3>
<p>在router进程中:<br>
bfd interface <code>interface</code><br>
接口中:</p>
<ul>
<li>bfd interval <code>50-999</code> min_rx <code>1-999</code> multiplier <code>3-50</code></li>
</ul>
<h2 id="automation">Automation </h2>
<ol>
<li>
<p>EEM(Embedded Event Manager):cisco tool</p>
<ol>
<li>if <code>event</code> then `action'</li>
<li>configuration
<ol>
<li>event manager applet <code>name</code></li>
<li>event <code>event</code></li>
<li>action <code>num</code> cli command <code>command</code><br>
example:</li>
</ol>
</li>
</ol>
<pre data-role="codeBlock" data-info="eem" class="language-eem eem"><code>event manager applet LOOP0
   event syslog pattern "Interface Loopback0.* down" period 1
   action 1.0 cli command "enable"
</code></pre></li>
<li>
<p>agent-based automation tools</p>
<ol>
<li>puppet</li>
<li>chef</li>
<li>saltstack(agent and server mode)</li>
</ol>
</li>
<li>
<p>agentless automation tools</p>
<ol>
<li>ansible</li>
<li>puppet bolt</li>
<li>saltstack ssh(server-only mode)</li>
</ol>
</li>
</ol>
<p>Ansible pushes the configuration to the client. Chef client pulls the configuration from the server</p>
<table>
<thead>
<tr>
<th>factor</th>
<th>puppet</th>
<th>chef</th>
<th>ansible</th>
<th>saltstack</th>
</tr>
</thead>
<tbody>
<tr>
<td>architecture</td>
<td>server and agents</td>
<td>server and clients</td>
<td>control station and remote hosts</td>
<td>salt master and minions</td>
</tr>
<tr>
<td>language</td>
<td>puppet dsl</td>
<td>ruby dsl</td>
<td>yaml</td>
<td>yaml</td>
</tr>
<tr>
<td>terminology</td>
<td>modules and manifests</td>
<td>cookbooks and recipes</td>
<td>playbooks and plays</td>
<td>pillars and grains</td>
</tr>
<tr>
<td>large-scale deployment</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td>agentless</td>
<td>puppet bolt</td>
<td>N/A</td>
<td>yes</td>
<td>salt ssh</td>
</tr>
<tr>
<td>model</td>
<td>pull</td>
<td>pull</td>
<td>push</td>
<td>push</td>
</tr>
<tr>
<td></td>
<td>declaritive</td>
<td>procedural</td>
<td>procedural</td>
<td>declaritive</td>
</tr>
</tbody>
</table>
<h3 id="guestshell">guestshell </h3>
<p>Guestshell is a virtualized Linux-based environment, designed to run custom Linux applications, including Python</p>
<h4 id="configuration-3">configuration </h4>
<ol>
<li>iox</li>
<li>guestshell enable [VirtualPortGroup <code>port-number</code> guest-ip <code>ip-address</code> gateway <code>gateway-ip</code> netmask <code>netmask</code> [name-server <code>ip-address</code>]]</li>
</ol>
<h4 id="use">use </h4>
<ol>
<li>guest run <code>command</code></li>
</ol>
<h2 id="urpf">uRPF </h2>
<p>限制和消除ip欺骗包.基于cef.</p>
<ul>
<li>严格:查看ip数据包源ip地址与路由表中到达该地址的接口,是否和接受该数据包的接口相同.且不是默认路由.</li>
<li>松散:查看路由表是否有到达源ip地址的接口</li>
<li>vrf:vrf中的松散模式.<br>
ip verify unicast source reachable-via {rx|any} [allow-default] [allow-self-ping] [<code>acl</code>]</li>
</ul>
<p>通常在包含终端的子网中使用严格模式,在上行链路使用松散模式.</p>
<h1 id="dev">dev </h1>
<table>
<thead>
<tr>
<th>HTTP</th>
<th>ACTION</th>
<th>USE CASE</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td></td>
<td></td>
</tr>
<tr>
<td>POST</td>
<td></td>
<td>login authentication</td>
</tr>
<tr>
<td>PUT</td>
<td></td>
<td>update</td>
</tr>
<tr>
<td>PATCH</td>
<td></td>
<td>appending data</td>
</tr>
<tr>
<td>DELETE</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>HTTP STATUS CODE</th>
<th>RESULT</th>
<th>COMMON REASON</th>
</tr>
</thead>
<tbody>
<tr>
<td>200</td>
<td></td>
<td></td>
</tr>
<tr>
<td>201</td>
<td></td>
<td></td>
</tr>
<tr>
<td>400</td>
<td>bad request</td>
<td>client-side issue</td>
</tr>
<tr>
<td>401</td>
<td>unauthenrized</td>
<td></td>
</tr>
<tr>
<td>403</td>
<td>forbidden</td>
<td></td>
</tr>
<tr>
<td>404</td>
<td>not found</td>
<td></td>
</tr>
</tbody>
</table>
<div class="mermaid">flowchart TB
applications&lt;--northbound API--&gt;controller
controller&lt;--southbound API--&gt;a["data plane"]
</div><p>Southbound API is based on NETCONF and XML,Northbound API is RESTful using JSON</p>
<h2 id="data-model">data model </h2>
<h3 id="yang">YANG </h3>
<p>YANG is a standard for data definition language using data models.Data models are used to describe whatever can be configured on a device.</p>
<h3 id="netconf">NETCONF </h3>
<p>SNMP can't distinguish between configuration data and operational data,but NETCONF can.</p>
<ul>
<li>get</li>
<li>get-config</li>
<li>edit-config</li>
<li>copy-config</li>
<li>delete-config</li>
</ul>
<h3 id="restconf">RESTCONF </h3>
<p>use YANG and NETCONF to provide RESTful api.<br>
Allow: DELETE, GET, HEAD, PATCH, POST, PUT, OPTIONS</p>
<ul>
<li>GET</li>
<li>POST</li>
<li>PUT</li>
<li>DELETE</li>
<li>OPTIONS</li>
</ul>

      </div>
      
      
    
    
    <script type="module">
// TODO: If ZenUML gets integrated into mermaid in the future,
//      we can remove the following lines.


var MERMAID_CONFIG = ({"startOnLoad":false});
if (typeof MERMAID_CONFIG !== 'undefined') {
  MERMAID_CONFIG.startOnLoad = false
  MERMAID_CONFIG.cloneCssStyles = false
  MERMAID_CONFIG.theme = "default"
}

mermaid.initialize(MERMAID_CONFIG || {})
if (typeof(window['Reveal']) !== 'undefined') {
  function mermaidRevealHelper(event) {
    var currentSlide = event.currentSlide
    var diagrams = currentSlide.querySelectorAll('.mermaid')
    for (var i = 0; i < diagrams.length; i++) {
      var diagram = diagrams[i]
      if (!diagram.hasAttribute('data-processed')) {
        mermaid.init(null, diagram, ()=> {
          Reveal.slide(event.indexh, event.indexv)
        })
      }
    }
  }
  Reveal.addEventListener('slidetransitionend', mermaidRevealHelper)
  Reveal.addEventListener('ready', mermaidRevealHelper)
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
} else {
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
}
</script>
    
    
    
  
    </body></html>