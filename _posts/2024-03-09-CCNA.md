---
layout: page
title: CCNA学习笔记
tags: network
categories: study
---

[TOC]

# TCP/IP and OSI
1. 应用层
   1. 应用层:HTTP,DNS等
   2. 表示层
   3. 会话层
2. 传输层-transport:TCP,UDP.提供一个基于ip的可靠传输协议TCP和努力交付的UDP
3. 网络层-network:IP.实现对数据来源去向的定位和路由
4. 数据链路
   1. 数据链路层:Ethernet,HDLC.实现对数据的基本的帧控制,差错校验等,使用MAC地址定位.
   2. 物理层:Ethernet.完成从物理设备模拟信号到数字信号的变换.
不同设备之间same-layer interaction(相同层交互),同一设备上adjacent-layer interaction(不同层交互).较底层为较高层提供服务,自底层向高层封装数据包,高层自底层解封数据包.数据段(segmen)对应传输层,数据包(packet)对应网络层,帧(frame)对应链路层.
## arp
连接网络层和数据链路层的协议,提供根据ip查询MAC地址的服务.

# CLI相关
IOS的命令行界面称为CLI.CLI有三种模式,用户模式,EXEC(也叫特权)模式,配置模式(分为很多种不同的配置模式),接口模式(配置模式的一种,但我觉得比较特别).刚进入时,为用户模式,使用enable指令进入EXEC模式,EXEC模式通常是使用各种show命令查看设备信息.EXEC模式下使用configure terminal进入全局配置模式,全局配置模式下可使用各种配置命令进入不同的子项配置模式,也可以使用interface指令单独配置某一接口.在配置模式中要使用show命令可以使用do show

交换机有三种连接方式,console口,Telnet和ssh.Telnet明文传输信息,不安全.要想使用ssh连接,需要给设备配置ip地址,一般在vlan接口处配置,也可以使用DHCP自动获取.
## 配置密码
配置模式(默认全局配置模式):
- 共享密码
  1. enable secret `password-value`(!特权模式密码)
  2. line console 0
  3. login
  4. password `password-value2`(!console线密码)
  5. exit
  6. line vty 0 15(!编号0-15)(!进入vty线路模式)
  7. login
  8. password `password-value3`(!telnet登入密码)
- 用户名密码对
  1. username `name` secret `password`
  2. line con 0
  3. login loacl
  4. (!可选)no password(!删除共享密码)
  5. exit
  6. line vty 0 15
  7. login local
  8. (!可选)no password(!删除共享密码)

## 配置ssh
配置模式:
1. hostname `name`
2. ip domain-name `domain-name`
3. crypto key generate rsa(!生成rsa公私钥)(!sshv2至少需要768位密钥)
4. (!可选)ip ssh version 2

(!可选)vty模式:
- transport input {all|none(!默认值)|telnet|ssh}
## aaa
aaa服务器会集中保护交换机和路由器的用户名/密码对,aaa服务器可以是一个或多个服务器组成的服务器,aaa服务器会对启用了802.1x的认证方传来的消息认证.CCNA考试只要求能够描述

如果使用aaa,802.1x需要在局域网的所有设备上开启,使用EAP(类似UDP)进行通信.802.1x一般需要在连接终端用户的接口上启用.
### aaa配置
配置模式:
1. aaa new-model
2. tacacs server `server-name`
3. address ipv4 `address`
4. key `key`
5. port `port`
6. aaa authentication default `method1` `method2`(!medthod={`group-name|server-name`|local(!本地用户名认证)|login(!密码认证)})
## log
日志消息默认发送给通过console方式连接的用户,日志有不同的严重等级,0~7严重等级依次递减.等级7代表debug消息.debug是和show类似的有大量可选项的命令,但很消耗计算资源,在实际生产中小心或避免使用.
### 配置
配置模式:
- logging monitor(!在IOS中启用向终端发送日志的功能)
- terminal monitor EXEC(!终端中使用表示希望接收日志)
## NTP
网络设备需要使用NTP(网络时间协议)来进行时钟的同步,NTP协议中,设备分为服务端和客户端,客户端接收服务端的时钟信息并修改自身时钟,设备可以同时充当服务端和客户端.存在多个服务端时,优先级级别低者优先设备时间设置为接近的时间,再进行NTP的配置,效果更好.
### 配置
- 时间
   配置模式:
  - clock timezone EST(!可以是任何值,但最好有意义.EST美国东部时间) `offset`(!常数,意为相比UTC(!世界协调时)多offset小时,可以为负数)
  - clock summer-time EDT(同EST) recurring

   EXEC:
  - clock set 20:59:49(!时:分:秒) October(!月) 2020(!年)
- NTP
   配置模式:
  - (!客户端)ntp server {`ip`|`hostname`}
  - (!服务端)ntp master `priority`(!越低越优先)
  - (!可选)ntp source `interface`(!指定NTP服务器用于发送和接收NTP时间同步信息的网络接口,最好使用环回接口)
### 环回接口
环回接口不是ip地址中的127.0.0.1环回接口,是IOS中可以创建的虚拟接口,可以分配ip并被路由,并且总是up/up状态,不能shutdown.
#### 配置
配置模式:
- interface loopback `num`(!任意整数)
- (!之后可以和普通接口一样进行配置)

# IPv4 and IPv6
ip地址用于定位,通过路由实现.路由是查找路由表,最长前缀优先的过程.
## ip地址
无子网掩码时使用网络类别,不然ip地址与(逻辑加)子网掩码为子网网络地址.
### 网络类别
- A:0.0.0.0 到 127.255.255.255 (0.0.0.0 用于表示当前主机，而 127.0.0.0 子网是用于本地回环测试的回环地址).10.0.0.0子网作为私有地址
- B:128.0.0.0 到 191.255.255.255,172.16.0.0 ~ 172.31.0.0作为私有地址
- C:192.0.0.0 到 223.255.255.255,192.168.0.0 ~ 192.168.255.255作为私有地址
## 子网掩码
魔法数字=256-非255非0掩码
#### 子网ID
魔法数字倍数中最接近并小于IP地址的一项(从0开始)
#### 子网广播地址
子网ID+魔法数字-1

## IPv6
- icmp升级为icmpv6,NDP(邻居发现协议)(Neighbor Discovery Protocol)代替ARP.
  NDP有发现路由器,发现地址信息.路由器会被要求(RS)通告(RA)自己的信息,主机通过这两种消息获取路由器信息;NS(邻居请求)和NA(邻居通告)如同arp,要求某个ipv6主机回答MAC地址,并且可以利用其检查出重复地址,这个过程叫DAD.
- 主要是ipv6的缩写形式./64是默认的前缀.
- 动态获取地址的方式除了DHCPv6之外多了SLAAC.
  当一台主机使用SLAAC时,它需要使用NDP RS/RA消息从路由器获知ipv6前缀,然后使用EUI-64或随机生成后缀,再使用DAD确保这个地址没有被使用.NDP提供了地址前缀,前缀长度,和默认路由器的信息,最后使用无状态DHCPv6提供DNS服务器即完成了主机的网络设置.
- 路由器不是默认开启ipv6的,需要手动开启.
- 多了任播地址,几台执行相同功能的设备可以使用相同的ipv6地址.路由器只需选择离自己最近的.


|地址类型|前几位16进制数|
|---|---|
|全局单播|2或3|
|本地唯一|FD|
|多播|EF|
|本地链路|FE80|

### 配置
配置模式:
- ipv6 unicast-routing
接口模式:
- ipv6 address `address`/`prefix-length` 

## DHCP
DHCP(dynamic host configuration protocol 动态主机配置协议)是用于自动配置ip,掩码,网关,dns的协议.DHCP设备分为3中,客户端,中继端和服务端.建议DHCP采用集中式设计,需要DHCP服务器的子网使用中继,更好控制和配置所能分配的ip地址.

客户端使用0.0.0.0作为源ip地址,255.255.255.255发送Discover(发现)消息,服务端会回复一个Offer(提供)消息通告可以分配的地址和其他参数.客户端收到Offer后会发送Request(请求)消息请求ip地址,如果能够分配,服务端会回复Acknowledge(确认)消息,分配ip,掩码,默认路由器,dns等.

中继会不断接收客户端信息并将源ip改为自己的ip,路由数据包到服务端.

服务端有三种分配模式,动态分配(可用ip作为一个池,不断租用ip给客户端),自动分配(租用时间为无限)和静态分配(根据mac地址分配ip,已被分配ip不会再被分配).

### ipv6
在ipv6中,DHCP升级为DHCPv6,不再为主机通告默认路由器,默认路由器由主机使用NDP协议发现.
### 配置
- 中继
  配置模式:
  1. ip helper-address `server-ip`
- 服务端
   配置模式:
   1. ip dhcp excluded-address `first` `last`(!排除掉的地址)
   2. ip dhcp pool `name`(!进入dhcp池配置模式)
   3. network `subnet-id` {`mask`|`prefix-length`}(!池中子网)
   4. default-router `address1` `address2`(!默认路由器)
   5. dns-server `address1` `address2`(!默认dns服务器)
   <!-- 6. (!可选)lease `days` `hours` `minutes`(设置ip租期)
   7. (!可选)domain-name `name`
   8. (!可选)nest-server `ipaddress`(TFTP服务器地址) -->
### DHCP snooping
DHCP有可能会被欺骗攻击,可以使用DHCP snooping.会将信任端口(手动配置)的所有dhcp消息放行,不信任(终端)端口的DHCP服务器消息(OFFER和ACK)过滤,客户端消息经过DHCP绑定表判定,判定成功继续填充表.
#### 配置
(!无)
## NAT
私有地址在网络中不被路由,无法定位.使用NAT技术,可以在子网内使用私有地址定位,需要连接到Internet时,将私有地址转换为可路由的单播地址.具体来说,是将ip数据报中的源修改为单播地址,PAT还会修改端口号,此时路由器还需要记住这个映射关系.思科将这个私有地址称为Inside Local(内部本地),这个单播地址称为Inside Global(内部全局).当内部全局地址耗尽时,路由器会丢弃无法进行地址转换的包.ACL会在转换前匹配.

NAT分为三种,静态NAT,动态NAT和PAT(NAT重载).

静态NAT只是单纯的为内部本地地址和内部全局地址做了映射,并且每一个映射需要手动配置.

动态NAT有一个可使用的内部全局地址池,自动完成内部本地到全局的映射,设置有分配超时时间.比静态映射稍微好一点点,所需要的内部全局地址数约等于内部本地同时访问Internet的数量.

PAT基于TCP和UDP有65535个端口,其中真正被使用的很少,所以可以通过对ip+端口同时建立动态映射来达到少量内部全局地址支持大量内部本地地址同时访问Internet.

### 配置
接口模式(设置nat内部和外部接口,所有NAT都需要):
  - ip nat inside
  - ip nat outside 
- 静态NAT
   - ip nat inside source static `inside-local` `inside-golbal`
- 动态NAT
  - ip nat pool `pool-name` `first-address` `last-address` netmask `submask-mask`
  - ip nat inside source list `acl-number` pool `pool-name`
- PAT
  - ip nat inside source list `acl-number` {pool `pool-name`|interface `type/number` overload}
## IGP(RIPv2, OSPF, EIGRP) and EGP(eBGP) 
路由器之间学习路由,通告路由,选择路由,收敛路由的协议.

路由协议分为内部网关协议(IGP,适用于自洽系统(AS)内部)和外部网关协议(EGP,适用于不同自洽系统之间)
对于IGP,路由协议算法分为三大类:
- 距离矢量型(例如:RIP的跳数)
- 高级距离矢量型(EIGRP)
- 链路状态型(OSPF)

对于EGP,BGP是不二之选了.
### RIPv2
RIP使用跳数作为衡量路由优劣的距离矢量,每经过一个路由器,跳数加1.RIP基于一个短时间定时器定期向邻居发送路由信息,路由信息会被拆分,只会发送路由表中目的接口对应的不是发送目的邻居的信息.当出现路由环回时,两个路由器不停交换路由,使跳数等于16时,该路由被弃用,称为路由中毒.
#### 配置
配置模式:
1. router rip
2. version 2
3. network `net-number`
4. (!可选)passive-interface(!被动模式,不发出路由更新消息)
5. (!可选)maximum-paths `number`(负载均衡)
6. default-information originate(RIP的默认路由通告)
### OSPF
每个使用OSPF的路由器有自己的LSDB(链路状态数据库),里面保存了LSA,路由器需要将自己创建的LSA泛洪给OSPF邻居,直到每台路由器的LSDB完全相同.之后使用Dijkstra(最短路径优先)算法处理LSDB并创建条目添加到路由表.

OSPF在以太网中,由于以太网通常是广播网络,所以OSPF的泛洪特性可能导致网络堵塞.所以OSPF在以太网中需要选择DR(指定路由器)和BDR(备用指定路由器).以太网中只有DR会和其他DROther(非DR非BDR的路由器)交换LSDB.

OSPF只会在OSPF区域内生效.一般来说,一个区域内路由器数量<=50.骨干区域内部的路由信息会在整个骨干区域中洪泛,这意味着骨干区域内的所有路由器都会收到来自其他路由器的路由更新

OSPF邻居:路由器会向处于up的接口发送OSPF hello消息,消息中包含自己的RID,两个路由器互相知道RID时,成为2-way状态,这时他们互为邻居.

泛洪:邻居之间互相通告LSA列表,并请求自己列表中没有的LSA.

#### OSPF区域设计原则
- 所有同子网的接口在同一区域
- 区域内连续
- 接入层某一部分路由器所有接口在某一区域,核心层路由器所有接口在同一区域,分布层则需要一部分属于前者区域,一部分属于后者区域
- 所有区域(包括普通区域和骨干区域)都必须直接或间接地连接到骨干区域(Area 0)
#### 配置
配置模式:
1. router ospf `process-id`(ospf进程id)
2. (!可选) interface loopback `number`,ip `address` `mask`
3. network `ip-address` `wildcard-mask` area `area-id`(`wildcard-mask`:例如255.255.255.255,匹配所有接口,0.255.255.255,匹配所有ip第一位为`ip-address`第一位的接口,0.0.0.0精确匹配ip对应的接口)

4. (!可选) default-information originate(通告静态路由)
5. (带宽大于10M时,必须进行此设置)auto-cost reference-bandwidth 10000(10000意味着带宽最大为10G(10000M)内正确计算开销值)
6. maximum-paths `number`(设置同一网络的路由负载均衡)

接口模式:
- passive-interface `type` `number`(配置为被动接口,不会被发现为邻居)
OSPFv2时
- 可以使用ip ospf `process-id` area `area-id` 代替network `ip-address` `wildcard-mask` area `area-id`
- ip ospf cost `x`(直接设置开销值) 

#### ipv6
支持ipv4,ipv6双栈的ospf协议是ospfv3协议家族.ospfv3在运行时为ipv4和ipv6使用的是不同的LSDB,不同的SPF计算过程,不同的邻居关系和不同的OSPF消息.v2和v3很相似,最大的区别是内部机制.
##### 配置
配置模式:
- ipv6 router ospf `process-id`

接口模式:
- ipv6 ospf `process-id` area `area-number`
- (!可选) ipv6 ospf cost `x`

### EIGRP
EIGRP也会建立邻居关系,交换路由信息,计算最佳路由,并且完成路由的收敛.

EIGRP会尝试与另一个使用EIGRP的路由器建立邻居关系,需要认证匹配(如果有认证),并且处于同一自洽系统号(类似OSPF的区域),然后使用名为RTP(可靠传输协议)的协议发送路由更新,一般来说,第一次是完整的路由更新,之后会是部分路由更新.

EIGRP的度量值使用链路的最小带宽和累计延迟做参数,最小带宽和延迟会由通告的消息和自身设备权衡后得出.IOS不会根据物理带宽去计算,所以需要广域网链路的带宽需要手动设置,局域网可以默认,效果比较好.

自身对某一特定子网的度量值叫做FD(可行距离),而可以到达该子网的邻居报告的度量值称为RD,当RD小于FD时,报告RD的邻居即为该子网的可行后继路由.当没有可行后继时,会通过DUAL(弥散更新算法)查询那些不是可行后继路由的邻居是否可行.

`这个方法很巧妙,无论最简单的环还是复杂的环,其本质也是通过某个节点通过某种路径指向了自身,而FD相当于RD+自身,此处的+可以理解为加上了自身端口的延迟和开销.`
### 配置
配置模式:
1. router eigrp `as-number`(自洽系统号)
2. network `ip-address` {`wildcard-mask`|}(留空时默认网络类级别掩码,其他和OSPF相同)
3. (!可选)eigrp router-id `value` 设置EIGRP路由器ID
4. (!可选)maximum-paths `number`(设置等价开销路由数)
5. (!可选)variance `multiplier`(设置等价开销路由距离容忍倍数,例如RD<最佳RD*multiplier的可行会加入负载均衡中)
6. (!可选)auto-summary(ipv4中自动路由汇总)(实际网络中,大多不使用)

### BGP
BGP是可以在企业内,企业与ISP之间,以及ISP之间交换路由的路由协议.

BGP对于iBGP(内部BGP)和eBGP(外部BGP)的行为不同.

BGP通告对等体(peer)或者说邻居的是前缀(prefix)或网络层可达信息(NLRI),对于每个前缀,会有很多路径属性判断路径优劣.根据路径属性进行约10项比较得到最佳路由选择.
#### 丢弃路由
ISP通常希望学习整个公共地址块的路由信息,而不包含这个地址块内部的详细子网划分和路由.此时可以在BGP的路由器上设置丢弃路由.丢弃路由目的为整个地址块,而接口为空,意为丢弃.由于理论上该地址块各级子网都有前缀更长的路由,所以对实际路由无影响.但可以解决BGP通告的问题.
##### 配置
配置模式:
ip route `ip` `mask` null0
#### 配置
配置模式:
1. router bgp `asn`(企业或ISP的AS号)
2. bgp `peer-ip-address` remote-as `asn`(定义邻居的ip和ASN)
3. network `prefix` {mask `DDN-mask`|}(留空时默认网络类级别掩码)(DDN-mask与wildcard-mask相反,例如,255.255.255.255为精确匹配)(network添加的子网必须在路由表中存在)
### 排错

## FHRP
对第一跳路由增加冗余设计的协议,即有多个任务相同的路由器使用同一个ip地址,也可用于负载均衡.FHRP协议族包括HSRP,VRRP,GLBP.在HSRP中,优先级更高的路由器会成为活跃路由器,其他称为备份路由器.备份路由器会将自己的数据包路由到活跃路由器.当需要负载均衡时,可以让不同子网中的活跃路由器不同.如果没有设置抢占机制,当子网中已有一个活跃路由器时,新设置的路由器即使优先级更高也不会成为活跃路由器.
### 配置
接口模式:
1. standby version 2(!版本需要相同)
2. standby `group` ip `virtual-ip`(!VIP)
3. (!可选)standby `group` priority `num`
4. (!可选)standby `group` name `name`
5. standby preempt(!抢占机制,默认no standby preempt)

### 排错
|场景|路由器都活跃?|重复ip?|根据活跃路由器改变VIP|
|---|---|---|---|
|HSRP版本不匹配|是|是|N/A|
|HSRP组号码不匹配|是|是|N/A|
|ACL阻塞HSRP数据包|是|否|N/A|
|VIP不同|否|N/A|是|


# STP, RSTP(rapid) and PVST
在设计Ethernet网络时,冗余是必要的.但二层的冗余可能导致产生环回,STP可以通过自动禁用某些端口解决环回问题.
## 原理
将拓扑结构中的图消去环变成树.

- 根开销:去往根交换机的开销总和,一台交换机hello消息中只有一个最小根开销,但各个端口的根开销不同
- 选举根网桥:BID值最小者,相等时mac地址最小者
- 选举根端口(RP):去往根交换机的开销值最小
- 选举指定端口(DP):局域网中非根网桥开销最小的非RP的端口

## 特性
### 1. EtherChannel
多个物理链路视为同一逻辑链路,在逻辑链路上某一链路出问题时不需要STP收敛.也可用于负载均衡
### 2. PortFast
让端口从阻塞立刻过渡到转发状态,适用于与终端设备相连的接口
### 1. BPDU
未收到BPDU信息时,将端口禁用,保护stp安全

## 配置
配置模式:
- STP
  - spanning-tree mode {pvst|rapid-pvst|mst}
  - spanning-tree vlan `vlan-id` priority {`x`|root primary|root secondary}(!x mod 4096 === 0)
  - spanning-tree vlan `vlan-id` cost`x`

接口模式:
- EtherChannel
   channel-group `number` mode {on(!另一端只能为on)|desirable(!另一端可以为auto)|activate(!另一端可以为passive)}
- PortFast
   spanning-tree portfast
- BPDU
   spanning-tree bpduguard enable
## 排错
见LAN排错

# LAN, VLAN and VTP
## LAN
几台pc通过一台交换机连接时,组成一个LAN.它们同属一个广播域(发送的所有消息会被所有同一广播域的设备接收).现在的各种链路都使用的是Ethernet(以太网标准).Ethernet规定了物理层和数据链路层的行为和标准,lan中定位使用MAC地址.
### 电缆引脚
相同:交叉电缆
不同:直连电缆

| 1,2    | 3,6    |
| ------ | ------ |
| PC网卡 | 集线器 |
| 路由器 | 交换机 |
| AP     |        |
## VLAN
交换机默认广播域为所有接口,可以通过设置vlan将特定某几个接口组成独立的广播域.
默认所有接口属于vlan 1.
正常范围1~1005,所有交换机可以正常使用,拓展范围1006~4094
### 语音vlan:  
interface FastEthernet0/1
switchport access vlan 1
switchport voice vlan 1
### trunk
设置两台交换机的接口为trunk,可以只用一条链路充当多个vlan之间的链路,可以使用DTP(Dynamic Trunking Protocol)协商  
#### 配置 
接口模式:
1. switchport mode {trunk|dynamic desirable(主动协商)|dynamic desirable auto(被动允许)}
2. switchport trunk encapsulation {dot1q|negotiate}

配置模式:
vlan `vlan-id`
## VTP
通告vlan配置的协议,每一次修改会增加vlan配置数据库的版本并同步到整个vtp域中.客户端不能对vlan配置

vtp修剪:trunk目的接口的所有vlan中没有某些vlan接口时过滤掉对应的vlan通告

## 交换机堆栈和机框汇聚
### 堆栈
将多台交换机使用堆栈接口(stacking port)通过FlexStack(-plus)组成一个逻辑交换机,一般用在接入层
### 机框汇聚(chassis aggregation)
使用以太网接口汇聚交换机,组成一个逻辑交换机,多用在分布层和核心层

## 配置
配置模式:
1. vtp mode {server|client|transparent(!透明,转发但不应用配置)|off(!禁用)}
2. vtp domain `domain-name`
3. vtp password `passwordvalue`
4. vtp pruning(vtp修剪)

## 排错
- erase startup-config不能清楚数据库中的vlan配置,需要delete flash:vlan.dat
- vtp域要相同才能同步
- md5摘要相同(域名和密码)
- 加入新交换机,可以将交换机配置为透明清除版本,再配置为服务端或客户端
### STP
1. 判断根交换机,根端口
show spanning-tree,show spanning-tree root查看根交换机
2. 计算根开销

|        | 10M | 100M | 1G  | 10G |
| ------ | --- | ---- | --- | --- |
| 根开销 | 100 | 19   | 4   | 2   |
3. 判断指定端口
根开销相等时判断BID,小者胜出
### EtherChannel
- 关键字要匹配
- STP开销相等

### Trunk
- vlan要匹配
- native vlan要匹配


# WAN and MPLS
从企业或个人的角度看,要连接广域网,物理层上来说,需要专线.二三层上来说,需要数据链路协议,例如HDLC或
PPP.要将专线与路由器连接,中间一般需要一个CSU/DSU(信道服务单元/数据服务单元)做中继.现在很多专线本身集成了适配WIC(wan接口卡)的CSU/DSU.CSU/DSU设备工作时充当DCE(数据电路终端),此时路由器充当DTE(数据终端设备).两个路由器通过wan口相连时,一方使用DTE线缆,另一方使用DCE线缆.老版IOS需要在DCE段设置clock rate配置时钟.

从ISP的角度看,要提供的互联网服务往往会跨越很大的物理距离,所以不能单纯的将所有待接入的专线全部接到一块儿,所以需要对网络进行设计.城市级别的称为MetroE(城域以太网),也被称为 carrier Ethernet(载体以太网).MetroE有3类服务,E-line,E-LAN,E-Tree.通过MPLS搭建的,也会被称为VPWS(虚拟私有线路服务),VPLS(虚拟私有LAN服务),EoMPLS(Ethernet over MPLS)(这个和E-Tree不对应).

E-Line服务会创建一条点对点的EVC(Ethernet Virtual Connection,以太网虚拟连接),表示EVC两边端点可以通信.显然,E-Line两端路由器相连的两个端口需在同一子网.E-LAN(以太局域网服务)通过全互联的方式连接所有站点,相连在E-LAN的路由器需要在同一子网.E-Tree(以太网树服务)则是部分互联,也叫星形拓扑,点到多拓扑.E-Tree的根与叶相连的接口要使用同一子网,但由于叶之间并没有直接连接,所以路由要求只能根与叶成为邻居.需要针对路由协议进行额外的配置.

## HDLC
标准HDLC定义了如何在bit流中通过标志字段找到待传数据,并且通过FCS字段完成校验功能等,完成了数据链路层的工作.Cisco私有的HDLC较于标准HDLC增加了类型部分.一般串口为up时默认使用的就是HDLC.
### 配置
接口模式:
- encapsulation HDLC
- clock rate `speed`
EXEC:
- show controller serial `number`(查看是否为DCE端)
## PPP
封装结构与Cisco私有的HDLC类似.还定义了LCP(链路控制协议)和NCP(网络控制协议).LCP中有认证和多链路支持等功能.
### 认证
认证分为PAP和CHAP两种,PAP是明文传输的,CHAP是加密传输的.两种认证方式双方都必须配置了用户名和密码.
#### 配置
接口模式:
1. encapsulation ppp
2. hostname `name`(!被配置路由器的用户名)
3. username `name` password `password`(!邻居路由器的用户名和密码)
4. ppp authentication {chap|pap|chap pap(!先使用chap,再使用pap)}
5. (pap need) ppp pap sent-username `name` password `password`(!同2)
### 多链路支持
链路层接口级别的负载均衡,逻辑上被视为一个三层接口.多链路双方接口link-num应相同,group-num应相同

#### 配置
配置模式:
1. interface multilink `link-num`(!创建多链路接口)
进入逻辑接口的接口模式:
2. encapsulation ppp
3. ppp multilink
4. ip address `address` `mask`(!在该逻辑接口上配备ip和掩码)
5. ppp multilink group `group-num`

物理接口的接口模式:
1. encapsulation ppp
2. ppp multilink
3. no ip address
4. ppp multilink group `group-num`
5. !验证等在此处配置

## MPLS
位于MPLS边缘的路由器会在数据包出入MPLS网络时,对数据包添加和移除MPLS头部,内部设备转发数据时,会使用标签字段.MPLS VPN是SP的一项主营业务,可以不加密数据的前提下,确保一个客户的数据不会被发给另一个客户,还可以对特殊的数据包例如语音数据实现Qos.

MPLS网络边缘的路由器为了让客户的路由器之间能学习路由,会执行一个叫路由重分发(route redistribution)的进程,路由重分发会将路由从协议中提取出来,然后在客户使用的路由协议和多协议BGP(MPBGP)(???)之间重分发路由.???

MPLS在面对多区域OSPF时,解决方案是OSPF超级骨干(OSPF super backbone).超级骨干可以与骨干区域相连,也可以与非骨干区域相连.

MPLS面对EIGRP时,需要交换路由的路由器最好使用相同的ASN,这样 度量值不会受到影响.

## 排错
- 线路状态和协议状态均为down/down时,一般是物理层问题.
- 当线路up,协议down时
  - 两端协议均down: 使用协议不匹配(encapsulation命令不匹配) 或 PPP认证失败
  - 一端down,另一端up:使用HDLC时,up一方禁用了Keepalive
- 线路和协议均up/up时,无法路由时,问题出在第三层.当两个串口相连时,他们理应在同一子网.不然,虽然PPP链路可以ping通,但无法交换路由信息.

# Internet and VPN
当接入WAN时,本地和ISP连接.许多ISP和连接到ISP的子网共同组成了全球互联网--Internet(`:)`).

企业可以使用VPN技术通过互联网技术实现WAN专线一样的服务.


# ACL与QOS
## ACL
IP ACL是通过识别数据包,执行某些操作的功能.可以用来过滤数据包,也可以用来实现Qos.主要有三点:ACL的位置和方向,匹配模式,匹配行为.每个ip ACL默认有一条deny all.ACL是队列式匹配,先设先匹.标准ACL只能匹配ip地址,拓展ACL还可以匹配协议,端口等别的报头信息.拓展ACL匹配ip需要使用host关键字.

- 将拓展ACL放在离源近的位置
- 标准ASL放在离目的更近的位置
- 变更ACL前,禁用ACL
- 更精确的ACL在前面

特殊ip:
- 224.0.0.9:520(UDP)(RIPv2)
- 224.0.0.5,224.0.0.6(ospf)
- 224.0.0.10(EIGRP)

### 命令
配置模式:
- access-list {1-99|1300-1999} {permit|deny} {`ip` `WC-mask`(!默认为0.0.0.0)|any}
`wc-mask`中二进制为1的数可以忽略,即数据包ip(`packet-ip`&`ip`)|`wc-mask`为全1时表示匹配这条ACL规则,所以当`wc-mask`为全0时需要`packet-ip`完全等于`ip`.
匹配某一子网时,`wc-mask`=255.255.255.255-子网对应的掩码,同理,该子网最大范围为子网ip+`wc-mask`

- access-list {100-199|2000-2699} {permit|deny} `protocol` `source-IP` {`source-port`| } `dest-IP` {`dst-port`| }
`protocol`:{ip|tcp|udp|icmp|...}
`IP`都是`ip` {`wc-mask`(!默认为0.0.0.0)| }的格式,端口使用eq,lt,ne,gt,range `x` to `y`关键字.

- ip access-list {standard|extended} `name`(!进入命名ACL配置模式,之后无论标准还是拓展,都从{permit|deny}开始)

|端口号|协议|应用程序|端口代替关键字|
|---|---|---|---|
|20|TCP|FTP数据|ftp-data|
|21|TCP|FTP控制|ftp|
|22|TCP|SSH||
|23|TCP|Telnet|telnet|
|25|TCP|SMTP|smtp|
|53|UDP,TCP|DNS|domain|
|67|UDP|DHCP服务端||
|68|UDP|DHCP客户端||
|69|UDP|TFTP|tftp|
|80|TCP|HTTP|www|
|110|TCP|POP3|pop3|
|161|UDP|SNMP|snmp|
|443|TCP|SSL||
|514|UDP|log||

接口模式
- ip access-group `group` {in|out}(!在接口上以某方向启用某组ACL)
- no ip access-group(!禁用ACL)
## QOS
Qos(quality of service)系列工具管理网络流量的带宽,延迟,抖动,丢包.
### 分类和标记,and DiffServ
首先Qos会根据数据包的字段,等进行匹配和标记(数据生成之初执行复杂匹配,标记之后进行简单匹配,节约性能),当数据包不能通过简单的判断分类时,会使用名为NBAR2(Network Based Application Recognition version 2,基于网络的应用识别)的工具.使用标记和分类Qos时需要设定Qos的信任边界,不信任接入层的终端设备的标记.

DiffServ建议了统一的DSCP标记值,有加速转发(EF),确保转发(AF),类别选择器(CS)等.加速转发即优先被路由,确保转发定义了四个独立队列,在队列中定义了三个优先级.根据标记的不同在不同队列中有不同优先级的丢弃行为.类别选择器(CS),IPP对应的值*8为对应DSCP的值???

### 拥塞控制(队列)
所有网络互联设备都使用队列机制.例如轮询调度,使权重更高的队列得到的带宽更多(这样还可以实现带宽控制);优先级队列,将语音数据的队列永远优先处理(语音数据量大时会导致其他队列饥饿,使用CAC解决).

### 整形和限速
限速工具通过检测数据包,对超过速率限制的数据包丢弃,实现限速功能.限速工具通常是ISP对企业使用,企业则需要使用整形工具,通过将达到速率限制的数据包推迟发出,达到对速率整形的目的.

### 拥塞避免
如同TCP中的拥塞避免,设立丢弃一些数据包的阈值和级别,当队列满到某个阈值时,丢弃某个百分比的数据包,队列越满,丢弃越多.
# SNMP 
# IP SLA

# SDN
